var v=(U,p,h)=>new Promise((k,l)=>{var _=d=>{try{u(h.next(d))}catch(m){l(m)}},w=d=>{try{u(h.throw(d))}catch(m){l(m)}},u=d=>d.done?k(d.value):Promise.resolve(d.value).then(_,w);u((h=h.apply(U,p)).next())});import{_ as te,r as n,e as L,B as O,g as se,c as i,b as t,d as C,i as ae,k as le,q as oe,t as o,w as $,C as I,F as V,a as T,v as ne,p as N,j as ie,o as c,n as ce}from"./index-BH69Dcdy.js";import{O as ue,P as de,e as re,g as ve,Q as pe,R as ge,S as fe,T as he,U as _e}from"./api-DM-7CNjc.js";const me={class:"bookmark-manager"},be={class:"header"},ke={class:"header-left"},ye={class:"header-stats"},we={class:"stat-item"},Ce={class:"stat-item"},xe={class:"stat-item"},Me={class:"toolbar"},Be={class:"toolbar-left"},Se=["value"],De={class:"toolbar-right"},$e=["disabled"],Ve=["disabled"],Te=["disabled"],ze={class:"batch-actions"},Fe={class:"checkbox-label"},Ie=["checked"],Ne={class:"selected-count"},Ue={key:0,class:"loading"},Pe={key:1,class:"empty-state"},Ee={key:2,class:"bookmark-list"},Le=["checked","onChange"],Oe=["src"],Ae={class:"bookmark-info"},Qe={class:"bookmark-title"},je={key:0,class:"duplicate-badge"},qe={class:"bookmark-url"},Re={class:"bookmark-meta"},Ge={key:0,class:"folder-tag"},He={class:"source-tag"},Je={class:"time-tag"},Ke={class:"bookmark-actions"},We=["onClick"],Xe={key:3,class:"pagination"},Ye=["disabled"],Ze={class:"page-info"},et=["disabled"],tt={class:"modal-header"},st={class:"modal-body"},at={class:"form-group"},lt=["value"],ot={key:0,class:"form-group"},nt=["value"],it={class:"hint"},ct={class:"modal-footer"},ut=["disabled"],dt={__name:"BookmarkManager",setup(U){const p=n([]),h=n([]),k=n({total:0,pending:0,processed:0,invalid:0}),l=n([]),_=n({}),w=n(!1),u=n(1),d=n(50),m=n(0),x=n(""),M=n(""),y=n(!1),g=n(""),B=n(""),S=n(!1),P=n([]),z=n([]),A={browser:"æµè§ˆå™¨",extension:"æ‰©å±•",manual:"æ‰‹åŠ¨"},F=L(()=>Math.ceil(m.value/d.value)),E=L(()=>p.value.length>0&&l.value.length===p.value.length);function b(){return v(this,null,function*(){w.value=!0;try{const s=yield ue({page:u.value,pageSize:d.value,folder:x.value,search:M.value,status:"pending"});p.value=s.data.data,m.value=s.data.total}catch(s){console.error("åŠ è½½ä¹¦ç­¾å¤±è´¥:",s),alert("åŠ è½½ä¹¦ç­¾å¤±è´¥")}finally{w.value=!1}})}function Q(){return v(this,null,function*(){try{const s=yield de();h.value=s.data}catch(s){console.error("åŠ è½½æ–‡ä»¶å¤¹å¤±è´¥:",s)}})}function D(){return v(this,null,function*(){try{const s=yield re();k.value=s.data}catch(s){console.error("åŠ è½½ç»Ÿè®¡å¤±è´¥:",s)}})}function j(){return v(this,null,function*(){try{const s=yield ve();P.value=s.data}catch(s){console.error("åŠ è½½èœå•å¤±è´¥:",s)}})}function q(){return v(this,null,function*(){if(l.value.length!==0)try{const s=yield pe(l.value),e={};s.data.duplicates.forEach(r=>{e[r.bookmarkId]=r.existingCard}),_.value=e,s.data.duplicates.length>0?alert(`å‘ç° ${s.data.duplicates.length} ä¸ªé‡å¤ä¹¦ç­¾`):alert("æ²¡æœ‰å‘ç°é‡å¤ä¹¦ç­¾")}catch(s){console.error("æ£€æµ‹é‡å¤å¤±è´¥:",s),alert("æ£€æµ‹é‡å¤å¤±è´¥")}})}function R(){return v(this,null,function*(){var s,e;if(g.value){S.value=!0;try{const r=yield fe(l.value,g.value,B.value||null);alert(`æˆåŠŸè½¬æ¢ ${r.data.converted} ä¸ªä¹¦ç­¾ä¸ºå¡ç‰‡`),y.value=!1,l.value=[],g.value="",B.value="",yield b(),yield D()}catch(r){console.error("è½¬æ¢å¤±è´¥:",r),alert("è½¬æ¢å¤±è´¥: "+(((e=(s=r.response)==null?void 0:s.data)==null?void 0:e.error)||r.message))}finally{S.value=!1}}})}function G(s){return v(this,null,function*(){if(confirm("ç¡®å®šåˆ é™¤è¿™ä¸ªä¹¦ç­¾å—ï¼Ÿ"))try{yield he(s),yield b(),yield D()}catch(e){console.error("åˆ é™¤å¤±è´¥:",e),alert("åˆ é™¤å¤±è´¥")}})}function H(){return v(this,null,function*(){if(l.value.length!==0&&confirm(`ç¡®å®šåˆ é™¤é€‰ä¸­çš„ ${l.value.length} ä¸ªä¹¦ç­¾å—ï¼Ÿ`))try{yield ge(l.value),l.value=[],yield b(),yield D()}catch(s){console.error("æ‰¹é‡åˆ é™¤å¤±è´¥:",s),alert("æ‰¹é‡åˆ é™¤å¤±è´¥")}})}function J(s){const e=l.value.indexOf(s);e>-1?l.value.splice(e,1):l.value.push(s)}function K(){E.value?l.value=[]:l.value=p.value.map(s=>s.id)}function W(){l.value=p.value.filter(s=>!_.value[s.id]).map(s=>s.id)}function X(){l.value=[]}function Y(){u.value>1&&(u.value--,b())}function Z(){u.value<F.value&&(u.value++,b())}function ee(s){if(!s)return"";const e=new Date(s),a=new Date-e,f=Math.floor(a/(1e3*60*60*24));return f===0?"ä»Šå¤©":f===1?"æ˜¨å¤©":f<7?`${f}å¤©å‰`:e.toLocaleDateString()}return O(g,s=>v(null,null,function*(){if(s)try{const e=yield _e(s);z.value=e.data}catch(e){console.error("åŠ è½½å­èœå•å¤±è´¥:",e)}else z.value=[]})),O([x,M],()=>{u.value=1,b()}),se(()=>{b(),Q(),D(),j()}),(s,e)=>{const r=oe("router-link");return c(),i("div",me,[t("div",be,[t("div",ke,[ae(r,{to:"/",class:"back-btn"},{default:le(()=>e[10]||(e[10]=[N("â† è¿”å›é¦–é¡µ")])),_:1,__:[10]}),e[11]||(e[11]=t("h1",null,"ğŸ“š ä¹¦ç­¾æ”¶ä»¶ç®±",-1))]),t("div",ye,[t("span",we,"å¾…å¤„ç†: "+o(k.value.pending),1),t("span",Ce,"å·²å¤„ç†: "+o(k.value.processed),1),t("span",xe,"å¤±æ•ˆ: "+o(k.value.invalid),1)])]),t("div",Me,[t("div",Be,[$(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>x.value=a),class:"filter-select"},[e[12]||(e[12]=t("option",{value:""},"å…¨éƒ¨æ–‡ä»¶å¤¹",-1)),(c(!0),i(V,null,T(h.value,a=>(c(),i("option",{key:a.folder,value:a.folder},o(a.folder)+" ("+o(a.count)+") ",9,Se))),128))],512),[[I,x.value]]),$(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>M.value=a),type:"text",placeholder:"æœç´¢ä¹¦ç­¾...",class:"search-input"},null,512),[[ne,M.value]])]),t("div",De,[t("button",{onClick:q,class:"btn btn-secondary",disabled:l.value.length===0}," ğŸ” æ£€æµ‹é‡å¤ ",8,$e),t("button",{onClick:e[2]||(e[2]=a=>y.value=!0),class:"btn btn-primary",disabled:l.value.length===0}," â¡ï¸ è½¬ä¸ºå¡ç‰‡ ("+o(l.value.length)+") ",9,Ve),t("button",{onClick:H,class:"btn btn-danger",disabled:l.value.length===0}," ğŸ—‘ï¸ åˆ é™¤ ",8,Te)])]),t("div",ze,[t("label",Fe,[t("input",{type:"checkbox",checked:E.value,onChange:K},null,40,Ie),e[13]||(e[13]=N(" å…¨é€‰ "))]),t("button",{onClick:W,class:"btn-link"},"é€‰æ‹©éé‡å¤"),t("button",{onClick:X,class:"btn-link"},"æ¸…é™¤é€‰æ‹©"),t("span",Ne,"å·²é€‰ "+o(l.value.length)+" é¡¹",1)]),w.value?(c(),i("div",Ue,"åŠ è½½ä¸­...")):p.value.length===0?(c(),i("div",Pe,e[14]||(e[14]=[t("p",null,"ğŸ“­ æš‚æ— å¾…å¤„ç†çš„ä¹¦ç­¾",-1),t("p",{class:"hint"},"ä½¿ç”¨æµè§ˆå™¨æ‰©å±•å¿«é€Ÿæ”¶è—æˆ–æ‰¹é‡å¯¼å…¥ä¹¦ç­¾",-1)]))):(c(),i("div",Ee,[(c(!0),i(V,null,T(p.value,a=>(c(),i("div",{key:a.id,class:ce(["bookmark-item",{selected:l.value.includes(a.id),duplicate:_.value[a.id]}])},[t("input",{type:"checkbox",checked:l.value.includes(a.id),onChange:f=>J(a.id)},null,40,Le),t("img",{src:a.favicon||"data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2224%22 height=%2224%22><text y=%2218%22 font-size=%2220%22>ğŸ”–</text></svg>",class:"bookmark-favicon",onError:e[3]||(e[3]=f=>f.target.src="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2224%22 height=%2224%22><text y=%2218%22 font-size=%2220%22>ğŸ”–</text></svg>")},null,40,Oe),t("div",Ae,[t("div",Qe,[N(o(a.title)+" ",1),_.value[a.id]?(c(),i("span",je," é‡å¤: "+o(_.value[a.id].card_title),1)):C("",!0)]),t("div",qe,o(a.url),1),t("div",Re,[a.folder?(c(),i("span",Ge,"ğŸ“ "+o(a.folder),1)):C("",!0),t("span",He,o(A[a.source]||a.source),1),t("span",Je,o(ee(a.created_at)),1)])]),t("div",Ke,[t("button",{onClick:f=>G(a.id),class:"btn-icon",title:"åˆ é™¤"},"ğŸ—‘ï¸",8,We)])],2))),128))])),m.value>d.value?(c(),i("div",Xe,[t("button",{onClick:Y,disabled:u.value===1,class:"btn-page"},"ä¸Šä¸€é¡µ",8,Ye),t("span",Ze,"ç¬¬ "+o(u.value)+" é¡µ / å…± "+o(F.value)+" é¡µ",1),t("button",{onClick:Z,disabled:u.value>=F.value,class:"btn-page"},"ä¸‹ä¸€é¡µ",8,et)])):C("",!0),y.value?(c(),i("div",{key:4,class:"modal-overlay",onClick:e[9]||(e[9]=a=>y.value=!1)},[t("div",{class:"modal",onClick:e[8]||(e[8]=ie(()=>{},["stop"]))},[t("div",tt,[e[15]||(e[15]=t("h3",null,"è½¬ä¸ºå¡ç‰‡",-1)),t("button",{onClick:e[4]||(e[4]=a=>y.value=!1),class:"modal-close"},"Ã—")]),t("div",st,[t("div",at,[e[17]||(e[17]=t("label",null,"é€‰æ‹©åˆ†ç±» *",-1)),$(t("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>g.value=a),class:"form-control"},[e[16]||(e[16]=t("option",{value:""},"è¯·é€‰æ‹©åˆ†ç±»",-1)),(c(!0),i(V,null,T(P.value,a=>(c(),i("option",{key:a.id,value:a.id},o(a.name),9,lt))),128))],512),[[I,g.value]])]),g.value?(c(),i("div",ot,[e[19]||(e[19]=t("label",null,"é€‰æ‹©å­åˆ†ç±»ï¼ˆå¯é€‰ï¼‰",-1)),$(t("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>B.value=a),class:"form-control"},[e[18]||(e[18]=t("option",{value:""},"æ— å­åˆ†ç±»",-1)),(c(!0),i(V,null,T(z.value,a=>(c(),i("option",{key:a.id,value:a.id},o(a.name),9,nt))),128))],512),[[I,B.value]])])):C("",!0),t("p",it,"å°†é€‰ä¸­çš„ "+o(l.value.length)+" ä¸ªä¹¦ç­¾è½¬ä¸ºå¡ç‰‡",1)]),t("div",ct,[t("button",{onClick:e[7]||(e[7]=a=>y.value=!1),class:"btn btn-secondary"},"å–æ¶ˆ"),t("button",{onClick:R,class:"btn btn-primary",disabled:!g.value||S.value},o(S.value?"è½¬æ¢ä¸­...":"ç¡®è®¤è½¬æ¢"),9,ut)])])])):C("",!0)])}}},gt=te(dt,[["__scopeId","data-v-49ce65c5"]]);export{gt as default};
