var Ye=Object.defineProperty,Ze=Object.defineProperties;var es=Object.getOwnPropertyDescriptors;var De=Object.getOwnPropertySymbols;var ss=Object.prototype.hasOwnProperty,ts=Object.prototype.propertyIsEnumerable;var Pe=(a,s,l)=>s in a?Ye(a,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[s]=l,G=(a,s)=>{for(var l in s||(s={}))ss.call(s,l)&&Pe(a,l,s[l]);if(De)for(var l of De(s))ts.call(s,l)&&Pe(a,l,s[l]);return a},ne=(a,s)=>Ze(a,es(s));var x=(a,s,l)=>new Promise((g,t)=>{var i=c=>{try{C(l.next(c))}catch(k){t(k)}},d=c=>{try{C(l.throw(c))}catch(k){t(k)}},C=c=>c.done?g(c.value):Promise.resolve(c.value).then(i,d);C((l=l.apply(a,s)).next())});import{_ as Y,b as r,d as o,e,t as u,A as ue,o as le,a as Fe,r as $,h as b,q as S,v as E,s as Te,F as z,g as O,c as ce,k as Re,C as ie,z as K,n as ve,w as oe,i as W,E as re,G as $e,y as J,H as Ee,l as He,B as qe,I as ns,m as ls,p as as,f as is,J as os,K as rs}from"./index-IpXrYYTb.js";import{j as ds,g as Ie,o as us,z as cs,y as vs,u as ps,p as ms,q as hs,c as Be,m as gs,r as Ke,x as Le,f as fs,A as ys,B as ks,C as xe,D as bs,E as ws,F as _s,G as Cs,i as _e,b as Ms,H as Ss,I as Us,J as $s,K as xs,L as Ts,M as As,N as je,O as Ae,P as Vs,Q as Is,R as Bs,S as Ds,T as Ps,U as Rs,V as We,W as Es}from"./urlNormalizer-BIYUxY7b.js";const Ks={class:"welcome-page"},Ls={class:"welcome-title"},Ws={class:"welcome-cards"},zs={class:"welcome-card"},Os={class:"welcome-value"},Ns={class:"welcome-card"},Fs={class:"welcome-value"},Hs={__name:"WelcomePage",props:{lastLoginTime:String,lastLoginIp:String,currentUsername:String},setup(a){return(s,l)=>(o(),r("div",Ks,[e("h2",Ls,"æ¬¢è¿æ‚¨ï¼Œ"+u(a.currentUsername||"admin")+"ï¼",1),e("div",Ws,[e("div",zs,[l[0]||(l[0]=ue('<div class="welcome-icon time-icon" data-v-5cc4f846><svg width="32" height="32" viewBox="0 0 24 24" fill="none" data-v-5cc4f846><circle cx="12" cy="12" r="10" stroke="#1abc9c" stroke-width="2" data-v-5cc4f846></circle><path d="M12 6v6l4 2" stroke="#1abc9c" stroke-width="2" stroke-linecap="round" data-v-5cc4f846></path></svg></div><div class="welcome-label" data-v-5cc4f846>ä¸Šæ¬¡ç™»å½•æ—¶é—´</div>',2)),e("div",Os,u(a.lastLoginTime||"--"),1)]),e("div",Ns,[l[1]||(l[1]=ue('<div class="welcome-icon ip-icon" data-v-5cc4f846><svg width="32" height="32" viewBox="0 0 24 24" fill="none" data-v-5cc4f846><circle cx="12" cy="12" r="10" stroke="#1abc9c" stroke-width="2" data-v-5cc4f846></circle><path d="M12 8a4 4 0 1 1 0 8 4 4 0 0 1 0-8z" stroke="#1abc9c" stroke-width="2" data-v-5cc4f846></path><circle cx="12" cy="12" r="2" fill="#1abc9c" data-v-5cc4f846></circle></svg></div><div class="welcome-label" data-v-5cc4f846>ä¸Šæ¬¡ç™»å½•IP</div>',2)),e("div",Fs,u(a.lastLoginIp||"--"),1)])])]))}},qs=Y(Hs,[["__scopeId","data-v-5cc4f846"]]),de=$(null),Se=$(!1),Ve=$(0),Ue=new Map;let Ce=0;const js=5,Gs=3e3;function Ge(){if(de.value)return;const a=ds(),s=new EventSource(`/api/sse/data-sync?clientId=${a}`);s.onopen=()=>{Se.value=!0,Ce=0},s.onmessage=l=>{try{const g=JSON.parse(l.data);if(g.type==="connected"){Ve.value=g.version;return}if(g.type==="version_change"){const t=g.senderId===a;Ve.value=g.version,Ue.forEach((i,d)=>{try{i({version:g.version,isSelfChange:t,payload:g})}catch(C){console.error("SSE listener error:",d,C)}})}}catch(g){console.error("SSE parse error:",g)}},s.onerror=()=>{Se.value=!1,s.close(),de.value=null,Ce<js&&(Ce++,setTimeout(Ge,Gs*Ce))},de.value=s}function Js(){de.value&&(de.value.close(),de.value=null,Se.value=!1)}function ze(a,s){Ue.set(a,s),de.value||Ge()}function Oe(a){Ue.delete(a),Ue.size===0&&Js()}function he(a,s){return le(()=>{s&&ze(a,s)}),Fe(()=>{Oe(a)}),{isConnected:Se,currentVersion:Ve,subscribe:ze,unsubscribe:Oe}}const Qs={class:"menu-manage"},Xs={key:0,class:"loading-overlay"},Ys={class:"menu-header"},Zs={class:"menu-add"},et=["disabled"],st={class:"menu-content"},tt={key:0,class:"empty-state"},nt={class:"menu-card-header"},lt={class:"menu-title"},at={class:"menu-name"},it={class:"menu-order"},ot={class:"menu-actions"},rt=["onClick"],dt=["onClick"],ut=["onClick"],ct={key:0,class:"sub-menu-list"},vt={class:"sub-menu-name"},pt={class:"sub-menu-order"},mt={class:"sub-menu-actions"},ht=["onClick"],gt=["onClick"],ft={key:1,class:"no-sub-menu"},yt={key:1,class:"modal-overlay"},kt={class:"modal"},bt={class:"modal-header"},wt={class:"modal-body"},_t={class:"form-group"},Ct={class:"form-group"},Mt={class:"modal-footer"},St=["disabled"],Ut={key:2,class:"modal-overlay"},$t={class:"modal"},xt={class:"modal-header"},Tt={class:"modal-body"},At={class:"form-group"},Vt={class:"form-group"},It={class:"modal-footer"},Bt=["disabled"],Dt={key:3,class:"modal-overlay"},Pt={class:"modal"},Rt={class:"modal-body"},Et={class:"form-group"},Kt={class:"form-group"},Lt={class:"modal-footer"},Wt=["disabled"],zt={__name:"MenuManage",setup(a){const s=$([]),l=$(!1),g=$("åŠ è½½ä¸­..."),t=$(""),i=$(!1),d=$(null),C=$({name:"",order:0}),c=$(!1),k=$(null),y=$(""),_=$({name:"",order:0}),V=$(!1),w=$(null),p=$({name:"",order:0});he("MenuManage",({isSelfChange:L})=>{L||v(!1)}),le(()=>{v()});function h(){try{window.dispatchEvent(new CustomEvent("nav-menus-updated")),console.log("[æ ç›®ç®¡ç†] å·²é€šçŸ¥æ‰©å±•åˆ·æ–°å³é”®èœå•")}catch(L){console.warn("[æ ç›®ç®¡ç†] é€šçŸ¥æ‰©å±•å¤±è´¥:",L)}}function v(L=!1){return x(this,null,function*(){var U,D;l.value=!0,g.value="åŠ è½½ä¸­...";try{const P=yield Ie(!0);s.value=P.data||[],L&&h()}catch(P){alert("åŠ è½½å¤±è´¥: "+(((D=(U=P.response)==null?void 0:U.data)==null?void 0:D.error)||P.message))}finally{l.value=!1}})}function B(){return x(this,null,function*(){var L,U;if(t.value.trim()){l.value=!0,g.value="æ·»åŠ ä¸­...";try{const D=s.value.length?Math.max(...s.value.map(P=>P.order||0)):0;yield us({name:t.value.trim(),order:D+1}),t.value="",yield v(!0)}catch(D){alert("æ·»åŠ å¤±è´¥: "+(((U=(L=D.response)==null?void 0:L.data)==null?void 0:U.error)||D.message)),l.value=!1}}})}function A(L){d.value=L,C.value={name:L.name,order:L.order},i.value=!0}function I(){return x(this,null,function*(){var P,f;if(!C.value.name.trim()||!d.value)return;const L=d.value.id,U=C.value.name.trim(),D=C.value.order;N(),l.value=!0,g.value="ä¿å­˜ä¸­...";try{yield ps(L,{name:U,order:D}),yield v(!0)}catch(m){alert("ä¿å­˜å¤±è´¥: "+(((f=(P=m.response)==null?void 0:P.data)==null?void 0:f.error)||m.message)),l.value=!1}})}function H(L){return x(this,null,function*(){var U,D;if(confirm(`ç¡®å®šåˆ é™¤ä¸»èœå•ã€Œ${L.name}ã€å—ï¼Ÿ
å°†åŒæ—¶åˆ é™¤å…¶ä¸‹æ‰€æœ‰å­èœå•å’Œå¡ç‰‡ï¼`)){l.value=!0,g.value="åˆ é™¤ä¸­...";try{yield cs(L.id),yield v(!0)}catch(P){alert("åˆ é™¤å¤±è´¥: "+(((D=(U=P.response)==null?void 0:U.data)==null?void 0:D.error)||P.message)),l.value=!1}}})}function X(L){k.value=L.id,y.value=L.name;const U=L.subMenus||[],D=U.length?Math.max(...U.map(P=>P.order||0)):0;_.value={name:"",order:D+1},c.value=!0}function ee(){return x(this,null,function*(){var P,f;if(!_.value.name.trim()||!k.value)return;const L=k.value,U=_.value.name.trim(),D=_.value.order;N(),l.value=!0,g.value="æ·»åŠ ä¸­...";try{yield ms(L,{name:U,order:D}),yield v(!0)}catch(m){alert("æ·»åŠ å¤±è´¥: "+(((f=(P=m.response)==null?void 0:P.data)==null?void 0:f.error)||m.message)),l.value=!1}})}function se(L,U){w.value=U,p.value={name:U.name,order:U.order},V.value=!0}function ae(){return x(this,null,function*(){var P,f;if(!p.value.name.trim()||!w.value)return;const L=w.value.id,U=p.value.name.trim(),D=p.value.order;N(),l.value=!0,g.value="ä¿å­˜ä¸­...";try{yield hs(L,{name:U,order:D}),yield v(!0)}catch(m){alert("ä¿å­˜å¤±è´¥: "+(((f=(P=m.response)==null?void 0:P.data)==null?void 0:f.error)||m.message)),l.value=!1}})}function te(L){return x(this,null,function*(){var U,D;if(confirm(`ç¡®å®šåˆ é™¤å­èœå•ã€Œ${L.name}ã€å—ï¼Ÿ
å°†åŒæ—¶åˆ é™¤å…¶ä¸‹æ‰€æœ‰å¡ç‰‡ï¼`)){l.value=!0,g.value="åˆ é™¤ä¸­...";try{yield vs(L.id),yield v(!0)}catch(P){alert("åˆ é™¤å¤±è´¥: "+(((D=(U=P.response)==null?void 0:U.data)==null?void 0:D.error)||P.message)),l.value=!1}}})}function N(){i.value=!1,c.value=!1,V.value=!1,d.value=null,w.value=null}return(L,U)=>(o(),r("div",Qs,[l.value?(o(),r("div",Xs,[U[7]||(U[7]=e("div",{class:"loading-spinner"},null,-1)),e("span",null,u(g.value),1)])):b("",!0),e("div",Ys,[U[8]||(U[8]=e("h2",{class:"page-title"},"æ ç›®ç®¡ç†",-1)),e("div",Zs,[S(e("input",{"onUpdate:modelValue":U[0]||(U[0]=D=>t.value=D),placeholder:"è¾“å…¥ä¸»èœå•åç§°",class:"input",onKeyup:Te(B,["enter"])},null,544),[[E,t.value]]),e("button",{class:"btn btn-primary",onClick:B,disabled:l.value||!t.value.trim()}," + æ·»åŠ ä¸»èœå• ",8,et)])]),e("div",st,[s.value.length===0?(o(),r("div",tt,[...U[9]||(U[9]=[e("p",null,"æš‚æ— èœå•ï¼Œè¯·æ·»åŠ ç¬¬ä¸€ä¸ªä¸»èœå•",-1)])])):b("",!0),(o(!0),r(z,null,O(s.value,D=>(o(),r("div",{key:D.id,class:"menu-card"},[e("div",nt,[e("div",lt,[e("span",at,u(D.name),1),e("span",it,"æ’åº: "+u(D.order),1)]),e("div",ot,[e("button",{class:"btn-icon btn-edit",onClick:P=>A(D),title:"ç¼–è¾‘"},[...U[10]||(U[10]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,rt),e("button",{class:"btn-icon btn-add",onClick:P=>X(D),title:"æ·»åŠ å­èœå•"},[...U[11]||(U[11]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 5v14M5 12h14"})],-1)])],8,dt),e("button",{class:"btn-icon btn-delete",onClick:P=>H(D),title:"åˆ é™¤"},[...U[12]||(U[12]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"})],-1)])],8,ut)])]),D.subMenus&&D.subMenus.length>0?(o(),r("div",ct,[(o(!0),r(z,null,O(D.subMenus,P=>(o(),r("div",{key:P.id,class:"sub-menu-item"},[e("span",vt,u(P.name),1),e("span",pt,"æ’åº: "+u(P.order),1),e("div",mt,[e("button",{class:"btn-icon-sm btn-edit",onClick:f=>se(D,P),title:"ç¼–è¾‘"},[...U[13]||(U[13]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,ht),e("button",{class:"btn-icon-sm btn-delete",onClick:f=>te(P),title:"åˆ é™¤"},[...U[14]||(U[14]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"})],-1)])],8,gt)])]))),128))])):(o(),r("div",ft,[...U[15]||(U[15]=[e("span",null,"æš‚æ— å­èœå•",-1)])]))]))),128))]),i.value?(o(),r("div",yt,[e("div",kt,[e("div",bt,[e("h3",null,u(d.value?"ç¼–è¾‘ä¸»èœå•":"æ·»åŠ å­èœå•"),1),e("button",{class:"modal-close",onClick:N},"Ã—")]),e("div",wt,[e("div",_t,[U[16]||(U[16]=e("label",null,"åç§°",-1)),S(e("input",{"onUpdate:modelValue":U[1]||(U[1]=D=>C.value.name=D),type:"text",class:"input",placeholder:"è¯·è¾“å…¥åç§°"},null,512),[[E,C.value.name]])]),e("div",Ct,[U[17]||(U[17]=e("label",null,"æ’åº",-1)),S(e("input",{"onUpdate:modelValue":U[2]||(U[2]=D=>C.value.order=D),type:"number",class:"input",placeholder:"æ•°å­—è¶Šå°è¶Šé å‰"},null,512),[[E,C.value.order,void 0,{number:!0}]])])]),e("div",Mt,[e("button",{class:"btn btn-cancel",onClick:N},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:I,disabled:!C.value.name.trim()},"ä¿å­˜",8,St)])])])):b("",!0),c.value?(o(),r("div",Ut,[e("div",$t,[e("div",xt,[e("h3",null,"æ·»åŠ å­èœå•åˆ°ã€Œ"+u(y.value)+"ã€",1),e("button",{class:"modal-close",onClick:N},"Ã—")]),e("div",Tt,[e("div",At,[U[18]||(U[18]=e("label",null,"å­èœå•åç§°",-1)),S(e("input",{"onUpdate:modelValue":U[3]||(U[3]=D=>_.value.name=D),type:"text",class:"input",placeholder:"è¯·è¾“å…¥å­èœå•åç§°"},null,512),[[E,_.value.name]])]),e("div",Vt,[U[19]||(U[19]=e("label",null,"æ’åº",-1)),S(e("input",{"onUpdate:modelValue":U[4]||(U[4]=D=>_.value.order=D),type:"number",class:"input",placeholder:"æ•°å­—è¶Šå°è¶Šé å‰"},null,512),[[E,_.value.order,void 0,{number:!0}]])])]),e("div",It,[e("button",{class:"btn btn-cancel",onClick:N},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:ee,disabled:!_.value.name.trim()},"æ·»åŠ ",8,Bt)])])])):b("",!0),V.value?(o(),r("div",Dt,[e("div",Pt,[e("div",{class:"modal-header"},[U[20]||(U[20]=e("h3",null,"ç¼–è¾‘å­èœå•",-1)),e("button",{class:"modal-close",onClick:N},"Ã—")]),e("div",Rt,[e("div",Et,[U[21]||(U[21]=e("label",null,"å­èœå•åç§°",-1)),S(e("input",{"onUpdate:modelValue":U[5]||(U[5]=D=>p.value.name=D),type:"text",class:"input",placeholder:"è¯·è¾“å…¥å­èœå•åç§°"},null,512),[[E,p.value.name]])]),e("div",Kt,[U[22]||(U[22]=e("label",null,"æ’åº",-1)),S(e("input",{"onUpdate:modelValue":U[6]||(U[6]=D=>p.value.order=D),type:"number",class:"input",placeholder:"æ•°å­—è¶Šå°è¶Šé å‰"},null,512),[[E,p.value.order,void 0,{number:!0}]])])]),e("div",Lt,[e("button",{class:"btn btn-cancel",onClick:N},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:ae,disabled:!p.value.name.trim()},"ä¿å­˜",8,Wt)])])])):b("",!0)]))}},Ot=Y(zt,[["__scopeId","data-v-5fad8980"]]),Nt={class:"card-manage"},Ft={class:"card-header"},Ht={class:"card-add"},qt=["value"],jt=["value"],Gt={class:"card-card"},Jt={class:"card-table"},Qt=["onUpdate:modelValue","onBlur"],Xt=["onUpdate:modelValue","onBlur"],Yt=["onUpdate:modelValue","onBlur"],Zt=["onUpdate:modelValue","onBlur"],en=["onClick"],sn={key:0,class:"selected-tags"},tn={key:1,class:"tag-placeholder"},nn=["onUpdate:modelValue","onBlur"],ln=["onClick"],an={class:"modal-body"},on={key:0,class:"empty-tags"},rn={key:1,class:"tag-options"},dn=["checked","onChange"],un={class:"modal-body"},cn={class:"duplicate-comparison"},vn={class:"card-info-box existing"},pn={class:"card-details"},mn={class:"detail-row"},hn={class:"detail-value"},gn={class:"detail-row"},fn={class:"detail-value url"},yn={key:0,class:"detail-row"},kn={class:"detail-value url"},bn={class:"card-info-box pending"},wn={class:"card-details"},_n={class:"detail-row"},Cn={class:"detail-value"},Mn={class:"detail-row"},Sn={class:"detail-value url"},Un={key:0,class:"detail-row"},$n={class:"detail-value url"},xn={__name:"CardManage",setup(a){const s=$([]),l=$([]),g=$(),t=$(""),i=$(""),d=$(""),C=$(""),c=$([]),k=$(!1),y=$(null),_=$([]),V=$(!1),w=$(null),p=$(null),h=ce(()=>{if(!g.value)return[];const f=s.value.find(m=>m.id===g.value);return(f==null?void 0:f.subMenus)||[]});le(()=>x(null,null,function*(){const f=yield Ie();s.value=f.data,s.value.length&&(g.value=s.value[0].id,t.value="");const m=yield Be();c.value=m.data})),Re(g,()=>{t.value="",A()}),Re(t,A),he("CardManage",({isSelfChange:f})=>{f||(loadMenus(),A())});function v(){t.value=""}function B(){A()}function A(){return x(this,null,function*(){if(!g.value)return;const f=yield fs(g.value,t.value||null);l.value=f.data})}function I(){return x(this,null,function*(){if(!i.value||!d.value)return;const f=l.value.find(m=>gs({title:i.value,url:d.value},m));f?(w.value=f,p.value={menu_id:g.value,sub_menu_id:t.value||null,title:i.value,url:d.value,logo_url:C.value},V.value=!0):yield N({menu_id:g.value,sub_menu_id:t.value||null,title:i.value,url:d.value,logo_url:C.value})})}function H(f){return x(this,null,function*(){yield Ke(f.id,{menu_id:g.value,sub_menu_id:t.value||null,title:f.title,url:f.url,logo_url:f.logo_url,desc:f.desc,order:f.order,tagIds:f.tags?f.tags.map(m=>m.id):[]}),A()})}function X(f){return x(this,null,function*(){if(!confirm("ç¡®å®šè¦åˆ é™¤è¿™å¼ å¡ç‰‡å—ï¼Ÿ"))return;const m=l.value.findIndex(Q=>Q.id===f);m>-1&&l.value.splice(m,1);try{yield Le(f)}catch(Q){console.error("åˆ é™¤å¡ç‰‡å¤±è´¥:",Q),yield A()}})}function ee(f){y.value=f,_.value=f.tags?f.tags.map(m=>m.id):[],k.value=!0}function se(){k.value=!1,y.value=null,_.value=[]}function ae(f){const m=_.value.indexOf(f);m>-1?_.value.splice(m,1):_.value.push(f)}function te(){return x(this,null,function*(){y.value&&(yield Ke(y.value.id,{menu_id:y.value.menu_id,sub_menu_id:y.value.sub_menu_id,title:y.value.title,url:y.value.url,logo_url:y.value.logo_url,desc:y.value.desc,order:y.value.order,tagIds:_.value}),se(),A())})}function N(f){return x(this,null,function*(){yield ys(f),i.value="",d.value="",C.value="",A()})}function L(){V.value=!1,w.value=null,p.value=null}function U(){L(),i.value="",d.value="",C.value=""}function D(){return x(this,null,function*(){!p.value||!w.value||(yield Le(w.value.id),yield N(p.value),L())})}function P(){p.value&&(i.value=p.value.title,d.value=p.value.url,C.value=p.value.logo_url||"",L(),alert("è¯·ä¿®æ”¹å¡ç‰‡ä¿¡æ¯åå†æ¬¡ç‚¹å‡»â€œæ·»åŠ å¡ç‰‡â€æŒ‰é’®"))}return(f,m)=>{var Q,ge,fe,ye,ke,Z,be,we;return o(),r("div",Nt,[e("div",Ft,[m[9]||(m[9]=e("div",{class:"header-content"},[e("h2",{class:"page-title"},"ç®¡ç†ç½‘ç«™å¯¼èˆªå¡ç‰‡ï¼Œæ”¯æŒä¸»èœå•å’Œå­èœå•åˆ†ç±»")],-1)),e("div",Ht,[S(e("select",{"onUpdate:modelValue":m[0]||(m[0]=R=>g.value=R),class:"input narrow",onChange:v},[(o(!0),r(z,null,O(s.value,R=>(o(),r("option",{value:R.id,key:R.id},u(R.name),9,qt))),128))],544),[[ie,g.value]]),S(e("select",{"onUpdate:modelValue":m[1]||(m[1]=R=>t.value=R),class:"input narrow",onChange:B},[m[7]||(m[7]=e("option",{value:""},"ä¸»èœå•",-1)),(o(!0),r(z,null,O(h.value,R=>(o(),r("option",{value:R.id,key:R.id},u(R.name),9,jt))),128))],544),[[ie,t.value]]),S(e("input",{"onUpdate:modelValue":m[2]||(m[2]=R=>i.value=R),placeholder:"å¡ç‰‡æ ‡é¢˜",class:"input narrow"},null,512),[[E,i.value]]),S(e("input",{"onUpdate:modelValue":m[3]||(m[3]=R=>d.value=R),placeholder:"å¡ç‰‡é“¾æ¥",class:"input wide"},null,512),[[E,d.value]]),S(e("input",{"onUpdate:modelValue":m[4]||(m[4]=R=>C.value=R),placeholder:"logoé“¾æ¥(å¯é€‰)",class:"input wide"},null,512),[[E,C.value]]),e("button",{class:"btn",onClick:I},[...m[8]||(m[8]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 5v14M5 12h14"})],-1),K(" æ·»åŠ å¡ç‰‡ ",-1)])])])]),e("div",Gt,[e("table",Jt,[m[11]||(m[11]=e("thead",null,[e("tr",null,[e("th",null,"æ ‡é¢˜"),e("th",null,"ç½‘å€"),e("th",null,"Logoé“¾æ¥"),e("th",null,"æè¿°"),e("th",null,"æ ‡ç­¾"),e("th",null,"æ’åº"),e("th",null,"æ“ä½œ")])],-1)),e("tbody",null,[(o(!0),r(z,null,O(l.value,R=>(o(),r("tr",{key:R.id},[e("td",null,[S(e("input",{"onUpdate:modelValue":F=>R.title=F,onBlur:F=>H(R),class:"table-input"},null,40,Qt),[[E,R.title]])]),e("td",null,[S(e("input",{"onUpdate:modelValue":F=>R.url=F,onBlur:F=>H(R),class:"table-input"},null,40,Xt),[[E,R.url]])]),e("td",null,[S(e("input",{"onUpdate:modelValue":F=>R.logo_url=F,onBlur:F=>H(R),class:"table-input",placeholder:"logoé“¾æ¥(å¯é€‰)"},null,40,Yt),[[E,R.logo_url]])]),e("td",null,[S(e("input",{"onUpdate:modelValue":F=>R.desc=F,onBlur:F=>H(R),class:"table-input",placeholder:"æè¿°ï¼ˆå¯é€‰ï¼‰"},null,40,Zt),[[E,R.desc]])]),e("td",null,[e("div",{class:"tag-selector",onClick:F=>ee(R)},[R.tags&&R.tags.length>0?(o(),r("div",sn,[(o(!0),r(z,null,O(R.tags,F=>(o(),r("span",{key:F.id,class:"mini-tag",style:ve({backgroundColor:F.color})},u(F.name),5))),128))])):(o(),r("span",tn,"é€‰æ‹©æ ‡ç­¾"))],8,en)]),e("td",null,[S(e("input",{"onUpdate:modelValue":F=>R.order=F,type:"number",onBlur:F=>H(R),class:"table-input order-input"},null,40,nn),[[E,R.order,void 0,{number:!0}]])]),e("td",null,[e("button",{class:"btn btn-danger btn-icon",onClick:F=>X(R.id),title:"åˆ é™¤"},[...m[10]||(m[10]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),e("path",{d:"M10 11v6M14 11v6"})],-1)])],8,ln)])]))),128))])])]),k.value?(o(),r("div",{key:0,class:"modal-overlay",onClick:se},[e("div",{class:"modal-content",onClick:m[5]||(m[5]=oe(()=>{},["stop"]))},[e("div",{class:"modal-header"},[m[12]||(m[12]=e("h3",null,"é€‰æ‹©æ ‡ç­¾",-1)),e("button",{class:"close-btn",onClick:se},"Ã—")]),e("div",an,[c.value.length===0?(o(),r("div",on,[...m[13]||(m[13]=[e("p",null,"æš‚æ— æ ‡ç­¾ï¼Œè¯·å…ˆåœ¨æ ‡ç­¾ç®¡ç†é¡µé¢åˆ›å»º",-1)])])):(o(),r("div",rn,[(o(!0),r(z,null,O(c.value,R=>(o(),r("label",{key:R.id,class:"tag-option"},[e("input",{type:"checkbox",checked:_.value.includes(R.id),onChange:F=>ae(R.id)},null,40,dn),e("span",{class:"tag-label",style:ve({backgroundColor:R.color})},u(R.name),5)]))),128))]))]),e("div",{class:"modal-footer"},[e("button",{class:"btn btn-secondary",onClick:se},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:te},"ç¡®å®š")])])])):b("",!0),V.value?(o(),r("div",{key:1,class:"modal-overlay",onClick:L},[e("div",{class:"modal-content duplicate-modal",onClick:m[6]||(m[6]=oe(()=>{},["stop"]))},[e("div",{class:"modal-header"},[m[14]||(m[14]=ue('<div class="header-with-icon" data-v-14f25277><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#dc2626" stroke-width="2" data-v-14f25277><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" data-v-14f25277></path><line x1="12" y1="9" x2="12" y2="13" data-v-14f25277></line><line x1="12" y1="17" x2="12.01" y2="17" data-v-14f25277></line></svg><h3 data-v-14f25277>æ£€æµ‹åˆ°é‡å¤å¡ç‰‡</h3></div>',1)),e("button",{class:"close-btn",onClick:L},"Ã—")]),e("div",un,[m[24]||(m[24]=e("div",{class:"duplicate-warning"},[e("p",{class:"warning-text"},"æ‚¨è¦æ·»åŠ çš„å¡ç‰‡ä¸ä»¥ä¸‹ç°æœ‰å¡ç‰‡é‡å¤ï¼š")],-1)),e("div",cn,[e("div",vn,[m[18]||(m[18]=e("div",{class:"box-header"},[e("span",{class:"box-label"},"ç°æœ‰å¡ç‰‡")],-1)),e("div",pn,[e("div",mn,[m[15]||(m[15]=e("span",{class:"detail-label"},"æ ‡é¢˜ï¼š",-1)),e("span",hn,u((Q=w.value)==null?void 0:Q.title),1)]),e("div",gn,[m[16]||(m[16]=e("span",{class:"detail-label"},"ç½‘å€ï¼š",-1)),e("span",fn,u((ge=w.value)==null?void 0:ge.url),1)]),(fe=w.value)!=null&&fe.logo_url?(o(),r("div",yn,[m[17]||(m[17]=e("span",{class:"detail-label"},"Logoï¼š",-1)),e("span",kn,u((ye=w.value)==null?void 0:ye.logo_url),1)])):b("",!0)])]),m[23]||(m[23]=e("div",{class:"arrow-divider"},[e("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"#9ca3af","stroke-width":"2"},[e("path",{d:"M5 12h14M12 5l7 7-7 7"})])],-1)),e("div",bn,[m[22]||(m[22]=e("div",{class:"box-header"},[e("span",{class:"box-label"},"å¾…æ·»åŠ å¡ç‰‡")],-1)),e("div",wn,[e("div",_n,[m[19]||(m[19]=e("span",{class:"detail-label"},"æ ‡é¢˜ï¼š",-1)),e("span",Cn,u((ke=p.value)==null?void 0:ke.title),1)]),e("div",Mn,[m[20]||(m[20]=e("span",{class:"detail-label"},"ç½‘å€ï¼š",-1)),e("span",Sn,u((Z=p.value)==null?void 0:Z.url),1)]),(be=p.value)!=null&&be.logo_url?(o(),r("div",Un,[m[21]||(m[21]=e("span",{class:"detail-label"},"Logoï¼š",-1)),e("span",$n,u((we=p.value)==null?void 0:we.logo_url),1)])):b("",!0)])])]),m[25]||(m[25]=e("div",{class:"duplicate-actions-info"},[e("p",null,"è¯·é€‰æ‹©å¦‚ä½•å¤„ç†ï¼š")],-1))]),e("div",{class:"modal-footer duplicate-footer"},[e("button",{class:"btn btn-secondary",onClick:U},[...m[26]||(m[26]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M18 6L6 18M6 6l12 12"})],-1),K(" è·³è¿‡ ",-1)])]),e("button",{class:"btn btn-warning",onClick:D},[...m[27]||(m[27]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 12a9 9 0 11-9-9c2.52 0 4.93 1 6.74 2.74L21 8"}),e("path",{d:"M21 3v5h-5"})],-1),K(" æ›¿æ¢ ",-1)])]),e("button",{class:"btn btn-primary",onClick:P},[...m[28]||(m[28]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1),K(" ç¼–è¾‘åæ·»åŠ  ",-1)])])])])])):b("",!0)])}}},Tn=Y(xn,[["__scopeId","data-v-14f25277"]]),An={class:"duplicate-manage"},Vn={class:"section-header"},In=["disabled"],Bn={key:0,class:"duplicate-results"},Dn={class:"result-summary"},Pn={class:"summary-card"},Rn={class:"summary-value"},En={class:"summary-card warning"},Kn={class:"summary-value"},Ln={class:"summary-card danger"},Wn={class:"summary-value"},zn={class:"duplicate-groups"},On={class:"group-header"},Nn={class:"group-count"},Fn={class:"card-item original"},Hn={class:"card-info"},qn={class:"card-title"},jn={class:"card-url"},Gn={key:0,class:"card-desc"},Jn={class:"card-id"},Qn={class:"duplicates-list"},Xn={class:"card-info"},Yn={class:"card-title"},Zn={class:"card-url"},el={key:0,class:"card-desc"},sl={class:"card-actions"},tl={class:"card-id"},nl=["onClick","disabled"],ll={class:"group-actions"},al=["onClick","disabled"],il={class:"global-actions"},ol=["disabled"],rl={key:1,class:"no-duplicates"},dl={key:2,class:"initial-hint"},ul={key:3,class:"error"},cl={__name:"DuplicateManage",setup(a){const s=$(!1),l=$(!1),g=$(!1),t=$([]),i=$(0),d=$(0),C=$("");function c(){return x(this,null,function*(){var V,w;s.value=!0,C.value="";try{const p=yield ks();i.value=p.data.total,t.value=p.data.duplicateGroups,d.value=p.data.duplicateCount,g.value=!0}catch(p){C.value=((w=(V=p.response)==null?void 0:V.data)==null?void 0:w.error)||"æ£€æµ‹å¤±è´¥",console.error("æ£€æµ‹é‡å¤å¤±è´¥:",p)}finally{s.value=!1}})}function k(V){return x(this,null,function*(){var w,p,h;if(confirm("ç¡®å®šè¦åˆ é™¤è¿™å¼ å¡ç‰‡å—ï¼Ÿ")){l.value=!0,C.value="";try{console.log("[å»é‡ç®¡ç†] åˆ é™¤å•ä¸ªå¡ç‰‡:",V);const v=yield xe([V]);console.log("[å»é‡ç®¡ç†] åˆ é™¤å“åº”:",v.data),v.data.success?(console.log("[å»é‡ç®¡ç†] åˆ é™¤æˆåŠŸï¼Œé‡æ–°æ£€æµ‹..."),yield c()):C.value="åˆ é™¤å¤±è´¥ï¼š"+(v.data.message||"æœªçŸ¥é”™è¯¯")}catch(v){console.error("[å»é‡ç®¡ç†] åˆ é™¤å¡ç‰‡å¤±è´¥:",v),console.error("[å»é‡ç®¡ç†] é”™è¯¯è¯¦æƒ…:",(w=v.response)==null?void 0:w.data),C.value=((h=(p=v.response)==null?void 0:p.data)==null?void 0:h.error)||v.message||"åˆ é™¤å¤±è´¥"}finally{l.value=!1}}})}function y(V){return x(this,null,function*(){var p,h,v;const w=V.duplicates.length;if(confirm(`ç¡®å®šè¦åˆ é™¤è¿™ ${w} å¼ é‡å¤å¡ç‰‡å—ï¼Ÿ

å°†ä¿ç•™ï¼š${V.original.title}`)){l.value=!0,C.value="";try{const B=V.duplicates.map(I=>I.id);console.log("[å»é‡ç®¡ç†] åˆ é™¤ä¸€ç»„é‡å¤å¡ç‰‡:",B);const A=yield xe(B);console.log("[å»é‡ç®¡ç†] åˆ é™¤å“åº”:",A.data),A.data.success?(console.log("[å»é‡ç®¡ç†] åˆ é™¤æˆåŠŸï¼Œé‡æ–°æ£€æµ‹..."),yield c()):C.value="åˆ é™¤å¤±è´¥ï¼š"+(A.data.message||"æœªçŸ¥é”™è¯¯")}catch(B){console.error("[å»é‡ç®¡ç†] åˆ é™¤é‡å¤å¡ç‰‡å¤±è´¥:",B),console.error("[å»é‡ç®¡ç†] é”™è¯¯è¯¦æƒ…:",(p=B.response)==null?void 0:p.data),C.value=((v=(h=B.response)==null?void 0:h.data)==null?void 0:v.error)||B.message||"åˆ é™¤å¤±è´¥"}finally{l.value=!1}}})}function _(){return x(this,null,function*(){var w,p,h;const V=d.value;if(confirm(`ç¡®å®šè¦åˆ é™¤æ‰€æœ‰ ${V} å¼ é‡å¤å¡ç‰‡å—ï¼Ÿ

æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`)){l.value=!0,C.value="";try{const v=t.value.flatMap(A=>A.duplicates.map(I=>I.id));console.log("[å»é‡ç®¡ç†] åˆ é™¤æ‰€æœ‰é‡å¤å¡ç‰‡:",v);const B=yield xe(v);console.log("[å»é‡ç®¡ç†] åˆ é™¤å“åº”:",B.data),B.data.success?(console.log("[å»é‡ç®¡ç†] åˆ é™¤æˆåŠŸï¼Œé‡æ–°æ£€æµ‹..."),yield c()):C.value="åˆ é™¤å¤±è´¥ï¼š"+(B.data.message||"æœªçŸ¥é”™è¯¯")}catch(v){console.error("[å»é‡ç®¡ç†] åˆ é™¤æ‰€æœ‰é‡å¤å¤±è´¥:",v),console.error("[å»é‡ç®¡ç†] é”™è¯¯è¯¦æƒ…:",(w=v.response)==null?void 0:w.data),C.value=((h=(p=v.response)==null?void 0:p.data)==null?void 0:h.error)||v.message||"åˆ é™¤å¤±è´¥"}finally{l.value=!1}}})}return(V,w)=>(o(),r("div",An,[e("div",Vn,[w[0]||(w[0]=e("h3",null,"å¡ç‰‡å»é‡ç®¡ç†",-1)),e("button",{onClick:c,class:"btn btn-primary",disabled:s.value},u(s.value?"æ£€æµ‹ä¸­...":"ğŸ” ä¸€é”®æ£€æµ‹é‡å¤"),9,In)]),t.value.length>0?(o(),r("div",Bn,[e("div",Dn,[e("div",Pn,[w[1]||(w[1]=e("div",{class:"summary-label"},"æ€»å¡ç‰‡æ•°",-1)),e("div",Rn,u(i.value),1)]),e("div",En,[w[2]||(w[2]=e("div",{class:"summary-label"},"é‡å¤ç»„æ•°",-1)),e("div",Kn,u(t.value.length),1)]),e("div",Ln,[w[3]||(w[3]=e("div",{class:"summary-label"},"é‡å¤å¡ç‰‡",-1)),e("div",Wn,u(d.value),1)])]),e("div",zn,[(o(!0),r(z,null,O(t.value,(p,h)=>(o(),r("div",{key:h,class:"duplicate-group"},[e("div",On,[e("h4",null,"é‡å¤ç»„ "+u(h+1),1),e("span",Nn,u(p.totalCount)+" å¼ å¡ç‰‡",1)]),e("div",Fn,[w[4]||(w[4]=e("div",{class:"card-badge"},"ä¿ç•™",-1)),e("div",Hn,[e("div",qn,u(p.original.title),1),e("div",jn,u(p.original.url),1),p.original.desc?(o(),r("div",Gn,u(p.original.desc),1)):b("",!0)]),e("div",Jn,"ID: "+u(p.original.id),1)]),e("div",Qn,[(o(!0),r(z,null,O(p.duplicates,v=>(o(),r("div",{key:v.id,class:"card-item duplicate"},[w[5]||(w[5]=e("div",{class:"card-badge danger"},"é‡å¤",-1)),e("div",Xn,[e("div",Yn,u(v.title),1),e("div",Zn,u(v.url),1),v.desc?(o(),r("div",el,u(v.desc),1)):b("",!0)]),e("div",sl,[e("span",tl,"ID: "+u(v.id),1),e("button",{onClick:B=>k(v.id),class:"btn-remove",disabled:l.value,title:"åˆ é™¤æ­¤å¡ç‰‡"}," åˆ é™¤ ",8,nl)])]))),128))]),e("div",ll,[e("button",{onClick:v=>y(p),class:"btn btn-danger",disabled:l.value}," åˆ é™¤æ­¤ç»„æ‰€æœ‰é‡å¤å¡ç‰‡ ("+u(p.duplicates.length)+" å¼ ) ",9,al)])]))),128))]),e("div",il,[e("button",{onClick:_,class:"btn btn-danger btn-large",disabled:l.value},u(l.value?"åˆ é™¤ä¸­...":`åˆ é™¤æ‰€æœ‰é‡å¤å¡ç‰‡ (${d.value} å¼ )`),9,ol)])])):g.value&&t.value.length===0?(o(),r("div",rl,[...w[6]||(w[6]=[e("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"#1abc9c","stroke-width":"2"},[e("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e("polyline",{points:"22 4 12 14.01 9 11.01"})],-1),e("h3",null,"å¤ªæ£’äº†ï¼æ²¡æœ‰å‘ç°é‡å¤å¡ç‰‡",-1),e("p",null,"æ‚¨çš„å¯¼èˆªå¡ç‰‡éƒ½æ˜¯å”¯ä¸€çš„",-1)])])):g.value?b("",!0):(o(),r("div",dl,[...w[7]||(w[7]=[ue('<svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2" data-v-62bbc778><circle cx="12" cy="12" r="10" data-v-62bbc778></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" data-v-62bbc778></path><line x1="12" y1="17" x2="12.01" y2="17" data-v-62bbc778></line></svg><h3 data-v-62bbc778>ç‚¹å‡»&quot;ä¸€é”®æ£€æµ‹é‡å¤&quot;å¼€å§‹æ‰«æ</h3><p data-v-62bbc778>ç³»ç»Ÿå°†æ£€æµ‹æ‰€æœ‰é‡å¤çš„å¯¼èˆªå¡ç‰‡</p><ul class="hint-list" data-v-62bbc778><li data-v-62bbc778>ğŸ“Œ URL ç›¸åŒçš„å¡ç‰‡</li><li data-v-62bbc778>ğŸ“Œ æ ‡é¢˜ç›¸åŒä¸”åŸŸåç›¸åŒçš„å¡ç‰‡</li></ul>',4)])])),C.value?(o(),r("p",ul,u(C.value),1)):b("",!0)]))}},vl=Y(cl,[["__scopeId","data-v-62bbc778"]]),pl={class:"tag-manage"},ml={class:"tag-header"},hl={class:"tag-add"},gl={class:"tag-content"},fl={key:0,class:"empty-state"},yl={key:1,class:"tag-list"},kl={class:"tag-info"},bl=["onUpdate:modelValue","onBlur"],wl={class:"tag-stats"},_l={class:"card-count"},Cl={class:"tag-controls"},Ml=["onUpdate:modelValue","onChange"],Sl={class:"tag-order"},Ul=["onUpdate:modelValue","onBlur"],$l={class:"tag-actions"},xl=["onClick"],Tl={__name:"TagManage",setup(a){const s=$([]),l=$(""),g=$("#2566d8");he("TagManage",({isSelfChange:c})=>{c||t()}),le(t);function t(){return x(this,null,function*(){const c=yield Be();s.value=c.data;for(const k of s.value)try{const y=yield bs(k.id);k.cardCount=y.data.count}catch(y){k.cardCount=0}})}function i(){return x(this,null,function*(){var V,w;if(!l.value.trim())return;const c=s.value.length?Math.max(...s.value.map(p=>p.order||0)):0,k=l.value.trim(),y=g.value,_={id:Date.now(),name:k,color:y,order:c+1,cardCount:0,_temp:!0};s.value.push(_),l.value="",g.value="#2566d8";try{const p=yield ws({name:k,color:y,order:c+1}),h=s.value.findIndex(v=>v.id===_.id);h>-1&&(s.value[h]=ne(G({},p.data),{cardCount:0}))}catch(p){const h=s.value.findIndex(v=>v.id===_.id);h>-1&&s.value.splice(h,1),alert("æ·»åŠ æ ‡ç­¾å¤±è´¥ï¼š"+(((w=(V=p.response)==null?void 0:V.data)==null?void 0:w.error)||p.message))}})}function d(c){return x(this,null,function*(){var k,y;if(!c._temp)try{yield _s(c.id,{name:c.name,color:c.color,order:c.order})}catch(_){alert("æ›´æ–°æ ‡ç­¾å¤±è´¥ï¼š"+(((y=(k=_.response)==null?void 0:k.data)==null?void 0:y.error)||_.message)),t()}})}function C(c){return x(this,null,function*(){var V,w;const k=s.value.find(p=>p.id===c);if(!k)return;const y=k.cardCount>0?`ç¡®å®šè¦åˆ é™¤æ ‡ç­¾"${k.name}"å—ï¼Ÿè¿™å°†å–æ¶ˆ ${k.cardCount} å¼ å¡ç‰‡çš„å…³è”ã€‚`:`ç¡®å®šè¦åˆ é™¤æ ‡ç­¾"${k.name}"å—ï¼Ÿ`;if(!confirm(y))return;const _=s.value.findIndex(p=>p.id===c);_>-1&&s.value.splice(_,1);try{yield Cs(c)}catch(p){alert("åˆ é™¤æ ‡ç­¾å¤±è´¥ï¼š"+(((w=(V=p.response)==null?void 0:V.data)==null?void 0:w.error)||p.message)),t()}})}return(c,k)=>(o(),r("div",pl,[e("div",ml,[k[3]||(k[3]=e("div",{class:"header-content"},[e("h2",{class:"page-title"},"ç®¡ç†æ ‡ç­¾"),e("p",{class:"page-desc"},"ä¸ºå¡ç‰‡åˆ›å»ºå¤šç»´åº¦åˆ†ç±»æ ‡ç­¾")],-1)),e("div",hl,[S(e("input",{"onUpdate:modelValue":k[0]||(k[0]=y=>l.value=y),placeholder:"æ ‡ç­¾åç§°",class:"input",maxlength:"20"},null,512),[[E,l.value]]),S(e("input",{"onUpdate:modelValue":k[1]||(k[1]=y=>g.value=y),type:"color",class:"color-input",title:"é€‰æ‹©æ ‡ç­¾é¢œè‰²"},null,512),[[E,g.value]]),e("button",{class:"btn btn-primary",onClick:i},[...k[2]||(k[2]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 5v14M5 12h14"})],-1),K(" æ·»åŠ æ ‡ç­¾ ",-1)])])])]),e("div",gl,[s.value.length===0?(o(),r("div",fl,[...k[4]||(k[4]=[e("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1"},[e("path",{d:"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"}),e("line",{x1:"7",y1:"7",x2:"7.01",y2:"7"})],-1),e("p",null,"æš‚æ— æ ‡ç­¾",-1),e("p",{class:"hint"},"åˆ›å»ºç¬¬ä¸€ä¸ªæ ‡ç­¾ï¼Œå¼€å§‹ä¸ºå¡ç‰‡æ·»åŠ å¤šç»´åº¦åˆ†ç±»",-1)])])):(o(),r("div",yl,[(o(!0),r(z,null,O(s.value,y=>(o(),r("div",{key:y.id,class:"tag-item"},[e("div",{class:"tag-preview",style:ve({backgroundColor:y.color})},[...k[5]||(k[5]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"}),e("line",{x1:"7",y1:"7",x2:"7.01",y2:"7"})],-1)])],4),e("div",kl,[S(e("input",{"onUpdate:modelValue":_=>y.name=_,onBlur:_=>d(y),class:"tag-name-input",maxlength:"20"},null,40,bl),[[E,y.name]]),e("div",wl,[e("span",_l,u(y.cardCount||0)+" å¼ å¡ç‰‡",1)])]),e("div",Cl,[S(e("input",{"onUpdate:modelValue":_=>y.color=_,type:"color",onChange:_=>d(y),class:"color-picker",title:"æ›´æ”¹é¢œè‰²"},null,40,Ml),[[E,y.color]]),e("div",Sl,[k[6]||(k[6]=e("span",{class:"order-label"},"æ’åº",-1)),S(e("input",{"onUpdate:modelValue":_=>y.order=_,type:"number",onBlur:_=>d(y),class:"order-input"},null,40,Ul),[[E,y.order,void 0,{number:!0}]])])]),e("div",$l,[e("button",{class:"btn btn-danger btn-icon",onClick:_=>C(y.id),title:"åˆ é™¤æ ‡ç­¾"},[...k[7]||(k[7]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),e("path",{d:"M10 11v6M14 11v6"})],-1)])],8,xl)])]))),128))]))])]))}},Al=Y(Tl,[["__scopeId","data-v-10aa02ae"]]),Vl={class:"promo-manage"},Il={key:0,class:"loading-overlay"},Bl={class:"promo-header"},Dl={class:"promo-form"},Pl=["disabled"],Rl={class:"promo-section"},El={class:"promo-list"},Kl={key:0,class:"empty-state"},Ll={class:"promo-preview"},Wl=["src"],zl={class:"promo-info"},Ol={class:"promo-field"},Nl=["onUpdate:modelValue","onBlur"],Fl={class:"promo-field"},Hl=["onUpdate:modelValue","onBlur"],ql={class:"promo-actions"},jl=["onClick"],Gl={class:"promo-section"},Jl={class:"promo-list"},Ql={key:0,class:"empty-state"},Xl={class:"promo-preview"},Yl=["src"],Zl={class:"promo-info"},ea={class:"promo-field"},sa=["onUpdate:modelValue","onBlur"],ta={class:"promo-field"},na=["onUpdate:modelValue","onBlur"],la={class:"promo-actions"},aa=["onClick"],Me="/api",ia={__name:"PromoManage",setup(a){const s=()=>localStorage.getItem("token")||"",l=()=>({Authorization:`Bearer ${s()}`}),g=$([]),t=$(!1),i=$("åŠ è½½ä¸­..."),d=$({img:"",url:"",position:"left"}),C=ce(()=>g.value.filter(p=>p.position==="left")),c=ce(()=>g.value.filter(p=>p.position==="right"));he("PromoManage",({isSelfChange:p})=>{p||k()}),le(()=>{k()});function k(){return x(this,null,function*(){var p,h;t.value=!0,i.value="åŠ è½½ä¸­...";try{const v=yield _e.get(`${Me}/promos`);let B=[];Array.isArray(v.data)?B=v.data:v.data&&Array.isArray(v.data.data)&&(B=v.data.data),g.value=B}catch(v){console.error("åŠ è½½å®£ä¼ å¤±è´¥:",v),alert("åŠ è½½å®£ä¼ å¤±è´¥: "+(((h=(p=v.response)==null?void 0:p.data)==null?void 0:h.error)||v.message))}finally{t.value=!1}})}function y(){return x(this,null,function*(){var p,h;if(!d.value.img||!d.value.url){alert("è¯·å¡«å†™å®£ä¼ å›¾ç‰‡é“¾æ¥å’Œè·³è½¬é“¾æ¥");return}t.value=!0,i.value="æ·»åŠ ä¸­...";try{yield _e.post(`${Me}/promos`,d.value,{headers:l()}),d.value={img:"",url:"",position:"left"},yield k()}catch(v){alert("æ·»åŠ å¤±è´¥: "+(((h=(p=v.response)==null?void 0:p.data)==null?void 0:h.error)||v.message)),t.value=!1}})}function _(p){return x(this,null,function*(){var h,v;try{yield _e.put(`${Me}/promos/${p.id}`,{img:p.img,url:p.url},{headers:l()})}catch(B){alert("æ›´æ–°å¤±è´¥: "+(((v=(h=B.response)==null?void 0:h.data)==null?void 0:v.error)||B.message)),yield k()}})}function V(p){return x(this,null,function*(){var h,v;if(confirm("ç¡®å®šåˆ é™¤è¿™ä¸ªå®£ä¼ å—ï¼Ÿ")){t.value=!0,i.value="åˆ é™¤ä¸­...";try{yield _e.delete(`${Me}/promos/${p.id}`,{headers:l()}),yield k()}catch(B){alert("åˆ é™¤å¤±è´¥: "+(((v=(h=B.response)==null?void 0:h.data)==null?void 0:v.error)||B.message)),t.value=!1}}})}function w(p){p.target.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="60"><rect fill="%23f0f0f0" width="100" height="60"/><text x="50" y="35" text-anchor="middle" fill="%23999" font-size="12">å›¾ç‰‡åŠ è½½å¤±è´¥</text></svg>'}return(p,h)=>(o(),r("div",Vl,[t.value?(o(),r("div",Il,[h[3]||(h[3]=e("div",{class:"loading-spinner"},null,-1)),e("span",null,u(i.value),1)])):b("",!0),e("div",Bl,[h[5]||(h[5]=e("h2",{class:"page-title"},"å®£ä¼ ç®¡ç†",-1)),e("div",Dl,[S(e("input",{"onUpdate:modelValue":h[0]||(h[0]=v=>d.value.img=v),placeholder:"å®£ä¼ å›¾ç‰‡é“¾æ¥",class:"input"},null,512),[[E,d.value.img]]),S(e("input",{"onUpdate:modelValue":h[1]||(h[1]=v=>d.value.url=v),placeholder:"å®£ä¼ è·³è½¬é“¾æ¥",class:"input"},null,512),[[E,d.value.url]]),S(e("select",{"onUpdate:modelValue":h[2]||(h[2]=v=>d.value.position=v),class:"input select"},[...h[4]||(h[4]=[e("option",{value:"left"},"å·¦ä¾§å®£ä¼ ",-1),e("option",{value:"right"},"å³ä¾§å®£ä¼ ",-1)])],512),[[ie,d.value.position]]),e("button",{class:"btn btn-primary",onClick:y,disabled:!d.value.img||!d.value.url}," + æ·»åŠ å®£ä¼  ",8,Pl)])]),e("div",Rl,[h[8]||(h[8]=e("h3",{class:"section-title"},"ğŸ“ å·¦ä¾§å®£ä¼ ",-1)),e("div",El,[C.value.length===0?(o(),r("div",Kl,"æš‚æ— å·¦ä¾§å®£ä¼ ")):b("",!0),(o(!0),r(z,null,O(C.value,v=>(o(),r("div",{key:v.id,class:"promo-card"},[e("div",Ll,[e("img",{src:v.img,alt:"å®£ä¼ å›¾ç‰‡",onError:w},null,40,Wl)]),e("div",zl,[e("div",Ol,[h[6]||(h[6]=e("label",null,"å›¾ç‰‡é“¾æ¥",-1)),S(e("input",{"onUpdate:modelValue":B=>v.img=B,class:"input",onBlur:B=>_(v)},null,40,Nl),[[E,v.img]])]),e("div",Fl,[h[7]||(h[7]=e("label",null,"è·³è½¬é“¾æ¥",-1)),S(e("input",{"onUpdate:modelValue":B=>v.url=B,class:"input",onBlur:B=>_(v)},null,40,Hl),[[E,v.url]])])]),e("div",ql,[e("button",{class:"btn btn-danger",onClick:B=>V(v)},"åˆ é™¤",8,jl)])]))),128))])]),e("div",Gl,[h[11]||(h[11]=e("h3",{class:"section-title"},"ğŸ“ å³ä¾§å®£ä¼ ",-1)),e("div",Jl,[c.value.length===0?(o(),r("div",Ql,"æš‚æ— å³ä¾§å®£ä¼ ")):b("",!0),(o(!0),r(z,null,O(c.value,v=>(o(),r("div",{key:v.id,class:"promo-card"},[e("div",Xl,[e("img",{src:v.img,alt:"å®£ä¼ å›¾ç‰‡",onError:w},null,40,Yl)]),e("div",Zl,[e("div",ea,[h[9]||(h[9]=e("label",null,"å›¾ç‰‡é“¾æ¥",-1)),S(e("input",{"onUpdate:modelValue":B=>v.img=B,class:"input",onBlur:B=>_(v)},null,40,sa),[[E,v.img]])]),e("div",ta,[h[10]||(h[10]=e("label",null,"è·³è½¬é“¾æ¥",-1)),S(e("input",{"onUpdate:modelValue":B=>v.url=B,class:"input",onBlur:B=>_(v)},null,40,na),[[E,v.url]])])]),e("div",la,[e("button",{class:"btn btn-danger",onClick:B=>V(v)},"åˆ é™¤",8,aa)])]))),128))])])]))}},oa=Y(ia,[["__scopeId","data-v-05183044"]]),ra={class:"friend-manage"},da={class:"friend-add"},ua={class:"friend-card"},ca={class:"friend-table"},va=["onUpdate:modelValue","onBlur"],pa=["onUpdate:modelValue","onBlur"],ma=["onUpdate:modelValue","onBlur"],ha=["onClick"],ga={__name:"FriendLinkManage",setup(a){const s=$([]),l=$(""),g=$(""),t=$("");he("FriendLinkManage",({isSelfChange:k})=>{k||i()}),le(i);function i(){return x(this,null,function*(){const k=yield Ms();s.value=k.data})}function d(){return x(this,null,function*(){!l.value||!g.value||(yield Ss({title:l.value,url:g.value,logo:t.value}),l.value="",g.value="",t.value="",i())})}function C(k){return x(this,null,function*(){yield Us(k.id,{title:k.title,url:k.url,logo:k.logo}),i()})}function c(k){return x(this,null,function*(){if(!confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå‹é“¾å—ï¼Ÿ"))return;const y=s.value.findIndex(_=>_.id===k);y>-1&&s.value.splice(y,1);try{yield $s(k)}catch(_){console.error("åˆ é™¤å‹é“¾å¤±è´¥:",_),yield i()}})}return(k,y)=>(o(),r("div",ra,[y[4]||(y[4]=e("div",{class:"friend-header"},null,-1)),e("div",da,[S(e("input",{"onUpdate:modelValue":y[0]||(y[0]=_=>l.value=_),placeholder:"ç½‘ç«™å",class:"input"},null,512),[[E,l.value]]),S(e("input",{"onUpdate:modelValue":y[1]||(y[1]=_=>g.value=_),placeholder:"ç½‘ç«™é“¾æ¥",class:"input"},null,512),[[E,g.value]]),S(e("input",{"onUpdate:modelValue":y[2]||(y[2]=_=>t.value=_),placeholder:"logoé“¾æ¥(å¯é€‰)",class:"input"},null,512),[[E,t.value]]),e("button",{class:"btn",onClick:d},"æ·»åŠ å‹é“¾")]),e("div",ua,[e("table",ca,[y[3]||(y[3]=e("thead",null,[e("tr",null,[e("th",null,"ç½‘ç«™å"),e("th",null,"é“¾æ¥"),e("th",null,"Logo"),e("th",null,"æ“ä½œ")])],-1)),e("tbody",null,[(o(!0),r(z,null,O(s.value,_=>(o(),r("tr",{key:_.id},[e("td",null,[S(e("input",{"onUpdate:modelValue":V=>_.title=V,onBlur:V=>C(_),class:"input"},null,40,va),[[E,_.title]])]),e("td",null,[S(e("input",{"onUpdate:modelValue":V=>_.url=V,onBlur:V=>C(_),class:"input"},null,40,pa),[[E,_.url]])]),e("td",null,[S(e("input",{"onUpdate:modelValue":V=>_.logo=V,onBlur:V=>C(_),class:"input",placeholder:"logoé“¾æ¥(å¯é€‰)"},null,40,ma),[[E,_.logo]])]),e("td",null,[e("button",{class:"btn btn-danger",onClick:V=>c(_.id)},"åˆ é™¤",8,ha)])]))),128))])])])]))}},fa=Y(ga,[["__scopeId","data-v-235545e3"]]),ya={class:"user-manage"},ka={class:"user-card"},ba={class:"username-section"},wa={class:"username-form"},_a={class:"current-username"},Ca={class:"username-display"},Ma={class:"form-group"},Sa={class:"form-actions"},Ua=["disabled"],$a={class:"password-section"},xa={class:"password-form"},Ta={class:"form-group"},Aa={class:"form-group"},Va={class:"form-group"},Ia={class:"form-actions"},Ba=["disabled"],Da={__name:"UserManage",setup(a){const s=$(""),l=$(""),g=$(""),t=$(!1),i=$(""),d=$("success"),C=$({}),c=$(""),k=$(!1),y=$(""),_=$("success");le(()=>x(null,null,function*(){yield V()}));function V(){return x(this,null,function*(){try{const B=yield xs();C.value=B.data.data||B.data}catch(B){console.error("è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:",B)}})}function w(){return x(this,null,function*(){var B,A;if(!c.value){p("è¯·è¾“å…¥æ–°ç”¨æˆ·å","error");return}if(c.value.length<3||c.value.length>20){p("ç”¨æˆ·åé•¿åº¦åº”ä¸º3-20ä½","error");return}if(c.value===C.value.username){p("æ–°ç”¨æˆ·åä¸èƒ½ä¸å½“å‰ç”¨æˆ·åç›¸åŒ","error");return}k.value=!0,y.value="";try{yield Ts(c.value),p("ç”¨æˆ·åä¿®æ”¹æˆåŠŸï¼2ç§’åè‡ªåŠ¨é€€å‡ºï¼Œè¯·ä½¿ç”¨æ–°ç”¨æˆ·åé‡æ–°ç™»å½•...","success"),c.value="",setTimeout(()=>{localStorage.removeItem("token"),window.location.href="/admin"},2e3)}catch(I){p(((A=(B=I.response)==null?void 0:B.data)==null?void 0:A.message)||"ç”¨æˆ·åä¿®æ”¹å¤±è´¥","error")}finally{k.value=!1}})}function p(B,A){y.value=B,_.value=A,setTimeout(()=>{y.value=""},3e3)}function h(){return x(this,null,function*(){var B,A;if(!s.value||!l.value||!g.value){v("è¯·å¡«å†™æ‰€æœ‰å¯†ç å­—æ®µ","error");return}if(l.value!==g.value){v("ä¸¤æ¬¡è¾“å…¥çš„æ–°å¯†ç ä¸ä¸€è‡´","error");return}if(l.value.length<6){v("æ–°å¯†ç é•¿åº¦è‡³å°‘6ä½","error");return}t.value=!0,i.value="";try{yield As(s.value,l.value),v("å¯†ç ä¿®æ”¹æˆåŠŸ","success"),s.value="",l.value="",g.value=""}catch(I){v(((A=(B=I.response)==null?void 0:B.data)==null?void 0:A.message)||"å¯†ç ä¿®æ”¹å¤±è´¥","error")}finally{t.value=!1}})}function v(B,A){i.value=B,d.value=A,B==="å¯†ç ä¿®æ”¹æˆåŠŸ"&&A==="success"?setTimeout(()=>{i.value="2ç§’åè‡ªåŠ¨é€€å‡ºç™»å½•,è¯·ä½¿ç”¨æ–°å¯†ç é‡æ–°ç™»å½•...",setTimeout(()=>{localStorage.removeItem("token"),window.location.reload()},2e3)},500):setTimeout(()=>{i.value=""},3e3)}return(B,A)=>(o(),r("div",ya,[A[11]||(A[11]=e("div",{class:"user-header"},null,-1)),e("div",ka,[e("div",ba,[A[6]||(A[6]=e("h3",{class:"section-title"},"ä¿®æ”¹ç”¨æˆ·å",-1)),e("div",wa,[e("div",_a,[A[4]||(A[4]=e("label",null,"å½“å‰ç”¨æˆ·åï¼š",-1)),e("span",Ca,u(C.value.username||"admin"),1)]),e("div",Ma,[A[5]||(A[5]=e("label",null,"æ–°ç”¨æˆ·åï¼š",-1)),S(e("input",{"onUpdate:modelValue":A[0]||(A[0]=I=>c.value=I),type:"text",placeholder:"è¯·è¾“å…¥æ–°ç”¨æˆ·åï¼ˆ3-20ä½ï¼‰",class:"input"},null,512),[[E,c.value]])]),e("div",Sa,[e("button",{onClick:w,class:"btn",disabled:k.value},u(k.value?"ä¿®æ”¹ä¸­...":"ä¿®æ”¹ç”¨æˆ·å"),9,Ua)]),y.value?(o(),r("p",{key:0,class:W(["message",_.value])},u(y.value),3)):b("",!0)])]),e("div",$a,[A[10]||(A[10]=e("h3",{class:"section-title"},"ä¿®æ”¹å¯†ç ",-1)),e("div",xa,[e("div",Ta,[A[7]||(A[7]=e("label",null,"å½“å‰å¯†ç ï¼š",-1)),S(e("input",{"onUpdate:modelValue":A[1]||(A[1]=I=>s.value=I),type:"password",placeholder:"è¯·è¾“å…¥å½“å‰å¯†ç ",class:"input"},null,512),[[E,s.value]])]),e("div",Aa,[A[8]||(A[8]=e("label",null,"æ–°å¯†ç ï¼š",-1)),S(e("input",{"onUpdate:modelValue":A[2]||(A[2]=I=>l.value=I),type:"password",placeholder:"è¯·è¾“å…¥æ–°å¯†ç ",class:"input"},null,512),[[E,l.value]])]),e("div",Va,[A[9]||(A[9]=e("label",null,"ç¡®è®¤æ–°å¯†ç ï¼š",-1)),S(e("input",{"onUpdate:modelValue":A[3]||(A[3]=I=>g.value=I),type:"password",placeholder:"è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ",class:"input"},null,512),[[E,g.value]])]),e("div",Ia,[e("button",{onClick:h,class:"btn",disabled:t.value},u(t.value?"ä¿®æ”¹ä¸­...":"ä¿®æ”¹å¯†ç "),9,Ba)]),i.value?(o(),r("p",{key:0,class:W(["message",d.value])},u(i.value),3)):b("",!0)])])])]))}},Pa=Y(Da,[["__scopeId","data-v-40392133"]]),Ra={class:"backup-manage"},Ea={class:"tabs"},Ka={class:"tab-content"},La={class:"toolbar"},Wa=["disabled"],za=["disabled"],Oa=["disabled"],Na={class:"backup-list"},Fa={key:0,class:"empty-state"},Ha={key:1,class:"backup-grid"},qa={class:"backup-info"},ja={class:"backup-name"},Ga={class:"backup-meta"},Ja={class:"backup-size"},Qa={class:"backup-date"},Xa={key:0,class:"backup-signed",title:"å·²ç­¾åéªŒè¯"},Ya={key:1,class:"backup-unsigned",title:"æœªç­¾åï¼ˆå¤–éƒ¨ä¸Šä¼ ï¼‰"},Za={class:"backup-actions"},ei=["onClick"],si=["onClick"],ti=["onClick"],ni=["onClick"],li={class:"tab-content"},ai={class:"toolbar"},ii=["disabled"],oi=["disabled"],ri={key:1,class:"info-box"},di={class:"backup-list"},ui={key:0,class:"empty-state"},ci={key:1,class:"backup-grid"},vi={class:"backup-info"},pi={class:"backup-name"},mi={class:"backup-meta"},hi={class:"backup-size"},gi={class:"backup-date"},fi={class:"backup-actions"},yi=["onClick"],ki=["onClick"],bi={class:"tab-content"},wi={class:"config-section"},_i={class:"config-card"},Ci={class:"config-header"},Mi={class:"switch"},Si={key:0,class:"config-fields"},Ui={class:"field-row"},$i={class:"field-row"},xi={class:"config-card"},Ti={class:"config-header"},Ai={class:"switch"},Vi={key:0,class:"config-fields"},Ii={class:"field-row"},Bi={class:"time-input"},Di={class:"field-row"},Pi={class:"field-row checkbox-row"},Ri={class:"checkbox-label"},Ei={class:"config-card"},Ki={class:"config-header"},Li={class:"switch"},Wi={class:"config-info"},zi={key:0,class:"warning-text"},Oi={key:0,class:"config-fields"},Ni={class:"field-row checkbox-row"},Fi={class:"checkbox-label"},Hi={class:"field-row checkbox-row"},qi={class:"checkbox-label"},ji={class:"config-card"},Gi={class:"config-header"},Ji={class:"switch"},Qi={key:0,class:"stats-card"},Xi={class:"stats-grid"},Yi={class:"stat-item"},Zi={class:"stat-value"},eo={class:"stat-item"},so={class:"stat-value"},to={class:"stat-item"},no={class:"stat-value"},lo={class:"stat-item"},ao={class:"stat-value"},io={class:"config-actions"},oo=["disabled"],ro={key:0,class:"modal-overlay"},uo={class:"modal-content config-modal"},co={class:"form-group"},vo={class:"form-group"},po={class:"form-group"},mo=["placeholder"],ho={key:0},go={key:1},fo={class:"modal-actions"},yo=["disabled"],ko={key:1,class:"modal-overlay"},bo={class:"modal-content"},wo={style:{"white-space":"pre-line"}},_o={class:"modal-actions"},Co=["disabled"],Mo=["disabled"],So={key:2,class:"modal-overlay"},Uo={class:"modal-content config-modal"},$o={class:"form-group"},xo={class:"form-group"},To={class:"modal-actions"},Ao=["disabled"],Vo={key:3,class:"modal-overlay"},Io={class:"modal-content config-modal"},Bo={class:"form-group"},Do={class:"modal-actions"},Po=["disabled"],Ro={__name:"BackupManage",setup(a){const s=$("local"),l=$([]),g=$([]),t=$(!1),i=$(!1),d=$(!1),C=$(null),c=re({create:!1,list:!1,delete:!1,restore:!1,upload:!1,rename:!1,webdavConfig:!1,webdavBackup:!1,webdavList:!1,webdavRestore:!1,webdavDelete:!1,autoBackupConfig:!1}),k=re({name:"",description:""}),y=re({oldName:"",newName:""}),_=$({text:"",type:""}),V=re({show:!1,filename:"",action:null,title:"",message:"",confirmClass:"",signed:!0,processing:!1}),w=re({configured:!1,url:"",username:""}),p=re({url:"",username:"",password:""}),h=re({debounce:{enabled:!0,delay:5,keep:5},scheduled:{enabled:!0,hour:2,minute:0,keep:7,onlyIfModified:!0},webdav:{enabled:!1,syncDaily:!0,syncIncremental:!0},autoClean:!0}),v=$(null),B=localStorage.getItem("token");function A(q){return x(this,arguments,function*(M,n={}){return(yield fetch(M,ne(G({},n),{headers:G({Authorization:`Bearer ${B}`,"Content-Type":"application/json"},n.headers)}))).json()})}const I=(M,n="success",q=4e3)=>{_.value={text:M,type:n},setTimeout(()=>{_.value={text:"",type:""}},n==="error"?6e3:q)};function H(){try{window.dispatchEvent(new CustomEvent("nav-menus-updated")),console.log("[å¤‡ä»½ç®¡ç†] å·²é€šçŸ¥æ‰©å±•åˆ·æ–°å³é”®èœå•")}catch(M){console.warn("[å¤‡ä»½ç®¡ç†] é€šçŸ¥æ‰©å±•å¤±è´¥:",M)}}function X(){return x(this,null,function*(){try{const M=yield A("/api/ai/config/verify");M.success&&(M.status==="decrypt_failed"?(I("âš ï¸ AI é…ç½®æ¢å¤å¼‚å¸¸ï¼šAPI Key è§£å¯†å¤±è´¥ï¼Œè¯·å‰å¾€ AI è®¾ç½®é‡æ–°é…ç½®","warning",8e3),setTimeout(()=>{confirm(`AI é…ç½®çš„ API Key è§£å¯†å¤±è´¥ï¼Œå¯èƒ½æ˜¯å› ä¸ºå¤‡ä»½æ¥è‡ªä¸åŒçš„æœåŠ¡å™¨ã€‚

æ˜¯å¦ç°åœ¨å‰å¾€ AI è®¾ç½®é¡µé¢é‡æ–°é…ç½®ï¼Ÿ`)&&(window.location.href="/admin/ai-settings")},1e3)):M.status==="ok"&&console.log("[å¤‡ä»½ç®¡ç†] AI é…ç½®éªŒè¯é€šè¿‡"))}catch(M){console.warn("[å¤‡ä»½ç®¡ç†] AI é…ç½®éªŒè¯å¤±è´¥:",M)}})}const ee=()=>{k.name="",k.description="",i.value=!0},se=()=>x(null,null,function*(){c.create=!0;const M=yield A("/api/backup/create",{method:"POST",body:JSON.stringify({name:k.name||null,description:k.description||null})});M.success?(I("å¤‡ä»½åˆ›å»ºæˆåŠŸï¼"),i.value=!1,yield N()):I(M.message||"å¤‡ä»½åˆ›å»ºå¤±è´¥","error"),c.create=!1}),ae=M=>{y.oldName=M,y.newName=M.replace(".zip",""),d.value=!0},te=()=>x(null,null,function*(){if(!y.newName.trim()){I("è¯·è¾“å…¥æ–°åç§°","error");return}c.rename=!0;const M=yield A(`/api/backup/rename/${y.oldName}`,{method:"PUT",body:JSON.stringify({newName:y.newName})});M.success?(I("é‡å‘½åæˆåŠŸï¼"),d.value=!1,yield N()):I(M.message||"é‡å‘½åå¤±è´¥","error"),c.rename=!1}),N=()=>x(null,null,function*(){c.list=!0;const M=yield A("/api/backup/list");M.success?l.value=M.backups:I("è·å–å¤‡ä»½åˆ—è¡¨å¤±è´¥","error"),c.list=!1}),L=M=>{window.open(`/api/backup/download/${M}?token=${B}`,"_blank")},U=(M,n)=>{const q=typeof n=="object"?n:{name:n},T=q.name;V.show=!0,V.filename=T,V.action=M,V.signed=q.signed,V.processing=!1,M==="delete"?(V.title="åˆ é™¤",V.message=`ç¡®å®šè¦åˆ é™¤å¤‡ä»½æ–‡ä»¶ ${T} å—ï¼Ÿ`,V.confirmClass="btn-danger"):M==="restore"?(V.title="æ¢å¤",q.signed?V.message=`ç¡®å®šè¦æ¢å¤å¤‡ä»½æ–‡ä»¶ ${T} å—ï¼Ÿ`:V.message=`âš ï¸ è­¦å‘Šï¼šæ­¤å¤‡ä»½æ–‡ä»¶æœªç­¾åï¼ˆå¯èƒ½æ˜¯å¤–éƒ¨ä¸Šä¼ çš„ï¼‰ï¼Œæ— æ³•éªŒè¯å…¶å®Œæ•´æ€§ã€‚

ç¡®å®šè¦æ¢å¤å¤‡ä»½æ–‡ä»¶ ${T} å—ï¼Ÿ`,V.confirmClass="btn-restore"):M==="webdav-restore"?(V.title="ä»WebDAVæ¢å¤",V.message=`ç¡®å®šè¦ä»WebDAVæ¢å¤å¤‡ä»½ ${T} å—ï¼Ÿè¿™å°†è¦†ç›–å½“å‰æ•°æ®ã€‚`,V.confirmClass="btn-restore"):M==="webdav-delete"&&(V.title="åˆ é™¤WebDAVå¤‡ä»½",V.message=`ç¡®å®šè¦åˆ é™¤WebDAVå¤‡ä»½ ${T} å—ï¼Ÿ`,V.confirmClass="btn-danger")},D=()=>x(null,null,function*(){const{action:M,filename:n,signed:q}=V;V.show=!1,V.processing=!1;try{if(M==="delete"){I("æ­£åœ¨åˆ é™¤å¤‡ä»½...");const T=yield A(`/api/backup/delete/${n}`,{method:"DELETE"});T.success?(I("âœ“ åˆ é™¤æˆåŠŸ"),yield N()):I("âœ— "+(T.message||"åˆ é™¤å¤±è´¥"),"error")}else if(M==="restore"){I("æ­£åœ¨æ¢å¤å¤‡ä»½ï¼Œè¯·ç¨å€™...");const T=q?{}:{forceRestore:!0},j=yield A(`/api/backup/restore/${n}`,{method:"POST",body:JSON.stringify(T)});if(j.success)I("âœ“ å¤‡ä»½å·²æ¢å¤ï¼Œæ­£åœ¨é‡æ–°åŠ è½½æ•°æ®..."),yield new Promise(pe=>setTimeout(pe,2e3)),yield Promise.all([N(),Q(),Z(),R()]),H(),j.checkAIConfig&&(yield X()),I("âœ“ æ¢å¤å®Œæˆï¼æ•°æ®å·²æ›´æ–°","success",5e3);else if(j.requireConfirm&&j.code==="NO_SIGNATURE"){if(confirm(j.message+`

ç‚¹å‡»"ç¡®å®š"ç»§ç»­æ¢å¤ï¼Œç‚¹å‡»"å–æ¶ˆ"æ”¾å¼ƒæ“ä½œã€‚`)){const pe=yield A(`/api/backup/restore/${n}`,{method:"POST",body:JSON.stringify({forceRestore:!0})});pe.success?(I("âœ“ å¤‡ä»½å·²æ¢å¤ï¼Œæ­£åœ¨é‡æ–°åŠ è½½æ•°æ®..."),yield new Promise(Xe=>setTimeout(Xe,2e3)),yield Promise.all([N(),Q(),Z(),R()]),H(),pe.checkAIConfig&&(yield X()),I("âœ“ æ¢å¤å®Œæˆï¼æ•°æ®å·²æ›´æ–°","success",5e3)):I("âœ— "+(pe.message||"æ¢å¤å¤±è´¥"),"error")}}else I("âœ— "+(j.message||"æ¢å¤å¤±è´¥"),"error")}else M==="webdav-restore"?yield be(n):M==="webdav-delete"&&(yield we(n))}catch(T){I("âœ— æ“ä½œå¤±è´¥: "+T.message,"error")}}),P=M=>M?new Date(M).toLocaleString("zh-CN",{hour12:!1}):"--",f=()=>{C.value.click()},m=M=>x(null,null,function*(){const n=M.target.files[0];if(n){if(!n.name.endsWith(".zip")){I("åªæ”¯æŒ.zipæ ¼å¼çš„å¤‡ä»½æ–‡ä»¶","error"),M.target.value="";return}if(n.size>500*1024*1024){I("å¤‡ä»½æ–‡ä»¶è¿‡å¤§ï¼Œæœ€å¤§æ”¯æŒ500MB","error"),M.target.value="";return}c.upload=!0;try{const q=new FormData;q.append("backup",n);const j=yield(yield fetch("/api/backup/upload",{method:"POST",headers:{Authorization:`Bearer ${B}`},body:q})).json();j.success?(I("å¤‡ä»½æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼"),yield N()):I(j.message||"å¤‡ä»½æ–‡ä»¶ä¸Šä¼ å¤±è´¥","error")}catch(q){console.error("ä¸Šä¼ å¤±è´¥:",q),I("å¤‡ä»½æ–‡ä»¶ä¸Šä¼ å¤±è´¥","error")}finally{c.upload=!1,M.target.value=""}}}),Q=()=>x(null,null,function*(){const M=yield A("/api/backup/webdav/config");M.success&&M.config&&(w.configured=M.config.configured,w.url=M.config.url||"",w.username=M.config.username||"")}),ge=()=>x(null,null,function*(){yield Q(),p.url=w.url,p.username=w.username,p.password="",t.value=!0}),fe=()=>x(null,null,function*(){if(!p.url||!p.username){I("è¯·å¡«å†™URLå’Œç”¨æˆ·å","error");return}if(!w.configured&&!p.password){I("é¦–æ¬¡é…ç½®æ—¶å¯†ç ä¸èƒ½ä¸ºç©º","error");return}c.webdavConfig=!0;const M=yield A("/api/backup/webdav/config",{method:"POST",body:JSON.stringify(p)});M.success?(t.value=!1,yield Q(),w.configured?(yield Z(),yield R(),h.webdav.enabled?I("WebDAVé…ç½®ä¿å­˜æˆåŠŸï¼"):(h.webdav.enabled=!0,(yield A("/api/backup/auto/config",{method:"POST",body:JSON.stringify(h)})).success?I("WebDAVé…ç½®ä¿å­˜æˆåŠŸï¼Œå·²è‡ªåŠ¨å¼€å¯WebDAVè‡ªåŠ¨åŒæ­¥ï¼"):I("WebDAVé…ç½®ä¿å­˜æˆåŠŸï¼Œä½†è‡ªåŠ¨åŒæ­¥å¼€å¯å¤±è´¥","error"))):I("WebDAVé…ç½®ä¿å­˜æˆåŠŸï¼")):I(M.message||"WebDAVé…ç½®ä¿å­˜å¤±è´¥","error"),c.webdavConfig=!1}),ye=()=>x(null,null,function*(){c.webdavBackup=!0;const M=yield A("/api/backup/webdav/backup",{method:"POST"});M.success?(I("å¤‡ä»½åˆ°WebDAVæˆåŠŸï¼"),yield Z()):(I(M.message||"å¤‡ä»½åˆ°WebDAVå¤±è´¥","error"),M.needReconfigure&&(w.configured=!1,w.url="",w.username="")),c.webdavBackup=!1}),ke=M=>{M.target.checked&&!w.configured&&(h.webdav.enabled=!1,I('è¯·å…ˆåœ¨"WebDAVå¤‡ä»½"æ ‡ç­¾é¡µé…ç½®WebDAVè¿æ¥',"error"),s.value="webdav")},Z=()=>x(null,null,function*(){c.webdavList=!0;const M=yield A("/api/backup/webdav/list");M.success?(g.value=M.backups||[],M.configured===!1&&(w.configured=!1,w.url="",w.username="",M.message&&I(M.message,"error"))):I(M.message||"è·å–WebDAVå¤‡ä»½åˆ—è¡¨å¤±è´¥","error"),c.webdavList=!1}),be=M=>x(null,null,function*(){I("æ­£åœ¨ä» WebDAV æ¢å¤å¤‡ä»½ï¼Œè¯·ç¨å€™..."),c.webdavRestore=!0;try{const n=yield A("/api/backup/webdav/restore",{method:"POST",body:JSON.stringify({filename:M})});n.success?(I("âœ“ å¤‡ä»½å·²æ¢å¤ï¼Œæ­£åœ¨é‡æ–°åŠ è½½æ•°æ®..."),yield new Promise(q=>setTimeout(q,2e3)),yield Promise.all([N(),Q(),Z(),R()]),H(),n.checkAIConfig&&(yield X()),I("âœ“ æ¢å¤å®Œæˆï¼æ•°æ®å·²æ›´æ–°","success",5e3)):(I("âœ— "+(n.message||"ä» WebDAV æ¢å¤å¤±è´¥"),"error"),n.needReconfigure&&(w.configured=!1,w.url="",w.username=""))}catch(n){I("âœ— æ¢å¤å¤±è´¥: "+n.message,"error")}finally{c.webdavRestore=!1}}),we=M=>x(null,null,function*(){I("æ­£åœ¨åˆ é™¤ WebDAV å¤‡ä»½..."),c.webdavDelete=!0;try{const n=yield A(`/api/backup/webdav/delete/${M}`,{method:"DELETE"});n.success?(I("âœ“ åˆ é™¤æˆåŠŸ"),yield Z()):(I("âœ— "+(n.message||"åˆ é™¤å¤±è´¥"),"error"),n.needReconfigure&&(w.configured=!1,w.url="",w.username=""))}catch(n){I("âœ— åˆ é™¤å¤±è´¥: "+n.message,"error")}finally{c.webdavDelete=!1}}),R=()=>x(null,null,function*(){const M=yield A("/api/backup/auto/config");M.success&&M.config?(Object.assign(h,M.config),v.value=M.stats||null):I("åŠ è½½è‡ªåŠ¨å¤‡ä»½é…ç½®å¤±è´¥","error")}),F=()=>x(null,null,function*(){c.autoBackupConfig=!0;const M=yield A("/api/backup/auto/config",{method:"POST",body:JSON.stringify(h)});M.success?(I("è‡ªåŠ¨å¤‡ä»½é…ç½®ä¿å­˜æˆåŠŸï¼"),yield R()):I(M.message||"è‡ªåŠ¨å¤‡ä»½é…ç½®ä¿å­˜å¤±è´¥","error"),c.autoBackupConfig=!1}),Je=()=>{if(!h.scheduled.enabled)return"æœªå¯ç”¨";const M=String(h.scheduled.hour).padStart(2,"0"),n=String(h.scheduled.minute).padStart(2,"0");return`æ¯å¤© ${M}:${n}`},Qe=()=>{confirm("ç¡®å®šè¦æ¢å¤ä¸ºé»˜è®¤é…ç½®å—ï¼Ÿè¿™å°†é‡ç½®æ‰€æœ‰è‡ªåŠ¨å¤‡ä»½è®¾ç½®ã€‚")&&(h.debounce={enabled:!0,delay:5,keep:5},h.scheduled={enabled:!0,hour:2,minute:0,keep:7,onlyIfModified:!0},h.webdav={enabled:!1,syncDaily:!0,syncIncremental:!0},h.autoClean=!0,I('å·²æ¢å¤é»˜è®¤é…ç½®ï¼Œè¯·ç‚¹å‡»"ä¿å­˜é…ç½®"ä»¥ç”Ÿæ•ˆ'))};return le(()=>x(null,null,function*(){yield N(),yield Q(),w.configured&&(yield Z()),yield R()})),(M,n)=>{var q;return o(),r("div",Ra,[e("div",Ea,[e("button",{class:W(["tab",{active:s.value==="local"}]),onClick:n[0]||(n[0]=T=>s.value="local")}," ğŸ“¦ æœ¬åœ°å¤‡ä»½ ",2),e("button",{class:W(["tab",{active:s.value==="webdav"}]),onClick:n[1]||(n[1]=T=>s.value="webdav")}," â˜ï¸ WebDAVå¤‡ä»½ ",2),e("button",{class:W(["tab",{active:s.value==="auto"}]),onClick:n[2]||(n[2]=T=>s.value="auto")}," âš™ï¸ è‡ªåŠ¨å¤‡ä»½é…ç½® ",2)]),S(e("div",Ka,[e("div",La,[e("button",{class:"btn btn-primary",onClick:ee,disabled:c.create},[n[25]||(n[25]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"})],-1)),K(" "+u(c.create?"å¤‡ä»½ä¸­...":"åˆ›å»ºå¤‡ä»½"),1)],8,Wa),e("button",{class:"btn btn-success",onClick:f,disabled:c.upload},[n[26]||(n[26]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5-5 5 5M12 15V3"})],-1)),K(" "+u(c.upload?"ä¸Šä¼ ä¸­...":"ä¸Šä¼ å¤‡ä»½"),1)],8,za),e("button",{class:"btn btn-secondary",onClick:N,disabled:c.list},[n[27]||(n[27]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 4v6h6M23 20v-6h-6"}),e("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"})],-1)),K(" "+u(c.list?"åˆ·æ–°ä¸­...":"åˆ·æ–°åˆ—è¡¨"),1)],8,Oa),e("input",{ref_key:"fileInput",ref:C,type:"file",accept:".zip",onChange:m,style:{display:"none"}},null,544)]),_.value.text?(o(),r("div",{key:0,class:W(["message",_.value.type])},u(_.value.text),3)):b("",!0),e("div",Na,[l.value.length===0&&!c.list?(o(),r("div",Fa,[...n[28]||(n[28]=[e("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"#ccc","stroke-width":"1.5"},[e("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e("circle",{cx:"12",cy:"7",r:"4"})],-1),e("p",null,"æš‚æ— å¤‡ä»½æ–‡ä»¶",-1)])])):(o(),r("div",Ha,[(o(!0),r(z,null,O(l.value,T=>(o(),r("div",{key:T.name,class:"backup-card"},[n[33]||(n[33]=e("div",{class:"backup-icon"},[e("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"#2566d8","stroke-width":"2"},[e("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e("polyline",{points:"14 2 14 8 20 8"})])],-1)),e("div",qa,[e("div",ja,u(T.name),1),e("div",Ga,[e("span",Ja,u(T.size),1),e("span",Qa,u(P(T.created)),1),T.signed?(o(),r("span",Xa,"ğŸ”’")):(o(),r("span",Ya,"âš ï¸"))])]),e("div",Za,[e("button",{class:"btn-icon btn-restore",onClick:j=>U("restore",T),title:"æ¢å¤å¤‡ä»½"},[...n[29]||(n[29]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 4v6h6M23 20v-6h-6"}),e("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"})],-1)])],8,ei),e("button",{class:"btn-icon btn-rename",onClick:j=>ae(T.name),title:"é‡å‘½å"},[...n[30]||(n[30]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,si),e("button",{class:"btn-icon",onClick:j=>L(T.name),title:"ä¸‹è½½å¤‡ä»½"},[...n[31]||(n[31]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"})],-1)])],8,ti),e("button",{class:"btn-icon btn-danger",onClick:j=>U("delete",T.name),title:"åˆ é™¤å¤‡ä»½"},[...n[32]||(n[32]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,ni)])]))),128))]))])],512),[[$e,s.value==="local"]]),S(e("div",li,[e("div",ai,[e("button",{class:"btn btn-primary",onClick:ge},[...n[34]||(n[34]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"3"}),e("path",{d:"M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"})],-1),K(" WebDAVé…ç½® ",-1)])]),e("button",{class:"btn btn-primary",onClick:ye,disabled:c.webdavBackup||!w.configured},[n[35]||(n[35]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"})],-1)),K(" "+u(c.webdavBackup?"å¤‡ä»½ä¸­...":"å¤‡ä»½åˆ°WebDAV"),1)],8,ii),e("button",{class:"btn btn-secondary",onClick:Z,disabled:c.webdavList||!w.configured},[n[36]||(n[36]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 4v6h6M23 20v-6h-6"}),e("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"})],-1)),K(" "+u(c.webdavList?"åˆ·æ–°ä¸­...":"åˆ·æ–°åˆ—è¡¨"),1)],8,oi)]),_.value.text?(o(),r("div",{key:0,class:W(["message",_.value.type])},u(_.value.text),3)):b("",!0),w.configured?b("",!0):(o(),r("div",ri,[...n[37]||(n[37]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#2566d8","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})],-1),e("p",null,"è¯·å…ˆé…ç½®WebDAVè¿æ¥ä¿¡æ¯ï¼ˆæ”¯æŒï¼šåšæœäº‘ã€Nextcloudã€é˜¿é‡Œäº‘ç›˜WebDAVã€Dropboxç­‰ï¼‰",-1)])])),e("div",di,[g.value.length===0&&!c.webdavList?(o(),r("div",ui,[...n[38]||(n[38]=[e("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"#ccc","stroke-width":"1.5"},[e("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e("circle",{cx:"12",cy:"7",r:"4"})],-1),e("p",null,"æš‚æ— WebDAVå¤‡ä»½",-1)])])):(o(),r("div",ci,[(o(!0),r(z,null,O(g.value,T=>(o(),r("div",{key:T.name,class:"backup-card"},[n[41]||(n[41]=ue('<div class="backup-icon" data-v-19fdb4a7><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#16a34a" stroke-width="2" data-v-19fdb4a7><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" data-v-19fdb4a7></path><polyline points="14 2 14 8 20 8" data-v-19fdb4a7></polyline><path d="M12 18v-6M9 15l3 3 3-3" data-v-19fdb4a7></path></svg></div>',1)),e("div",vi,[e("div",pi,u(T.name),1),e("div",mi,[e("span",hi,u(T.size),1),e("span",gi,u(P(T.created)),1)])]),e("div",fi,[e("button",{class:"btn-icon btn-restore",onClick:j=>U("webdav-restore",T.name),title:"ä»WebDAVæ¢å¤"},[...n[39]||(n[39]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 4v6h6M23 20v-6h-6"}),e("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"})],-1)])],8,yi),e("button",{class:"btn-icon btn-danger",onClick:j=>U("webdav-delete",T.name),title:"åˆ é™¤WebDAVå¤‡ä»½"},[...n[40]||(n[40]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,ki)])]))),128))]))])],512),[[$e,s.value==="webdav"]]),S(e("div",bi,[_.value.text?(o(),r("div",{key:0,class:W(["message",_.value.type])},u(_.value.text),3)):b("",!0),e("div",wi,[n[76]||(n[76]=e("h3",null,"âš¡ è‡ªåŠ¨å¤‡ä»½é…ç½®",-1)),n[77]||(n[77]=e("p",{class:"config-description"},"é…ç½®ç³»ç»Ÿè‡ªåŠ¨å¤‡ä»½ç­–ç•¥ï¼ŒåŒ…æ‹¬å¢é‡å¤‡ä»½å’Œå®šæ—¶å¤‡ä»½ã€‚",-1)),e("div",_i,[e("div",Ci,[n[43]||(n[43]=e("h4",null,"å¢é‡å¤‡ä»½ï¼ˆé˜²æŠ–ï¼‰",-1)),e("label",Mi,[S(e("input",{type:"checkbox","onUpdate:modelValue":n[3]||(n[3]=T=>h.debounce.enabled=T)},null,512),[[J,h.debounce.enabled]]),n[42]||(n[42]=e("span",{class:"slider"},null,-1))])]),n[48]||(n[48]=e("p",{class:"config-info"},"å½“æ•°æ®å˜æ›´æ—¶ï¼Œå»¶è¿Ÿä¸€æ®µæ—¶é—´åè‡ªåŠ¨å¤‡ä»½ã€‚é€‚åˆé¢‘ç¹ä¿®æ”¹çš„åœºæ™¯ã€‚",-1)),h.debounce.enabled?(o(),r("div",Si,[e("div",Ui,[n[44]||(n[44]=e("label",null,"å»¶è¿Ÿæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰",-1)),S(e("input",{type:"number","onUpdate:modelValue":n[4]||(n[4]=T=>h.debounce.delay=T),min:"5",max:"1440",class:"form-input"},null,512),[[E,h.debounce.delay,void 0,{number:!0}]]),n[45]||(n[45]=e("small",null,"æ•°æ®ä¿®æ”¹åå»¶è¿Ÿå¤šä¹…è§¦å‘å¤‡ä»½ï¼ŒèŒƒå›´ï¼š5-1440åˆ†é’Ÿ",-1))]),e("div",$i,[n[46]||(n[46]=e("label",null,"ä¿ç•™å¤‡ä»½æ•°é‡",-1)),S(e("input",{type:"number","onUpdate:modelValue":n[5]||(n[5]=T=>h.debounce.keep=T),min:"1",max:"30",class:"form-input"},null,512),[[E,h.debounce.keep,void 0,{number:!0}]]),n[47]||(n[47]=e("small",null,"è‡ªåŠ¨æ¸…ç†æ—¶ä¿ç•™æœ€æ–°çš„Nä¸ªå¤‡ä»½ï¼ŒèŒƒå›´ï¼š1-30ä¸ª",-1))])])):b("",!0)]),e("div",xi,[e("div",Ti,[n[50]||(n[50]=e("h4",null,"å®šæ—¶å¤‡ä»½ï¼ˆæ¯æ—¥ï¼‰",-1)),e("label",Ai,[S(e("input",{type:"checkbox","onUpdate:modelValue":n[6]||(n[6]=T=>h.scheduled.enabled=T)},null,512),[[J,h.scheduled.enabled]]),n[49]||(n[49]=e("span",{class:"slider"},null,-1))])]),n[58]||(n[58]=e("p",{class:"config-info"},"æ¯å¤©åœ¨å›ºå®šæ—¶é—´è‡ªåŠ¨æ‰§è¡Œå¤‡ä»½ã€‚",-1)),h.scheduled.enabled?(o(),r("div",Vi,[e("div",Ii,[n[52]||(n[52]=e("label",null,"å¤‡ä»½æ—¶é—´",-1)),e("div",Bi,[S(e("input",{type:"number","onUpdate:modelValue":n[7]||(n[7]=T=>h.scheduled.hour=T),min:"0",max:"23",class:"form-input time-field",placeholder:"æ—¶"},null,512),[[E,h.scheduled.hour,void 0,{number:!0}]]),n[51]||(n[51]=e("span",null,":",-1)),S(e("input",{type:"number","onUpdate:modelValue":n[8]||(n[8]=T=>h.scheduled.minute=T),min:"0",max:"59",class:"form-input time-field",placeholder:"åˆ†"},null,512),[[E,h.scheduled.minute,void 0,{number:!0}]])]),n[53]||(n[53]=e("small",null,"æ ¼å¼ï¼š24å°æ—¶åˆ¶ï¼Œå¦‚ 02:00",-1))]),e("div",Di,[n[54]||(n[54]=e("label",null,"ä¿ç•™å¤‡ä»½æ•°é‡",-1)),S(e("input",{type:"number","onUpdate:modelValue":n[9]||(n[9]=T=>h.scheduled.keep=T),min:"1",max:"30",class:"form-input"},null,512),[[E,h.scheduled.keep,void 0,{number:!0}]]),n[55]||(n[55]=e("small",null,"è‡ªåŠ¨æ¸…ç†æ—¶ä¿ç•™æœ€æ–°çš„Nä¸ªå¤‡ä»½ï¼ŒèŒƒå›´ï¼š1-30ä¸ª",-1))]),e("div",Pi,[e("label",Ri,[S(e("input",{type:"checkbox","onUpdate:modelValue":n[10]||(n[10]=T=>h.scheduled.onlyIfModified=T)},null,512),[[J,h.scheduled.onlyIfModified]]),n[56]||(n[56]=e("span",null,"ä»…åœ¨æœ‰ä¿®æ”¹æ—¶å¤‡ä»½",-1))]),n[57]||(n[57]=e("small",null,"å¦‚æœ24å°æ—¶å†…å·²æœ‰å¢é‡å¤‡ä»½ï¼Œè·³è¿‡å®šæ—¶å¤‡ä»½ï¼ˆé¿å…é‡å¤ï¼‰",-1))])])):b("",!0)]),e("div",Ei,[e("div",Ki,[n[60]||(n[60]=e("h4",null,"â˜ï¸ WebDAV è‡ªåŠ¨åŒæ­¥",-1)),e("label",Li,[S(e("input",{type:"checkbox","onUpdate:modelValue":n[11]||(n[11]=T=>h.webdav.enabled=T),onChange:ke},null,544),[[J,h.webdav.enabled]]),n[59]||(n[59]=e("span",{class:"slider"},null,-1))])]),e("p",Wi,[n[61]||(n[61]=K(" è‡ªåŠ¨å°†æœ¬åœ°å¤‡ä»½åŒæ­¥åˆ° WebDAV äº‘ç«¯ã€‚ ",-1)),w.configured?b("",!0):(o(),r("span",zi,'âš ï¸ è¯·å…ˆåœ¨"WebDAVå¤‡ä»½"æ ‡ç­¾é¡µé…ç½®è¿æ¥'))]),h.webdav.enabled?(o(),r("div",Oi,[e("div",Ni,[e("label",Fi,[S(e("input",{type:"checkbox","onUpdate:modelValue":n[12]||(n[12]=T=>h.webdav.syncDaily=T)},null,512),[[J,h.webdav.syncDaily]]),n[62]||(n[62]=e("span",null,"åŒæ­¥æ¯æ—¥å®šæ—¶å¤‡ä»½",-1))]),n[63]||(n[63]=e("small",null,"æ¯å¤©å®šæ—¶å¤‡ä»½åè‡ªåŠ¨ä¸Šä¼ åˆ° WebDAV",-1))]),e("div",Hi,[e("label",qi,[S(e("input",{type:"checkbox","onUpdate:modelValue":n[13]||(n[13]=T=>h.webdav.syncIncremental=T)},null,512),[[J,h.webdav.syncIncremental]]),n[64]||(n[64]=e("span",null,"åŒæ­¥å¢é‡å¤‡ä»½",-1))]),n[65]||(n[65]=e("small",null,"å¢é‡å¤‡ä»½åè‡ªåŠ¨ä¸Šä¼ åˆ° WebDAV",-1))])])):b("",!0)]),e("div",ji,[e("div",Gi,[n[67]||(n[67]=e("h4",null,"è‡ªåŠ¨æ¸…ç†",-1)),e("label",Ji,[S(e("input",{type:"checkbox","onUpdate:modelValue":n[14]||(n[14]=T=>h.autoClean=T)},null,512),[[J,h.autoClean]]),n[66]||(n[66]=e("span",{class:"slider"},null,-1))])]),n[68]||(n[68]=e("p",{class:"config-info"},"è‡ªåŠ¨åˆ é™¤è¶…å‡ºä¿ç•™æ•°é‡çš„æ—§å¤‡ä»½æ–‡ä»¶ï¼ˆæŒ‰æ—¶é—´æ’åºï¼Œä¿ç•™æœ€æ–°çš„ï¼‰ã€‚",-1))]),v.value?(o(),r("div",Qi,[n[73]||(n[73]=e("h4",null,"ğŸ“Š å¤‡ä»½ç»Ÿè®¡",-1)),e("div",Xi,[e("div",Yi,[n[69]||(n[69]=e("span",{class:"stat-label"},"å¢é‡å¤‡ä»½æ•°é‡",-1)),e("span",Zi,u(((q=v.value.incremental)==null?void 0:q.count)||0)+" ä¸ª",1)]),e("div",eo,[n[70]||(n[70]=e("span",{class:"stat-label"},"æœ€åå¢é‡å¤‡ä»½",-1)),e("span",so,u(P(v.value.lastDebounce)||"æ— "),1)]),e("div",to,[n[71]||(n[71]=e("span",{class:"stat-label"},"æœ€åå®šæ—¶å¤‡ä»½",-1)),e("span",no,u(P(v.value.lastScheduled)||"æ— "),1)]),e("div",lo,[n[72]||(n[72]=e("span",{class:"stat-label"},"ä¸‹æ¬¡å®šæ—¶å¤‡ä»½",-1)),e("span",ao,u(Je()),1)])])])):b("",!0),e("div",io,[e("button",{class:"btn btn-secondary",onClick:Qe},[...n[74]||(n[74]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 4v6h6M23 20v-6h-6"}),e("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"})],-1),K(" æ¢å¤é»˜è®¤ ",-1)])]),e("button",{class:"btn btn-primary",onClick:F,disabled:c.autoBackupConfig},[n[75]||(n[75]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),e("polyline",{points:"17 21 17 13 7 13 7 21"}),e("polyline",{points:"7 3 7 8 15 8"})],-1)),K(" "+u(c.autoBackupConfig?"ä¿å­˜ä¸­...":"ä¿å­˜é…ç½®"),1)],8,oo)])])],512),[[$e,s.value==="auto"]]),t.value?(o(),r("div",ro,[e("div",uo,[n[82]||(n[82]=e("h3",null,"WebDAVé…ç½®",-1)),e("div",co,[n[78]||(n[78]=e("label",null,[K("WebDAV URL "),e("span",{class:"required"},"*")],-1)),S(e("input",{type:"text","onUpdate:modelValue":n[15]||(n[15]=T=>p.url=T),placeholder:"https://dav.jianguoyun.com/dav/",class:"form-input"},null,512),[[E,p.url]]),n[79]||(n[79]=e("small",null,"ä¾‹ï¼šåšæœäº‘ https://dav.jianguoyun.com/dav/",-1))]),e("div",vo,[n[80]||(n[80]=e("label",null,[K("ç”¨æˆ·å "),e("span",{class:"required"},"*")],-1)),S(e("input",{type:"text","onUpdate:modelValue":n[16]||(n[16]=T=>p.username=T),placeholder:"é‚®ç®±æˆ–ç”¨æˆ·å",class:"form-input"},null,512),[[E,p.username]])]),e("div",po,[n[81]||(n[81]=e("label",null,[K("å¯†ç  "),e("span",{class:"required"},"*")],-1)),S(e("input",{type:"password","onUpdate:modelValue":n[17]||(n[17]=T=>p.password=T),placeholder:w.configured?"ç•™ç©ºåˆ™ä¿æŒåŸå¯†ç ä¸å˜":"åº”ç”¨å¯†ç æˆ–è®¿é—®ä»¤ç‰Œ",class:"form-input"},null,8,mo),[[E,p.password]]),w.configured?(o(),r("small",go,"å¦‚éœ€ä¿®æ”¹å¯†ç è¯·è¾“å…¥æ–°å¯†ç ï¼Œç•™ç©ºåˆ™ä¿æŒåŸå¯†ç ä¸å˜")):(o(),r("small",ho,"æ³¨æ„ï¼šæŸäº›æœåŠ¡éœ€è¦ä½¿ç”¨åº”ç”¨ä¸“ç”¨å¯†ç ï¼Œè€Œä¸æ˜¯ç™»å½•å¯†ç "))]),e("div",fo,[e("button",{class:"btn btn-secondary",onClick:n[18]||(n[18]=T=>t.value=!1)},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:fe,disabled:c.webdavConfig},u(c.webdavConfig?"æµ‹è¯•è¿æ¥ä¸­...":"ä¿å­˜"),9,yo)])])])):b("",!0),V.show?(o(),r("div",ko,[e("div",bo,[e("h3",null,"ç¡®è®¤"+u(V.title),1),e("p",wo,u(V.message),1),e("div",_o,[e("button",{class:"btn btn-secondary",onClick:n[19]||(n[19]=T=>V.show=!1),disabled:V.processing},"å–æ¶ˆ",8,Co),e("button",{class:W(["btn",V.confirmClass]),onClick:D,disabled:V.processing},u(V.processing?"å¤„ç†ä¸­...":"ç¡®è®¤"),11,Mo)])])])):b("",!0),i.value?(o(),r("div",So,[e("div",Uo,[n[86]||(n[86]=e("h3",null,"åˆ›å»ºå¤‡ä»½",-1)),e("div",$o,[n[83]||(n[83]=e("label",null,"å¤‡ä»½åç§°ï¼ˆå¯é€‰ï¼‰",-1)),S(e("input",{type:"text","onUpdate:modelValue":n[20]||(n[20]=T=>k.name=T),placeholder:"ä¾‹å¦‚ï¼šæ·»åŠ ä¹¦ç­¾åçš„å¤‡ä»½",class:"form-input",maxlength:"50"},null,512),[[E,k.name]]),n[84]||(n[84]=e("small",null,"ç•™ç©ºåˆ™ä½¿ç”¨é»˜è®¤åç§°ï¼ˆbackup-æ—¶é—´æˆ³ï¼‰",-1))]),e("div",xo,[n[85]||(n[85]=e("label",null,"å¤‡ä»½æè¿°ï¼ˆå¯é€‰ï¼‰",-1)),S(e("textarea",{"onUpdate:modelValue":n[21]||(n[21]=T=>k.description=T),placeholder:"æè¿°è¿™æ¬¡å¤‡ä»½çš„å†…å®¹æˆ–ç›®çš„...",class:"form-input",rows:"3"},null,512),[[E,k.description]])]),e("div",To,[e("button",{class:"btn btn-secondary",onClick:n[22]||(n[22]=T=>i.value=!1)},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:se,disabled:c.create},u(c.create?"å¤‡ä»½ä¸­...":"åˆ›å»ºå¤‡ä»½"),9,Ao)])])])):b("",!0),d.value?(o(),r("div",Vo,[e("div",Io,[n[88]||(n[88]=e("h3",null,"é‡å‘½åå¤‡ä»½",-1)),e("div",Bo,[n[87]||(n[87]=e("label",null,[K("æ–°åç§° "),e("span",{class:"required"},"*")],-1)),S(e("input",{type:"text","onUpdate:modelValue":n[23]||(n[23]=T=>y.newName=T),placeholder:"è¾“å…¥æ–°çš„å¤‡ä»½åç§°",class:"form-input",maxlength:"50"},null,512),[[E,y.newName]]),e("small",null,"åŸåç§°ï¼š"+u(y.oldName),1)]),e("div",Do,[e("button",{class:"btn btn-secondary",onClick:n[24]||(n[24]=T=>d.value=!1)},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:te,disabled:c.rename||!y.newName.trim()},u(c.rename?"é‡å‘½åä¸­...":"ç¡®è®¤é‡å‘½å"),9,Po)])])])):b("",!0)])}}},Eo=Y(Ro,[["__scopeId","data-v-19fdb4a7"]]),Ko={name:"AIBatchWizard",props:{visible:Boolean,activeTask:{type:Object,default:()=>({running:!1})}},emits:["close","start"],data(){return{step:0,stepNames:["é€‰æ‹©èŒƒå›´","ç”Ÿæˆç­–ç•¥","æ•ˆæœé¢„è§ˆ","æ‰§è¡Œä»»åŠ¡"],fieldLabels:{name:"åç§°",description:"æè¿°",tags:"æ ‡ç­¾"},menus:[],subMenus:[],tags:[],filters:{status:["empty_name","empty_desc"],menuId:"",subMenuId:"",tagIds:[]},filteredCards:[],filtering:!1,strategy:{types:["name","description"],mode:"fill",style:"default",customPrompt:""},previews:[],previewing:!1,previewCount:3,previewProgress:0,taskDone:!1,taskStartTime:null,taskEndTime:null,localTaskStatus:{current:0,total:0,successCount:0,failCount:0,currentCard:"",errors:[]},pendingRetryErrors:[],pendingSuccessCount:0,retrySuccessIds:new Set,lastRetryCardId:null,isRetrying:!1,starting:!1,stopping:!1,eventSource:null}},computed:{canNext(){return this.step===0?this.filteredCards.length>0:this.step===1?this.strategy.types.length>0:!0},taskStatus(){const a=this.activeTask.running?this.activeTask:this.localTaskStatus;if(this.isRetrying&&this.pendingRetryErrors.length>0){const s=a.errors||[],l=new Set(s.map(d=>d.cardId)),g=this.retrySuccessIds||new Set,t=[...s,...this.pendingRetryErrors.filter(d=>!l.has(d.cardId)&&!g.has(d.cardId))],i=t.filter(d=>!d.isWarning).length;return ne(G({},a),{errors:t,failCount:i,successCount:this.pendingSuccessCount+(a.successCount||0),total:this.pendingRetryErrors.length+(a.total||0)})}return a},taskRunning(){return this.activeTask.running},taskStatusText(){return this.taskDone?"âœ… ä»»åŠ¡å®Œæˆ":this.taskStatus.isRateLimited?"â³ é™æµç­‰å¾…ä¸­...":this.taskStatus.autoRetryRound>0?`ğŸ”„ è‡ªåŠ¨é‡è¯•ç¬¬ ${this.taskStatus.autoRetryRound} è½®`:"â³ æ­£åœ¨å¤„ç†..."},progressPercent(){const a=this.taskStatus;return a.total?Math.min(100,Math.round(a.current/a.total*100)):0},displayErrors(){return this.taskStatus.errors||[]},hasRealErrors(){return this.displayErrors.some(a=>!a.isWarning&&!a.isRateLimited)},hasErrorsOrWarnings(){return this.displayErrors.length>0},realErrorCount(){return this.displayErrors.filter(a=>!a.isWarning&&!a.isRateLimited).length},warningCount(){return this.displayErrors.filter(a=>a.isWarning).length},successRate(){const a=this.taskStatus.total||0,s=this.taskStatus.successCount||0;return a===0?0:Math.min(100,Math.round(s/a*100))},taskDuration(){const a=this.taskStatus.startTime||this.taskStartTime;if(!a)return"-";const s=this.taskEndTime||Date.now(),l=Math.round((s-a)/1e3);if(l<60)return`${l}ç§’`;const g=Math.floor(l/60),t=l%60;return`${g}åˆ†${t}ç§’`},taskETA(){if(!this.taskRunning||!this.taskStatus.startTime)return"";const a=this.taskStatus.current||0,s=this.taskStatus.total||0;if(a===0||s===0)return"";const g=(Date.now()-this.taskStatus.startTime)/a,t=(s-a)*g,i=Math.round(t/1e3);if(i<60)return`${i}ç§’`;const d=Math.floor(i/60),C=i%60;return`${d}åˆ†${C}ç§’`}},watch:{visible(a){a&&this.init()},"activeTask.running"(a,s){if(a===!0&&(this.taskDone=!1,this.taskStartTime=Date.now(),this.taskEndTime=null),s===!0&&a===!1&&this.step===3){if(this.taskDone=!0,this.taskEndTime=Date.now(),this.isRetrying&&this.pendingRetryErrors.length>0){const l=this.activeTask.errors||[],g=new Set(l.map(t=>t.cardId));if(this.pendingRetryErrors=this.pendingRetryErrors.filter(t=>g.has(t.cardId)||!this.retrySuccessIds.has(t.cardId)),this.activeTask.successCount>0){const t=[...this.retrySuccessIds];this.pendingRetryErrors=this.pendingRetryErrors.filter(i=>!t.includes(i.cardId))}}this.pendingRetryErrors.length===0&&(this.isRetrying=!1,this.pendingSuccessCount=0,this.retrySuccessIds=new Set),this.applyFilter()}},"activeTask.successCount"(a,s){if(this.isRetrying&&a>(s||0)&&this.activeTask.currentCard){const l=this.lastRetryCardId;l&&(this.retrySuccessIds.add(l),this.pendingRetryErrors=this.pendingRetryErrors.filter(g=>g.cardId!==l))}},activeTask:{handler(a){a&&(this.localTaskStatus=G({},a))},deep:!0}},methods:{init(){return x(this,null,function*(){this.step=0,this.previews=[],this.taskDone=!1,this.localTaskStatus={current:0,total:0,successCount:0,failCount:0,currentCard:"",errors:[]},this.pendingRetryErrors=[],this.pendingSuccessCount=0,this.retrySuccessIds=new Set,this.lastRetryCardId=null,this.isRetrying=!1;try{const[a,s]=yield Promise.all([Ie(),Be()]);this.menus=a.data||[],this.tags=s.data||[]}catch(a){}this.applyFilter()})},onMenuChange(){return x(this,null,function*(){this.filters.subMenuId="";const a=this.menus.find(s=>s.id===this.filters.menuId);this.subMenus=(a==null?void 0:a.subMenus)||[],this.applyFilter()})},applyFilter(){return x(this,null,function*(){var a;this.filtering=!0;try{const s={status:this.filters.status};this.filters.menuId&&(s.menuIds=[this.filters.menuId]),this.filters.subMenuId&&(s.subMenuIds=[this.filters.subMenuId]),(a=this.filters.tagIds)!=null&&a.length&&(s.tagIds=this.filters.tagIds);const{data:l}=yield Is(s);this.filteredCards=l.cards||[]}catch(s){this.filteredCards=[]}this.filtering=!1})},nextStep(){this.step<3&&this.step++},runPreview(){return x(this,null,function*(){var a,s;this.previewing=!0,this.previews=[],this.previewProgress=0;try{const l=Math.min(this.previewCount,this.filteredCards.length),t=[...this.filteredCards].sort(()=>Math.random()-.5).slice(0,l).map(d=>d.id);this.previewProgress=1;const{data:i}=yield Vs({cardIds:t,types:this.strategy.types,strategy:{mode:this.strategy.mode,style:this.strategy.style,customPrompt:this.strategy.customPrompt}});this.previews=i.previews||[],this.previewProgress=l}catch(l){alert("é¢„è§ˆå¤±è´¥: "+(((s=(a=l.response)==null?void 0:a.data)==null?void 0:s.message)||l.message))}this.previewing=!1})},startTask(){return x(this,null,function*(){this.pendingRetryErrors=[],this.pendingSuccessCount=0,this.retrySuccessIds=new Set,this.lastRetryCardId=null,this.isRetrying=!1,yield this.doStartTask(this.filteredCards.map(a=>a.id))})},retryCard(a){return x(this,null,function*(){if(!a.cardId){alert("æ— æ³•é‡è¯•ï¼šè¯¥é”™è¯¯æ²¡æœ‰å…³è”çš„å¡ç‰‡ ID");return}const s=a.cardId;this.lastRetryCardId=s,this.pendingRetryErrors=(this.taskStatus.errors||[]).filter(l=>l.cardId!==s),this.pendingSuccessCount=this.taskStatus.successCount||0,this.isRetrying=!0,yield this.doStartTask([s])})},retryAllFailed(){return x(this,null,function*(){const a=(this.taskStatus.errors||[]).filter(l=>!l.isWarning);if(a.length===0){alert("æ²¡æœ‰éœ€è¦é‡è¯•çš„å¤±è´¥å¡ç‰‡");return}const s=a.map(l=>l.cardId).filter(l=>!!l&&l!==0);if(s.length===0){alert("æ²¡æœ‰å¯é‡è¯•çš„å¡ç‰‡ï¼ˆéƒ¨åˆ†ç³»ç»Ÿé”™è¯¯æ— æ³•ç›´æ¥é‡è¯•ï¼‰");return}this.pendingSuccessCount=this.taskStatus.successCount||0,this.pendingRetryErrors=[],this.isRetrying=!0,yield this.doStartTask(s)})},doStartTask(a){return x(this,null,function*(){var l,g;this.starting=!0,this.taskDone=!1,this.localTaskStatus.errors=[];const s={cardIds:a,types:this.strategy.types,strategy:{mode:this.strategy.mode,style:this.strategy.style,customPrompt:this.strategy.customPrompt}};try{const{data:t}=yield Ae(s);if(!t.success||t.total===0){alert(t.message||"æ²¡æœ‰éœ€è¦å¤„ç†çš„å¡ç‰‡"),this.starting=!1;return}this.$emit("start",{total:t.total||s.cardIds.length,types:s.types,mode:s.strategy.mode,current:0,successCount:0,failCount:0,currentCard:"ä»»åŠ¡å·²å¯åŠ¨...",errors:[]})}catch(t){alert("å¯åŠ¨å¤±è´¥: "+(((g=(l=t.response)==null?void 0:l.data)==null?void 0:g.message)||t.message))}this.starting=!1})},stopTask(){return x(this,null,function*(){this.stopping=!0;try{yield je()}catch(a){}setTimeout(()=>{this.stopping=!1},2e3)})},extractDomain(a){try{return new URL(a).hostname.replace("www.","")}catch(s){return a}},formatFieldValue(a,s){return!a||Array.isArray(a)&&a.length===0?"(ç©º)":s==="tags"&&Array.isArray(a)?a.join("ã€"):a},formatTime(a){if(!a)return"";const s=new Date(a);return`${s.getHours().toString().padStart(2,"0")}:${s.getMinutes().toString().padStart(2,"0")}:${s.getSeconds().toString().padStart(2,"0")}`},handleClose(){this.taskRunning?this.$emit("close"):this.previewing?confirm("é¢„è§ˆæ­£åœ¨ç”Ÿæˆä¸­ï¼Œç¡®å®šè¦å–æ¶ˆå—ï¼Ÿ")&&this.$emit("close"):this.$emit("close")},handleOverlayClick(){this.taskRunning||this.handleClose()}}},Lo={class:"wizard-header"},Wo={class:"steps"},zo={class:"step-num"},Oo={class:"step-name"},No={class:"wizard-body"},Fo={key:0,class:"step-content"},Ho={class:"filter-section"},qo={class:"checkbox-group"},jo={class:"filter-section"},Go=["value"],Jo=["value"],Qo={key:0,class:"filter-section"},Xo={class:"tag-filter-group"},Yo={class:"tag-filter-row"},Zo={class:"tag-select-list"},er=["value"],sr={class:"filter-result"},tr={class:"result-count"},nr=["disabled"],lr={key:1,class:"card-preview-list"},ar={class:"card-title"},ir={class:"card-url"},or={key:0,class:"more-hint"},rr={key:1,class:"step-content"},dr={class:"filter-section"},ur={class:"checkbox-group"},cr={class:"filter-section"},vr={class:"radio-group"},pr={class:"filter-section"},mr={class:"filter-section"},hr={key:2,class:"step-content"},gr={class:"preview-actions"},fr={class:"preview-count-selector"},yr=["disabled"],kr=["value"],br=["disabled"],wr={key:0,class:"preview-list"},_r={class:"preview-title"},Cr={class:"field-label"},Mr={class:"diff-view"},Sr={class:"diff-old"},Ur={key:1,class:"preview-hint"},$r={key:3,class:"step-content"},xr={key:0,class:"execute-confirm"},Tr=["disabled"],Ar={key:1,class:"task-progress"},Vr={class:"progress-header"},Ir={class:"progress-info"},Br={key:0},Dr={key:1},Pr={key:0,class:"rate-limit-notice"},Rr={key:1,class:"retry-queue-notice"},Er={key:2,class:"task-summary"},Kr={class:"summary-grid"},Lr={class:"summary-item"},Wr={class:"summary-value success"},zr={class:"summary-item"},Or={class:"summary-value fail"},Nr={class:"summary-item"},Fr={class:"summary-value warning"},Hr={class:"summary-item"},qr={class:"summary-value"},jr={class:"summary-rate"},Gr={key:0,class:"auto-retry-summary"},Jr={key:3,class:"task-stats"},Qr={class:"stat success"},Xr={class:"stat fail"},Yr={key:0,class:"stat retry"},Zr={key:4,class:"retry-actions"},ed=["disabled"],sd={class:"error-log-header"},td={key:0,class:"header-hint"},nd={key:0,class:"error-log"},ld={class:"error-info"},ad={class:"error-row"},id=["title"],od={key:0,class:"warning-icon"},rd={class:"error-time"},dd=["title"],ud=["onClick","disabled"],cd={key:1,class:"error-empty-hint"},vd={key:6,class:"task-actions"},pd=["disabled"],md={class:"wizard-footer"},hd={class:"footer-right"},gd=["disabled"];function fd(a,s,l,g,t,i){return l.visible?(o(),r("div",{key:0,class:"wizard-overlay",onClick:s[31]||(s[31]=oe((...d)=>i.handleOverlayClick&&i.handleOverlayClick(...d),["self"])),onContextmenu:s[32]||(s[32]=oe(()=>{},["prevent"]))},[e("div",{class:"wizard-modal",onContextmenu:s[30]||(s[30]=oe(()=>{},["prevent"]))},[e("div",Lo,[s[33]||(s[33]=e("h3",null,"ğŸ¤– AI æ‰¹é‡ç”Ÿæˆå‘å¯¼",-1)),e("button",{class:"close-btn",onClick:s[0]||(s[0]=(...d)=>i.handleClose&&i.handleClose(...d))},"âœ•")]),e("div",Wo,[(o(!0),r(z,null,O(t.stepNames,(d,C)=>(o(),r("div",{key:C,class:W(["step",{active:t.step===C,done:t.step>C}])},[e("span",zo,u(t.step>C?"âœ“":C+1),1),e("span",Oo,u(d),1)],2))),128))]),e("div",No,[t.step===0?(o(),r("div",Fo,[e("div",Ho,[s[37]||(s[37]=e("h4",null,"çŠ¶æ€ç­›é€‰",-1)),e("div",qo,[e("label",null,[S(e("input",{type:"checkbox","onUpdate:modelValue":s[1]||(s[1]=d=>t.filters.status=d),value:"empty_name",onChange:s[2]||(s[2]=(...d)=>i.applyFilter&&i.applyFilter(...d))},null,544),[[J,t.filters.status]]),s[34]||(s[34]=K(" ç¼ºåç§°",-1))]),e("label",null,[S(e("input",{type:"checkbox","onUpdate:modelValue":s[3]||(s[3]=d=>t.filters.status=d),value:"empty_desc",onChange:s[4]||(s[4]=(...d)=>i.applyFilter&&i.applyFilter(...d))},null,544),[[J,t.filters.status]]),s[35]||(s[35]=K(" ç¼ºæè¿°",-1))]),e("label",null,[S(e("input",{type:"checkbox","onUpdate:modelValue":s[5]||(s[5]=d=>t.filters.status=d),value:"empty_tags",onChange:s[6]||(s[6]=(...d)=>i.applyFilter&&i.applyFilter(...d))},null,544),[[J,t.filters.status]]),s[36]||(s[36]=K(" ç¼ºæ ‡ç­¾",-1))])])]),e("div",jo,[s[40]||(s[40]=e("h4",null,"èœå•ç­›é€‰",-1)),S(e("select",{"onUpdate:modelValue":s[7]||(s[7]=d=>t.filters.menuId=d),onChange:s[8]||(s[8]=(...d)=>i.onMenuChange&&i.onMenuChange(...d)),class:"input"},[s[38]||(s[38]=e("option",{value:""},"å…¨éƒ¨èœå•",-1)),(o(!0),r(z,null,O(t.menus,d=>(o(),r("option",{key:d.id,value:d.id},u(d.name),9,Go))),128))],544),[[ie,t.filters.menuId]]),t.subMenus.length?S((o(),r("select",{key:0,"onUpdate:modelValue":s[9]||(s[9]=d=>t.filters.subMenuId=d),onChange:s[10]||(s[10]=(...d)=>i.applyFilter&&i.applyFilter(...d)),class:"input",style:{"margin-top":"8px"}},[s[39]||(s[39]=e("option",{value:""},"å…¨éƒ¨å­èœå•",-1)),(o(!0),r(z,null,O(t.subMenus,d=>(o(),r("option",{key:d.id,value:d.id},u(d.name),9,Jo))),128))],544)),[[ie,t.filters.subMenuId]]):b("",!0)]),t.tags.length?(o(),r("div",Qo,[s[42]||(s[42]=e("h4",null,[K("æ ‡ç­¾ç­›é€‰ "),e("span",{class:"hint"},"(å¯é€‰)")],-1)),e("div",Xo,[e("div",Yo,[s[41]||(s[41]=e("span",{class:"tag-filter-label"},"åŒ…å«æ ‡ç­¾ï¼š",-1)),e("div",Zo,[(o(!0),r(z,null,O(t.tags.slice(0,20),d=>(o(),r("label",{key:d.id,class:"tag-checkbox"},[S(e("input",{type:"checkbox",value:d.id,"onUpdate:modelValue":s[11]||(s[11]=C=>t.filters.tagIds=C),onChange:s[12]||(s[12]=(...C)=>i.applyFilter&&i.applyFilter(...C))},null,40,er),[[J,t.filters.tagIds]]),e("span",{class:"tag-name",style:ve({background:d.color||"#e5e7eb"})},u(d.name),5)]))),128))])])])])):b("",!0),e("div",sr,[e("span",tr,[s[43]||(s[43]=K("å·²é€‰ä¸­ ",-1)),e("strong",null,u(t.filteredCards.length),1),s[44]||(s[44]=K(" ä¸ªå¡ç‰‡",-1))]),e("button",{class:"btn sm",onClick:s[13]||(s[13]=(...d)=>i.applyFilter&&i.applyFilter(...d)),disabled:t.filtering},u(t.filtering?"ç­›é€‰ä¸­...":"ğŸ”„ åˆ·æ–°"),9,nr)]),t.filteredCards.length?(o(),r("div",lr,[(o(!0),r(z,null,O(t.filteredCards.slice(0,10),d=>(o(),r("div",{key:d.id,class:"card-preview-item"},[e("span",ar,u(d.title||i.extractDomain(d.url)),1),e("span",ir,u(d.url),1)]))),128)),t.filteredCards.length>10?(o(),r("div",or,"è¿˜æœ‰ "+u(t.filteredCards.length-10)+" ä¸ª...",1)):b("",!0)])):b("",!0)])):b("",!0),t.step===1?(o(),r("div",rr,[e("div",dr,[s[48]||(s[48]=e("h4",null,"ç”Ÿæˆå­—æ®µ",-1)),e("div",ur,[e("label",null,[S(e("input",{type:"checkbox","onUpdate:modelValue":s[14]||(s[14]=d=>t.strategy.types=d),value:"name"},null,512),[[J,t.strategy.types]]),s[45]||(s[45]=K(" åç§°",-1))]),e("label",null,[S(e("input",{type:"checkbox","onUpdate:modelValue":s[15]||(s[15]=d=>t.strategy.types=d),value:"description"},null,512),[[J,t.strategy.types]]),s[46]||(s[46]=K(" æè¿°",-1))]),e("label",null,[S(e("input",{type:"checkbox","onUpdate:modelValue":s[16]||(s[16]=d=>t.strategy.types=d),value:"tags"},null,512),[[J,t.strategy.types]]),s[47]||(s[47]=K(" æ ‡ç­¾",-1))])])]),e("div",cr,[s[51]||(s[51]=e("h4",null,"ç”Ÿæˆæ¨¡å¼",-1)),e("div",vr,[e("label",null,[S(e("input",{type:"radio","onUpdate:modelValue":s[17]||(s[17]=d=>t.strategy.mode=d),value:"fill"},null,512),[[Ee,t.strategy.mode]]),s[49]||(s[49]=K(" è¡¥å…¨æ¨¡å¼ï¼ˆä»…å¡«å……ç©ºå­—æ®µï¼‰",-1))]),e("label",null,[S(e("input",{type:"radio","onUpdate:modelValue":s[18]||(s[18]=d=>t.strategy.mode=d),value:"overwrite"},null,512),[[Ee,t.strategy.mode]]),s[50]||(s[50]=K(" è¦†ç›–æ¨¡å¼ï¼ˆé‡æ–°ç”Ÿæˆæ‰€æœ‰ï¼‰",-1))])])]),e("div",pr,[s[53]||(s[53]=e("h4",null,"ç”Ÿæˆé£æ ¼",-1)),S(e("select",{"onUpdate:modelValue":s[19]||(s[19]=d=>t.strategy.style=d),class:"input"},[...s[52]||(s[52]=[ue('<option value="default" data-v-058b49e0>é»˜è®¤</option><option value="concise" data-v-058b49e0>ç®€æ´æœ‰åŠ›</option><option value="professional" data-v-058b49e0>ä¸“ä¸šæ­£å¼</option><option value="friendly" data-v-058b49e0>å‹å¥½è½»æ¾</option><option value="seo" data-v-058b49e0>SEO ä¼˜åŒ–</option>',5)])],512),[[ie,t.strategy.style]])]),e("div",mr,[s[54]||(s[54]=e("h4",null,"è‡ªå®šä¹‰æç¤ºï¼ˆå¯é€‰ï¼‰",-1)),S(e("textarea",{"onUpdate:modelValue":s[20]||(s[20]=d=>t.strategy.customPrompt=d),class:"input",rows:"2",placeholder:"ä¾‹å¦‚ï¼šè¯·ä½¿ç”¨ä¸­æ–‡ï¼Œæè¿°æ§åˆ¶åœ¨30å­—ä»¥å†…"},null,512),[[E,t.strategy.customPrompt]])])])):b("",!0),t.step===2?(o(),r("div",hr,[e("div",gr,[e("div",fr,[s[58]||(s[58]=e("label",null,"é¢„è§ˆæ•°é‡ï¼š",-1)),S(e("select",{"onUpdate:modelValue":s[21]||(s[21]=d=>t.previewCount=d),class:"input sm",disabled:t.previewing},[s[55]||(s[55]=e("option",{value:1},"1 ä¸ª",-1)),s[56]||(s[56]=e("option",{value:3},"3 ä¸ª",-1)),s[57]||(s[57]=e("option",{value:5},"5 ä¸ª",-1)),e("option",{value:Math.min(10,t.filteredCards.length)},u(Math.min(10,t.filteredCards.length))+" ä¸ª",9,kr)],8,yr),[[ie,t.previewCount]])]),e("button",{class:"btn primary",onClick:s[22]||(s[22]=(...d)=>i.runPreview&&i.runPreview(...d)),disabled:t.previewing||t.filteredCards.length===0},u(t.previewing?`â³ ç”Ÿæˆä¸­ (${t.previewProgress}/${t.previewCount})...`:"ğŸ”® è¯•è¿è¡Œé¢„è§ˆ"),9,br)]),t.previews.length?(o(),r("div",wr,[(o(!0),r(z,null,O(t.previews,d=>(o(),r("div",{key:d.cardId,class:"preview-card"},[e("div",_r,u(d.title||i.extractDomain(d.url)),1),(o(!0),r(z,null,O(d.fields,(C,c)=>(o(),r("div",{key:c,class:"preview-field"},[e("span",Cr,u(t.fieldLabels[c]),1),e("div",Mr,[e("div",Sr,u(i.formatFieldValue(C.original,c)),1),s[59]||(s[59]=e("div",{class:"diff-arrow"},"â†’",-1)),e("div",{class:W(["diff-new",{error:C.error}])},u(C.error||i.formatFieldValue(C.generated,c)),3)])]))),128))]))),128))])):t.previewing?b("",!0):(o(),r("div",Ur,' ç‚¹å‡»"è¯•è¿è¡Œé¢„è§ˆ"æŸ¥çœ‹ AI ç”Ÿæˆæ•ˆæœï¼Œä¸æ»¡æ„å¯è¿”å›è°ƒæ•´ç­–ç•¥ '))])):b("",!0),t.step===3?(o(),r("div",$r,[!i.taskRunning&&!t.taskDone?(o(),r("div",xr,[e("p",null,[s[60]||(s[60]=K("å³å°†å¤„ç† ",-1)),e("strong",null,u(t.filteredCards.length),1),s[61]||(s[61]=K(" ä¸ªå¡ç‰‡",-1))]),e("p",null,"ç”Ÿæˆå­—æ®µï¼š"+u(t.strategy.types.map(d=>t.fieldLabels[d]).join("ã€")),1),e("p",null,"ç”Ÿæˆæ¨¡å¼ï¼š"+u(t.strategy.mode==="fill"?"è¡¥å…¨æ¨¡å¼":"è¦†ç›–æ¨¡å¼"),1),e("button",{class:"btn primary lg",onClick:s[23]||(s[23]=(...d)=>i.startTask&&i.startTask(...d)),disabled:t.starting},u(t.starting?"å¯åŠ¨ä¸­...":"ğŸš€ å¼€å§‹æ‰§è¡Œ"),9,Tr)])):b("",!0),i.taskRunning||t.taskDone?(o(),r("div",Ar,[e("div",Vr,[e("span",null,u(i.taskStatusText),1),e("span",null,u(i.taskStatus.current)+" / "+u(i.taskStatus.total),1)]),e("div",{class:W(["progress-bar",{"rate-limited":i.taskStatus.isRateLimited}])},[e("div",{class:"progress-fill",style:ve({width:i.progressPercent+"%"})},null,4)],2),e("div",Ir,[i.taskStatus.currentCard&&i.taskRunning?(o(),r("span",Br,u(i.taskStatus.currentCard),1)):b("",!0),i.taskETA&&i.taskRunning&&!i.taskStatus.isRateLimited?(o(),r("span",Dr,"é¢„è®¡å‰©ä½™ï¼š"+u(i.taskETA),1)):b("",!0)]),i.taskStatus.isRateLimited&&i.taskRunning?(o(),r("div",Pr,[...s[62]||(s[62]=[e("span",{class:"rate-limit-icon"},"â³",-1),e("span",null,"API é™æµä¸­ï¼Œç­‰å¾…åå°†è‡ªåŠ¨é‡è¯•...",-1)])])):b("",!0),i.taskStatus.retryQueueSize>0&&i.taskRunning?(o(),r("div",Rr,[s[63]||(s[63]=e("span",{class:"retry-icon"},"ğŸ”„",-1)),e("span",null,u(i.taskStatus.retryQueueSize)+" ä¸ªå¡ç‰‡å¾…è‡ªåŠ¨é‡è¯• (ç¬¬ "+u(i.taskStatus.autoRetryRound+1)+" è½®)",1)])):b("",!0),t.taskDone?(o(),r("div",Er,[e("div",Kr,[e("div",Lr,[e("span",Wr,u(i.taskStatus.successCount||0),1),s[64]||(s[64]=e("span",{class:"summary-label"},"æˆåŠŸ",-1))]),e("div",zr,[e("span",Or,u(i.realErrorCount),1),s[65]||(s[65]=e("span",{class:"summary-label"},"å¤±è´¥",-1))]),e("div",Nr,[e("span",Fr,u(i.warningCount),1),s[66]||(s[66]=e("span",{class:"summary-label"},"è­¦å‘Š",-1))]),e("div",Hr,[e("span",qr,u(i.taskDuration),1),s[67]||(s[67]=e("span",{class:"summary-label"},"ç”¨æ—¶",-1))])]),e("div",jr," æˆåŠŸç‡ï¼š"+u(i.successRate)+"% ",1),i.taskStatus.autoRetryRound>0?(o(),r("div",Gr," è‡ªåŠ¨é‡è¯•ï¼š"+u(i.taskStatus.autoRetryRound)+" è½® ",1)):b("",!0)])):b("",!0),t.taskDone?b("",!0):(o(),r("div",Jr,[e("span",Qr,"âœ“ æˆåŠŸ "+u(i.taskStatus.successCount||0),1),e("span",Xr,"âœ— å¤±è´¥ "+u(i.taskStatus.failCount||0),1),i.taskStatus.retryQueueSize>0?(o(),r("span",Yr,"â³ å¾…é‡è¯• "+u(i.taskStatus.retryQueueSize),1)):b("",!0)])),t.taskDone&&i.hasRealErrors?(o(),r("div",Zr,[e("button",{class:"btn sm outline retry-all-btn",onClick:s[24]||(s[24]=(...d)=>i.retryAllFailed&&i.retryAllFailed(...d)),disabled:t.starting||i.taskRunning}," ğŸ”„ é‡è¯•å…¨éƒ¨å¤±è´¥ ("+u(i.realErrorCount)+") ",9,ed)])):b("",!0),i.hasErrorsOrWarnings?(o(),r("div",{key:5,class:W(["error-log-container",{"warning-only":!i.hasRealErrors}])},[e("div",sd,[e("span",null,u(i.hasRealErrors?"å¤±è´¥è¯¦æƒ…":"è­¦å‘Šä¿¡æ¯")+" ("+u(i.displayErrors.length)+")",1),i.hasRealErrors?(o(),r("span",td,"å¯ç‚¹å‡»å³ä¾§æŒ‰é’®å•ç‹¬é‡è¯•")):b("",!0)]),i.displayErrors.length>0?(o(),r("div",nd,[(o(!0),r(z,null,O(i.displayErrors,(d,C)=>(o(),r("div",{key:C,class:W(["error-item",{"is-warning":d.isWarning}])},[e("div",ld,[e("div",ad,[e("span",{class:"error-title",title:d.cardTitle},[d.isWarning?(o(),r("span",od,"âš ï¸")):b("",!0),K(" "+u(d.cardTitle||"æœªçŸ¥å¡ç‰‡"),1)],8,id),e("span",rd,u(i.formatTime(d.time)),1)]),e("div",{class:W(["error-msg",{"warning-msg":d.isWarning}]),title:d.error},u(d.error||"æœªçŸ¥é”™è¯¯åŸå› "),11,dd)]),d.isWarning?b("",!0):(o(),r("button",{key:0,class:"btn xs outline retry-btn",onClick:oe(c=>i.retryCard(d),["stop"]),disabled:t.starting||i.taskRunning,title:"é‡è¯•æ­¤å¡ç‰‡"}," é‡è¯• ",8,ud))],2))),128))])):(o(),r("div",cd,u(i.taskRunning?"æ­£åœ¨å®æ—¶åŒæ­¥å¤±è´¥è¯¦æƒ…...":"æœªè·å–åˆ°è¯¦ç»†é”™è¯¯è®°å½•"),1))],2)):b("",!0),i.taskRunning?(o(),r("div",vd,[e("button",{class:"btn danger",onClick:s[25]||(s[25]=(...d)=>i.stopTask&&i.stopTask(...d)),disabled:t.stopping},u(t.stopping?"åœæ­¢ä¸­...":"â¹ï¸ åœæ­¢ä»»åŠ¡"),9,pd)])):b("",!0)])):b("",!0)])):b("",!0)]),e("div",md,[e("button",{class:"btn",onClick:s[26]||(s[26]=(...d)=>i.handleClose&&i.handleClose(...d))},u(i.taskRunning?"åå°è¿è¡Œ":"å–æ¶ˆ"),1),e("div",hd,[t.step>0&&!i.taskRunning?(o(),r("button",{key:0,class:"btn",onClick:s[27]||(s[27]=d=>t.step--)},"ä¸Šä¸€æ­¥")):b("",!0),t.step<3?(o(),r("button",{key:1,class:"btn primary",onClick:s[28]||(s[28]=(...d)=>i.nextStep&&i.nextStep(...d)),disabled:!i.canNext},u(t.step===2?"ä¸‹ä¸€æ­¥ï¼šæ‰§è¡Œ":"ä¸‹ä¸€æ­¥"),9,gd)):b("",!0),t.step===3&&t.taskDone?(o(),r("button",{key:2,class:"btn primary",onClick:s[29]||(s[29]=d=>a.$emit("close"))},"å®Œæˆ")):b("",!0)])])],32)],32)):b("",!0)}const yd=Y(Ko,[["render",fd],["__scopeId","data-v-058b49e0"]]),me={deepseek:{name:"DeepSeek",icon:"ğŸ³",recommended:!0,docsUrl:"https://platform.deepseek.com/",needsApiKey:!0,needsBaseUrl:!1,defaultModel:"deepseek-chat",models:["deepseek-chat","deepseek-reasoner"],keyPrefix:"sk-",keyHint:"ä»¥ sk- å¼€å¤´ï¼Œçº¦ 32 ä½å­—ç¬¦",modelDescriptions:{"deepseek-chat":"é€šç”¨å¯¹è¯ï¼Œæ€§ä»·æ¯”æé«˜","deepseek-reasoner":"æ¨ç†å¢å¼ºï¼Œé€‚åˆå¤æ‚ä»»åŠ¡"}},siliconflow:{name:"ç¡…åŸºæµåŠ¨",icon:"ğŸš€",docsUrl:"https://siliconflow.cn/",needsApiKey:!0,needsBaseUrl:!1,defaultModel:"deepseek-ai/DeepSeek-V3",models:["deepseek-ai/DeepSeek-V3","deepseek-ai/DeepSeek-R1","THUDM/glm-4-9b-chat","Qwen/Qwen2.5-7B-Instruct"],keyHint:"åœ¨ç¡…åŸºæµåŠ¨å¹³å°è·å–",modelDescriptions:{"deepseek-ai/DeepSeek-V3":"DeepSeek V3 å®˜æ–¹æ¨¡å‹","deepseek-ai/DeepSeek-R1":"DeepSeek R1 æ¨ç†æ¨¡å‹"}},zhipu:{name:"æ™ºè°± AI",icon:"ğŸ§ ",docsUrl:"https://open.bigmodel.cn/",needsApiKey:!0,needsBaseUrl:!1,defaultModel:"glm-4-flash",models:["glm-4-flash","glm-4","glm-4-plus"],keyHint:"åœ¨æ™ºè°±å¼€æ”¾å¹³å°è·å–",modelDescriptions:{"glm-4-flash":"å¿«é€Ÿå“åº”ï¼Œå…è´¹é¢åº¦å¤š","glm-4":"å‡è¡¡æ¨¡å‹ï¼Œæ•ˆæœç¨³å®š","glm-4-plus":"å¢å¼ºç‰ˆï¼Œå¤æ‚ä»»åŠ¡æ›´ä¼˜"}},qwen:{name:"é€šä¹‰åƒé—®",icon:"â˜ï¸",docsUrl:"https://dashscope.console.aliyun.com/",needsApiKey:!0,needsBaseUrl:!1,defaultModel:"qwen-plus",models:["qwen-plus","qwen-turbo","qwen-max"],keyHint:"åœ¨é˜¿é‡Œäº‘ DashScope è·å–",modelDescriptions:{"qwen-plus":"ä¸»åŠ›æ¨¡å‹ï¼Œèƒ½åŠ›å‡è¡¡","qwen-turbo":"æé€Ÿæ¨¡å‹ï¼Œé€‚åˆç®€å•ä»»åŠ¡","qwen-max":"æœ€å¼ºæ¨¡å‹ï¼Œç†è§£åŠ›æœ€æ·±"}},volcengine:{name:"ç«å±±å¼•æ“",icon:"ğŸŒ‹",docsUrl:"https://www.volcengine.com/product/ark",needsApiKey:!0,needsBaseUrl:!1,defaultModel:"",models:[],keyHint:"åœ¨ç«å±±å¼•æ“æ§åˆ¶å°è·å– API Key",modelDescriptions:{"":"è¯·è¾“å…¥å…·ä½“çš„æ¨¡å‹æ¨ç†ç«¯ç‚¹ ID"}},moonshot:{name:"Moonshot",icon:"ğŸŒ™",docsUrl:"https://platform.moonshot.cn/",needsApiKey:!0,needsBaseUrl:!1,defaultModel:"moonshot-v1-8k",models:["moonshot-v1-8k","moonshot-v1-32k","moonshot-v1-128k"],keyHint:"åœ¨ Moonshot å¹³å°è·å–",modelDescriptions:{"moonshot-v1-8k":"8k ä¸Šä¸‹æ–‡çª—å£","moonshot-v1-32k":"32k ä¸Šä¸‹æ–‡çª—å£"}},yi:{name:"é›¶ä¸€ä¸‡ç‰©",icon:"0ï¸âƒ£",docsUrl:"https://platform.lingyiwanwu.com/",needsApiKey:!0,needsBaseUrl:!1,defaultModel:"yi-lightning",models:["yi-lightning","yi-large","yi-medium"],keyHint:"åœ¨é›¶ä¸€ä¸‡ç‰©å¹³å°è·å–",modelDescriptions:{"yi-lightning":"æé€Ÿå“åº”","yi-large":"é«˜æ€§èƒ½æ——èˆ°"}},openai:{name:"OpenAI",icon:"ğŸ¤–",docsUrl:"https://platform.openai.com/",needsApiKey:!0,needsBaseUrl:!1,defaultModel:"gpt-4o-mini",models:["gpt-4o-mini","gpt-4o","o1-mini"],keyPrefix:"sk-",keyHint:"ä»¥ sk- å¼€å¤´",modelDescriptions:{"gpt-4o-mini":"è½»é‡å¿«é€Ÿï¼Œæ€§ä»·æ¯”é«˜","gpt-4o":"æœ€å¼ºå¤šæ¨¡æ€æ¨¡å‹","o1-mini":"æ¨ç†å¢å¼ºæ¨¡å‹"}},anthropic:{name:"Claude",icon:"ğŸ¨",docsUrl:"https://console.anthropic.com/",needsApiKey:!0,needsBaseUrl:!1,defaultModel:"claude-3-5-sonnet-20240620",models:["claude-3-5-sonnet-20240620","claude-3-haiku-20240307"],keyPrefix:"sk-ant-",keyHint:"ä»¥ sk-ant- å¼€å¤´",modelDescriptions:{"claude-3-5-sonnet-20240620":"ç›®å‰æœ€å¼ºç†è§£æ¨¡å‹ä¹‹ä¸€","claude-3-haiku-20240307":"æè‡´é€Ÿåº¦ä¸æ€§ä»·æ¯”"}},gemini:{name:"Gemini",icon:"â™Š",docsUrl:"https://aistudio.google.com/",needsApiKey:!0,needsBaseUrl:!1,defaultModel:"gemini-1.5-flash",models:["gemini-1.5-flash","gemini-1.5-pro","gemini-2.0-flash-exp"],keyPrefix:"AIza",keyHint:"ä»¥ AIza å¼€å¤´",modelDescriptions:{"gemini-1.5-flash":"Google æé€Ÿæ¨¡å‹","gemini-1.5-pro":"å…·å¤‡ç™¾ä¸‡ä¸Šä¸‹æ–‡çª—å£"}},openrouter:{name:"OpenRouter",icon:"ğŸŒ",docsUrl:"https://openrouter.ai/",needsApiKey:!0,needsBaseUrl:!1,defaultModel:"google/gemini-flash-1.5",models:["google/gemini-flash-1.5","anthropic/claude-3.5-sonnet","openai/gpt-4o-mini"],keyHint:"åœ¨ OpenRouter è·å–ï¼Œæ”¯æŒèšåˆæ‰€æœ‰æ¨¡å‹"},ollama:{name:"Ollama",icon:"ğŸ¦™",local:!0,docsUrl:"https://ollama.com/",needsApiKey:!1,needsBaseUrl:!0,defaultBaseUrl:"http://localhost:11434",defaultModel:"llama3.2",models:["llama3.2","qwen2.5","mistral","deepseek-r1"],modelDescriptions:{"llama3.2":"Meta æœ€æ–°å¼€æºæ¨¡å‹","qwen2.5":"é˜¿é‡Œæœ€å¼ºå¼€æºç³»åˆ—","deepseek-r1":"DeepSeek æ¨ç†å¼€æºç‰ˆ"}},custom:{name:"è‡ªå®šä¹‰",icon:"ğŸ› ï¸",needsApiKey:!0,needsBaseUrl:!0,defaultModel:"",models:[],keyHint:"ä»»æ„ç¬¦åˆ OpenAI è§„èŒƒçš„æ¥å£"}},kd={name:"AISettings",components:{AIBatchWizard:yd},data(){return{providers:me,config:{provider:"deepseek",apiKey:"",baseUrl:"",model:"deepseek-chat",autoGenerate:!1,hasApiKey:!1},activeProviderKey:"",modelSelect:"deepseek-chat",showApiKey:!1,testing:!1,saving:!1,clearing:!1,showClearConfirm:!1,refreshing:!1,starting:!1,stopping:!1,connectionTested:!1,connectionOk:!1,stats:null,task:{running:!1,type:"",mode:"",current:0,total:0,currentCard:"",startTime:0,errors:[],successCount:0,failCount:0},eventSource:null,toast:{show:!1,msg:"",type:"info"},showWizard:!1,testError:null,apiKeyValidation:{valid:!0,message:""},baseUrlValidation:{valid:!0,message:""}}},computed:{currentProvider(){return me[this.config.provider]||me.deepseek},sortedProviders(){return Object.entries(this.providers).map(([s,l])=>ne(G({key:s},l),{isActive:s===this.activeProviderKey})).sort((s,l)=>s.isActive&&!l.isActive?-1:!s.isActive&&l.isActive?1:s.key===this.config.provider?-1:l.key===this.config.provider?1:s.recommended&&!l.recommended?-1:!s.recommended&&l.recommended?1:0)},canTest(){return!(this.currentProvider.needsApiKey&&!this.config.apiKey&&!this.config.hasApiKey||this.currentProvider.needsBaseUrl&&!this.config.baseUrl||!this.apiKeyValidation.valid&&this.config.apiKey||!this.baseUrlValidation.valid&&this.config.baseUrl)},selectedModelDescription(){return(this.currentProvider.modelDescriptions||{})[this.config.model]||""},connectionStatus(){return!this.config.hasApiKey&&!this.config.apiKey?"none":this.connectionTested?this.connectionOk?"ok":"err":"pending"},statusText(){return{none:"æœªé…ç½®",ok:"å·²è¿æ¥",err:"è¿æ¥å¤±è´¥",pending:"å¾…æµ‹è¯•"}[this.connectionStatus]},totalMissing(){return this.stats?this.stats.emptyName+this.stats.emptyDesc+this.stats.emptyTags:0},taskPercent(){return this.task.total?Math.round(this.task.current/this.task.total*100):0},taskTitle(){const a={name:"åç§°",description:"æè¿°",tags:"æ ‡ç­¾"},s=this.task.types||[this.task.type];return Array.isArray(s)&&s.length>0?`æ­£åœ¨ç”Ÿæˆ${s.map(l=>a[l]||l).join("ã€")}`:"æ­£åœ¨ç”Ÿæˆå†…å®¹"},taskEta(){if(!this.task.startTime||this.task.current<2)return"";const s=(Date.now()-this.task.startTime)/this.task.current,l=(this.task.total-this.task.current)*s;return l<6e4?`${Math.round(l/1e3)}ç§’`:`${Math.round(l/6e4)}åˆ†é’Ÿ`}},mounted(){return x(this,null,function*(){yield Promise.all([this.loadConfig(),this.refreshStats()]),this.initRealtimeUpdates(),document.addEventListener("visibilitychange",this.handleVisibilityChange)})},beforeUnmount(){this.closeEventSource(),document.removeEventListener("visibilitychange",this.handleVisibilityChange)},methods:{handleVisibilityChange(){document.visibilityState==="visible"&&(this.refreshStats(),this.eventSource||this.initRealtimeUpdates())},selectProvider(a){return x(this,null,function*(){var s;if(!(this.config.provider===a&&this.config.hasApiKey)){this.config.provider=a,this.testing=!0;try{const{data:l}=yield We(a);if(l.success&&l.config){const g=l.config;this.config.hasApiKey=g.hasApiKey,this.config.apiKey="",this.config.baseUrl=g.baseUrl||this.currentProvider.defaultBaseUrl||"",this.config.model=g.model||this.currentProvider.defaultModel||"",this.modelSelect=(s=this.currentProvider.models)!=null&&s.includes(this.config.model)?this.config.model:"",this.connectionOk=g.lastTestedOk,this.connectionTested=g.lastTestedOk}else this.resetProviderConfig(a)}catch(l){console.error("åˆ‡æ¢æä¾›å•†å¤±è´¥:",l),this.resetProviderConfig(a)}finally{this.testing=!1,this.testError=null,this.apiKeyValidation={valid:!0,message:""},this.baseUrlValidation={valid:!0,message:""}}}})},resetProviderConfig(a){var s;this.config.hasApiKey=!1,this.config.apiKey="",this.config.baseUrl=this.providers[a].defaultBaseUrl||"",this.config.model=this.providers[a].defaultModel||"",this.modelSelect=(s=this.providers[a].models)!=null&&s.includes(this.config.model)?this.config.model:"",this.connectionTested=!1,this.connectionOk=!1},validateApiKey(a){if(!a){this.apiKeyValidation={valid:!0,message:""};return}const s=this.currentProvider;if(s.keyPrefix&&!a.startsWith(s.keyPrefix)){this.apiKeyValidation={valid:!1,message:`æ ¼å¼ä¸æ­£ç¡®ï¼Œåº”ä»¥ ${s.keyPrefix} å¼€å¤´`};return}if(a.length<20){this.apiKeyValidation={valid:!0,message:"âš ï¸ API Key è¾ƒçŸ­ï¼Œè¯·ç¡®è®¤æ˜¯å¦å®Œæ•´å¤åˆ¶",warning:!0};return}if(/\s/.test(a)){this.apiKeyValidation={valid:!1,message:"åŒ…å«ç©ºæ ¼ï¼Œè¯·æ£€æŸ¥æ˜¯å¦æœ‰å¤šä½™å­—ç¬¦"};return}this.apiKeyValidation={valid:!0,message:""}},validateBaseUrl(a){if(!a){this.baseUrlValidation={valid:!0,message:""};return}if(!/^https?:\/\//i.test(a)){this.baseUrlValidation={valid:!1,message:"è¯·ä»¥ http:// æˆ– https:// å¼€å¤´"};return}if(/\s/.test(a)){this.baseUrlValidation={valid:!1,message:"åŒ…å«ç©ºæ ¼ï¼Œè¯·æ£€æŸ¥æ˜¯å¦æœ‰å¤šä½™å­—ç¬¦"};return}if(a.endsWith("/v1")||a.endsWith("/v1/")){this.baseUrlValidation={valid:!1,message:"æ— éœ€åŒ…å« /v1 è·¯å¾„ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ·»åŠ "};return}try{new URL(a),this.baseUrlValidation={valid:!0,message:""}}catch(s){this.baseUrlValidation={valid:!1,message:"URL æ ¼å¼ä¸æ­£ç¡®"}}},onModelChange(){this.modelSelect&&(this.config.model=this.modelSelect)},loadConfig(){return x(this,null,function*(){var a;try{const{data:s}=yield We();if(s.success){const l=s.config;this.activeProviderKey=l.provider||"deepseek",this.config.provider=this.activeProviderKey,this.config.hasApiKey=l.hasApiKey,this.config.baseUrl=l.baseUrl||"",this.config.model=l.model||this.currentProvider.defaultModel,this.modelSelect=(a=this.currentProvider.models)!=null&&a.includes(this.config.model)?this.config.model:"",this.config.autoGenerate=l.autoGenerate||!1,l.lastTestedOk?(this.connectionTested=!0,this.connectionOk=!0):l.hasApiKey&&(this.connectionTested=!1,this.connectionOk=!1)}}catch(s){}})},saveConfig(){return x(this,null,function*(){var s,l,g,t;if(this.saving||this.testing)return;this.saving=!0,this.testing=!0,this.testError=null;const a=this.config.provider!==this.activeProviderKey;try{const i={provider:this.config.provider,model:this.config.model,baseUrl:this.config.baseUrl||this.currentProvider.defaultBaseUrl||""};this.config.apiKey&&(i.apiKey=this.config.apiKey);let d=!1,C=null,c="";try{const{data:y}=yield Ps(i);d=y.success,y.success?(c=y.responseTime,y.suggestedBaseUrl&&(C=y.suggestedBaseUrl,this.config.baseUrl=C)):this.testError=this.parseTestError(y.message)}catch(y){d=!1,this.testError=this.parseTestError(((l=(s=y.response)==null?void 0:s.data)==null?void 0:l.message)||y.message||"è¿æ¥å¤±è´¥")}this.connectionTested=!0,this.connectionOk=d;const{data:k}=yield Rs({provider:this.config.provider,apiKey:this.config.apiKey||void 0,baseUrl:this.config.baseUrl||this.currentProvider.defaultBaseUrl,model:this.config.model,autoGenerate:this.config.autoGenerate,lastTestedOk:d});if(k.success)if(this.config.hasApiKey=!0,this.config.apiKey="",this.activeProviderKey=this.config.provider,d){const y=a?`å·²åˆ‡æ¢è‡³ ${this.currentProvider.name} å¹¶è¿æ¥æˆåŠŸ (${c})`:`é…ç½®å·²ä¿å­˜å¹¶è¿æ¥æˆåŠŸ (${c})`;this.showToast(y,"success")}else this.showToast("é…ç½®å·²ä¿å­˜ï¼Œä½†è¿æ¥æµ‹è¯•å¤±è´¥","warning");else this.showToast(k.message,"error")}catch(i){this.showToast(((t=(g=i.response)==null?void 0:g.data)==null?void 0:t.message)||"æ“ä½œå¤±è´¥","error")}finally{this.saving=!1,this.testing=!1}})},parseTestError(a){const s={title:"è¿æ¥å¤±è´¥",detail:a,suggestions:[]},l=a.toLowerCase();return l.includes("401")||l.includes("invalid")||l.includes("api key")||l.includes("authentication")||l.includes("unauthorized")?(s.title="API Key æ— æ•ˆ",s.suggestions=["æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®å¤åˆ¶ï¼ˆæ³¨æ„é¦–å°¾ç©ºæ ¼ï¼‰","ç¡®è®¤ API Key æ˜¯å¦å·²è¿‡æœŸæˆ–è¢«ç¦ç”¨","æ£€æŸ¥è´¦æˆ·ä½™é¢æ˜¯å¦å……è¶³"]):l.includes("403")||l.includes("forbidden")||l.includes("permission")?(s.title="æƒé™ä¸è¶³",s.suggestions=["æ£€æŸ¥ API Key æ˜¯å¦æœ‰å¯¹åº”æ¨¡å‹çš„è®¿é—®æƒé™","éƒ¨åˆ†æ¨¡å‹éœ€è¦å•ç‹¬ç”³è¯·å¼€é€š","æ£€æŸ¥è´¦æˆ·æ˜¯å¦å·²å®Œæˆå®åè®¤è¯"]):l.includes("404")||l.includes("not found")||l.includes("model")?(s.title="æ¨¡å‹ä¸å­˜åœ¨",s.suggestions=["æ£€æŸ¥æ¨¡å‹åç§°æ˜¯å¦æ­£ç¡®","è¯¥æ¨¡å‹å¯èƒ½å·²ä¸‹çº¿æˆ–éœ€è¦ç”³è¯·è®¿é—®","å°è¯•åˆ‡æ¢åˆ°å…¶ä»–æ¨¡å‹"]):l.includes("429")||l.includes("rate limit")||l.includes("too many")?(s.title="è¯·æ±‚è¿‡äºé¢‘ç¹",s.suggestions=["ç¨åå†è¯•","æ£€æŸ¥ API è°ƒç”¨é…é¢æ˜¯å¦å·²ç”¨å®Œ","è€ƒè™‘å‡çº§å¥—é¤æˆ–é™ä½è°ƒç”¨é¢‘ç‡"]):l.includes("timeout")||l.includes("è¶…æ—¶")?(s.title="è¿æ¥è¶…æ—¶",s.suggestions=["æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸","å¦‚ä½¿ç”¨ä»£ç†ï¼Œç¡®è®¤ä»£ç†é…ç½®æ­£ç¡®","API æœåŠ¡å¯èƒ½æš‚æ—¶ä¸å¯ç”¨ï¼Œç¨åå†è¯•"]):l.includes("network")||l.includes("econnrefused")||l.includes("dns")||l.includes("fetch")?(s.title="ç½‘ç»œé”™è¯¯",s.suggestions=["æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸","å¦‚ä½¿ç”¨ Ollamaï¼Œç¡®è®¤æœåŠ¡å·²å¯åŠ¨","æ£€æŸ¥ Base URL æ˜¯å¦æ­£ç¡®"]):(l.includes("base url")||l.includes("url"))&&(s.title="Base URL é…ç½®é”™è¯¯",s.suggestions=["æ£€æŸ¥ URL æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼ˆåŒ…å« http:// æˆ– https://ï¼‰","ç¡®è®¤ URL æœ«å°¾æ— å¤šä½™æ–œæ ","éªŒè¯æœåŠ¡åœ°å€æ˜¯å¦å¯è®¿é—®"]),s},clearConfig(){return x(this,null,function*(){var a,s;this.clearing=!0;try{const{data:l}=yield Ds();l.success?(this.showToast("é…ç½®å·²æ¸…é™¤","success"),this.config={provider:"deepseek",apiKey:"",baseUrl:"",model:me.deepseek.defaultModel,autoGenerate:!1,hasApiKey:!1},this.modelSelect=me.deepseek.defaultModel,this.connectionTested=!1,this.connectionOk=!1,this.testError=null,this.showClearConfirm=!1,this.refreshStats()):this.showToast(l.message||"æ¸…é™¤å¤±è´¥","error")}catch(l){this.showToast(((s=(a=l.response)==null?void 0:a.data)==null?void 0:s.message)||"æ¸…é™¤å¤±è´¥","error")}this.clearing=!1})},refreshStats(){return x(this,null,function*(){this.refreshing=!0;try{const{data:a}=yield Bs();a.success&&(this.stats=a.stats)}catch(a){console.error("Failed to refresh stats:",a)}this.refreshing=!1})},initRealtimeUpdates(){return x(this,null,function*(){this.closeEventSource();const a=localStorage.getItem("token"),s=`/api/ai/batch-task/stream${a?"?token="+encodeURIComponent(a):""}`;this.eventSource=new EventSource(s),this.eventSource.onmessage=l=>{try{const g=JSON.parse(l.data);this.updateTaskState(g)}catch(g){console.error("Failed to parse SSE data:",g)}},this.eventSource.onerror=l=>{console.warn("SSE connection error, falling back to polling...",l),this.closeEventSource()}})},closeEventSource(){this.eventSource&&(this.eventSource.close(),this.eventSource=null)},updateTaskState(a){if(a){if(this.task.running&&!a.running){this.task.current=this.task.total,this.task.total>0&&a.successCount!==void 0&&this.showToast(`ä»»åŠ¡ç»“æŸï¼æˆåŠŸ ${a.successCount||0}ï¼Œå¤±è´¥ ${a.failCount||0}`,a.failCount>0?"info":"success"),this.refreshStats(),this.task=ne(G(G({},this.task),a),{running:!0}),setTimeout(()=>{this.task.running=!1,this.refreshStats()},2e3);return}if(a.running||this.task.running){const s=this.task.running&&!a.running;this.task=ne(G(G({},this.task),a),{running:s?!0:!!a.running,startTime:a.startTime||this.task.startTime||Date.now()})}else this.task=ne(G(G({},this.task),a),{running:!1})}},startTask(a,s){return x(this,null,function*(){var l,g;if(!(this.starting||this.task.running)&&!(s==="all"&&!confirm(`ç¡®å®šè¦é‡æ–°ç”Ÿæˆæ‰€æœ‰å¡ç‰‡çš„${a==="name"?"åç§°":a==="description"?"æè¿°":"æ ‡ç­¾"}å—ï¼Ÿ`))){this.starting=!0;try{this.task={running:!0,type:a,mode:s,current:0,total:0,successCount:0,failCount:0,currentCard:"å‡†å¤‡ä¸­...",startTime:Date.now(),errors:[],types:a==="all"?["name","description","tags"]:[a]};const{data:t}=yield Ae({type:a,mode:s});if(!t.success){this.showToast(t.message||"å¯åŠ¨å¤±è´¥","error"),this.task.running=!1;return}if(t.total===0){this.showToast("æ²¡æœ‰éœ€è¦å¤„ç†çš„å¡ç‰‡","info"),this.task.running=!1,this.refreshStats();return}this.task.total=t.total,this.showToast(`ä»»åŠ¡å·²å¯åŠ¨ï¼Œæ­£åœ¨å¤„ç† ${t.total} ä¸ªå¡ç‰‡`,"success"),this.initRealtimeUpdates()}catch(t){this.showToast(((g=(l=t.response)==null?void 0:l.data)==null?void 0:g.message)||"å¯åŠ¨å¤±è´¥","error"),this.task.running=!1}finally{this.starting=!1}}})},stopTask(){return x(this,null,function*(){this.stopping=!0;try{yield je(),this.showToast("æ­£åœ¨åœæ­¢...","info"),this.refreshStats()}catch(a){}setTimeout(()=>{this.stopping=!1},2e3)})},retryCard(a){return x(this,null,function*(){a.cardId&&(yield this.doStartBatchTask([a.cardId],this.task.types||["name","description","tags"]))})},retryAllFailed(){return x(this,null,function*(){const a=this.task.errors.map(s=>s.cardId).filter(s=>!!s);a.length!==0&&(yield this.doStartBatchTask(a,this.task.types||["name","description","tags"]))})},doStartBatchTask(a,s){return x(this,null,function*(){var l,g;if(!(this.starting||this.task.running)){this.starting=!0;try{this.task={running:!0,current:0,total:a.length,successCount:0,failCount:0,currentCard:"å‡†å¤‡ä¸­...",startTime:Date.now(),errors:[],types:s};const{data:t}=yield Ae({cardIds:a,types:s});if(!t.success){this.showToast(t.message||"å¯åŠ¨å¤±è´¥","error"),this.task.running=!1;return}this.showToast("é‡è¯•ä»»åŠ¡å·²å¯åŠ¨","success"),this.initRealtimeUpdates()}catch(t){this.showToast(((g=(l=t.response)==null?void 0:l.data)==null?void 0:g.message)||"å¯åŠ¨å¤±è´¥","error"),this.task.running=!1}finally{this.starting=!1}}})},showToast(a,s="info"){this.toast={show:!0,msg:a,type:s},setTimeout(()=>{this.toast.show=!1},3e3)},onWizardClose(){this.showWizard=!1,this.refreshStats(),this.task.running||this.initRealtimeUpdates()},onWizardStart(a){const s=a.running!==!1;this.task=ne(G(G({},this.task),a),{running:s,startTime:s?Date.now():this.task.startTime}),s&&this.initRealtimeUpdates()}}},bd={class:"ai-settings"},wd={class:"page-header"},_d={class:"header-left"},Cd={key:0,class:"active-badge"},Md={class:"value"},Sd={key:0,class:"quick-start"},Ud={class:"section"},$d={class:"provider-select-wrapper"},xd=["value"],Td=["value"],Ad={class:"section"},Vd={class:"section-header"},Id={class:"section-title-group"},Bd={key:0,class:"active-tag"},Dd={key:1,class:"editing-tag"},Pd=["href"],Rd={class:"config-form"},Ed={key:0,class:"form-item"},Kd={class:"input-group"},Ld=["type","placeholder"],Wd={key:0,class:"input-hint"},zd={key:1,class:"input-error-msg"},Od={key:2,class:"input-warning-msg"},Nd={key:1,class:"form-item"},Fd={key:0,class:"label-hint"},Hd=["placeholder"],qd={key:0,class:"input-hint"},jd={key:1,class:"input-hint"},Gd={key:2,class:"input-error-msg"},Jd={class:"form-item"},Qd={class:"model-select"},Xd=["value"],Yd=["placeholder"],Zd={key:0,class:"model-description"},eu={class:"form-item switch-item"},su={class:"switch"},tu={class:"form-actions"},nu=["disabled"],lu=["disabled"],au={key:2,class:"test-error-panel"},iu={class:"error-header"},ou={class:"error-title"},ru={key:0,class:"error-detail"},du={key:1,class:"error-suggestions"},uu={class:"section"},cu={class:"section-header"},vu=["disabled"],pu={key:0,class:"stats"},mu={class:"stat"},hu={key:1,class:"task-panel"},gu={class:"task-header"},fu={class:"task-title"},yu={class:"task-counts"},ku={class:"count-item success"},bu={key:0,class:"count-item fail"},wu={class:"count-item total"},_u={class:"progress-wrap"},Cu={class:"progress-bar"},Mu={class:"progress-text"},Su={class:"task-info"},Uu=["title"],$u={key:1,class:"task-eta"},xu={key:0,class:"task-errors"},Tu={class:"error-header"},Au=["disabled"],Vu={key:0,class:"error-list"},Iu={class:"err-info"},Bu=["title"],Du=["title"],Pu=["onClick","disabled"],Ru={key:1,class:"error-empty-hint"},Eu={class:"task-actions"},Ku={key:0,class:"task-concurrency"},Lu={key:0,class:"rate-limit-tag"},Wu=["disabled"],zu={key:2,class:"batch-actions"},Ou={class:"action-bar"},Nu=["disabled"],Fu=["disabled"],Hu={key:0,class:"action-hint"},qu={class:"modal-header"},ju={class:"modal-footer"},Gu=["disabled"];function Ju(a,s,l,g,t,i){var C;const d=ns("AIBatchWizard");return o(),r("div",bd,[e("div",wd,[e("div",_d,[s[23]||(s[23]=e("h2",null,"ğŸ¤– AI æ™ºèƒ½ç”Ÿæˆ",-1)),t.activeProviderKey?(o(),r("div",Cd,[s[22]||(s[22]=e("span",{class:"label"},"å½“å‰ä½¿ç”¨:",-1)),e("span",Md,u((C=t.providers[t.activeProviderKey])==null?void 0:C.name),1)])):b("",!0)]),e("div",{class:W(["connection-status",i.connectionStatus])},[s[24]||(s[24]=e("span",{class:"status-dot"},null,-1)),e("span",null,u(i.statusText),1)],2)]),!t.config.hasApiKey&&!t.config.apiKey?(o(),r("div",Sd,[...s[25]||(s[25]=[ue('<div class="quick-start-icon" data-v-af6b15da>ğŸš€</div><div class="quick-start-content" data-v-af6b15da><h4 data-v-af6b15da>å¿«é€Ÿå¼€å§‹</h4><p data-v-af6b15da>é…ç½® AI æœåŠ¡åï¼Œå¯è‡ªåŠ¨ä¸ºå¡ç‰‡ç”Ÿæˆåç§°ã€æè¿°å’Œæ ‡ç­¾</p><div class="quick-start-steps" data-v-af6b15da><span class="step" data-v-af6b15da>1. é€‰æ‹©æä¾›å•†</span><span class="step" data-v-af6b15da>2. å¡«å†™ API Key</span><span class="step" data-v-af6b15da>3. æµ‹è¯•è¿æ¥</span></div></div>',2)])])):b("",!0),e("div",Ud,[s[26]||(s[26]=e("div",{class:"section-header"},[e("h3",null,"é€‰æ‹© AI æä¾›å•†"),e("span",{class:"section-hint"},"æ¨èä½¿ç”¨ DeepSeekï¼Œæ€§ä»·æ¯”é«˜")],-1)),e("div",$d,[e("select",{value:t.config.provider,class:"input provider-dropdown",onChange:s[0]||(s[0]=c=>i.selectProvider(c.target.value))},[(o(!0),r(z,null,O(i.sortedProviders,c=>(o(),r("option",{key:c.key,value:c.key},u(c.icon)+" "+u(c.name)+" "+u(c.isActive?"(å½“å‰ä½¿ç”¨)":"")+" "+u(c.recommended?"(æ¨è)":"")+" "+u(c.local?"(æœ¬åœ°)":""),9,Td))),128))],40,xd)])]),e("div",Ad,[e("div",Vd,[e("div",Id,[s[27]||(s[27]=e("h3",null,"API é…ç½®",-1)),t.config.provider===t.activeProviderKey?(o(),r("span",Bd," å·²æ¿€æ´» ")):(o(),r("span",Dd," é…ç½®ä¸­ "))]),i.currentProvider.docsUrl?(o(),r("a",{key:0,href:i.currentProvider.docsUrl,target:"_blank",class:"docs-link"}," ğŸ“– è·å– API Key ",8,Pd)):b("",!0)]),e("div",Rd,[i.currentProvider.needsApiKey?(o(),r("div",Ed,[e("label",null,[s[28]||(s[28]=e("span",null,"API Key",-1)),e("span",{class:W(["label-status",{ok:t.config.hasApiKey}])},u(t.config.hasApiKey?"âœ“ å·²é…ç½®":"æœªé…ç½®"),3)]),e("div",Kd,[S(e("input",{type:t.showApiKey?"text":"password","onUpdate:modelValue":s[1]||(s[1]=c=>t.config.apiKey=c),placeholder:t.config.hasApiKey?"å·²é…ç½®ï¼ˆç•™ç©ºä¿æŒä¸å˜ï¼‰":"è¯·è¾“å…¥ API Key",class:W(["input",{"input-error":!t.apiKeyValidation.valid}]),onInput:s[2]||(s[2]=c=>i.validateApiKey(t.config.apiKey))},null,42,Ld),[[qe,t.config.apiKey]]),e("button",{type:"button",class:"input-btn",onClick:s[3]||(s[3]=c=>t.showApiKey=!t.showApiKey)},u(t.showApiKey?"ğŸ™ˆ":"ğŸ‘ï¸"),1)]),i.currentProvider.keyHint&&!t.config.apiKey?(o(),r("div",Wd,u(i.currentProvider.keyHint),1)):b("",!0),t.apiKeyValidation.valid?t.apiKeyValidation.warning?(o(),r("div",Od,u(t.apiKeyValidation.message),1)):b("",!0):(o(),r("div",zd,u(t.apiKeyValidation.message),1))])):b("",!0),i.currentProvider.needsBaseUrl?(o(),r("div",Nd,[e("label",null,[s[29]||(s[29]=e("span",null,"Base URL",-1)),i.currentProvider.local?(o(),r("span",Fd,"æœ¬åœ°æœåŠ¡")):b("",!0)]),S(e("input",{type:"text","onUpdate:modelValue":s[4]||(s[4]=c=>t.config.baseUrl=c),placeholder:i.currentProvider.defaultBaseUrl||"https://api.example.com",class:W(["input",{"input-error":!t.baseUrlValidation.valid}]),onInput:s[5]||(s[5]=c=>i.validateBaseUrl(t.config.baseUrl))},null,42,Hd),[[E,t.config.baseUrl]]),i.currentProvider.local&&t.baseUrlValidation.valid?(o(),r("div",qd," ç¡®ä¿ Ollama æœåŠ¡å·²å¯åŠ¨ï¼Œé»˜è®¤ç«¯å£ 11434 ")):!i.currentProvider.local&&t.baseUrlValidation.valid&&!t.config.baseUrl?(o(),r("div",jd," å¡«å†™ API æœåŠ¡åœ°å€ï¼Œæ— éœ€åŒ…å« /v1 è·¯å¾„ ")):b("",!0),t.baseUrlValidation.valid?b("",!0):(o(),r("div",Gd,u(t.baseUrlValidation.message),1))])):b("",!0),e("div",Jd,[s[31]||(s[31]=e("label",null,"æ¨¡å‹",-1)),e("div",Qd,[S(e("select",{"onUpdate:modelValue":s[6]||(s[6]=c=>t.modelSelect=c),class:"input",onChange:s[7]||(s[7]=(...c)=>i.onModelChange&&i.onModelChange(...c))},[s[30]||(s[30]=e("option",{value:""},"è‡ªå®šä¹‰æ¨¡å‹",-1)),(o(!0),r(z,null,O(i.currentProvider.models,c=>(o(),r("option",{key:c,value:c},u(c),9,Xd))),128))],544),[[ie,t.modelSelect]]),t.modelSelect===""?S((o(),r("input",{key:0,type:"text","onUpdate:modelValue":s[8]||(s[8]=c=>t.config.model=c),placeholder:i.currentProvider.defaultModel||"è¾“å…¥æ¨¡å‹åç§°",class:"input"},null,8,Yd)),[[E,t.config.model]]):b("",!0)]),i.selectedModelDescription?(o(),r("div",Zd,u(i.selectedModelDescription),1)):b("",!0)]),e("div",eu,[s[33]||(s[33]=e("span",null,[e("strong",null,"è‡ªåŠ¨ç”Ÿæˆ"),e("small",null,"æ·»åŠ å¡ç‰‡æ—¶è‡ªåŠ¨ç”Ÿæˆåç§°ã€æè¿°å’Œæ ‡ç­¾")],-1)),e("label",su,[S(e("input",{type:"checkbox","onUpdate:modelValue":s[9]||(s[9]=c=>t.config.autoGenerate=c)},null,512),[[J,t.config.autoGenerate]]),s[32]||(s[32]=e("span",{class:"slider"},null,-1))])]),e("div",tu,[e("button",{class:"btn primary",onClick:s[10]||(s[10]=(...c)=>i.saveConfig&&i.saveConfig(...c)),disabled:t.saving||t.testing||!t.apiKeyValidation.valid&&t.config.apiKey},[t.saving||t.testing?(o(),r(z,{key:0},[K("â³ æ­£åœ¨æµ‹è¯•å¹¶ä¿å­˜...")],64)):t.config.provider!==t.activeProviderKey?(o(),r(z,{key:1},[K("ğŸš€ æ¿€æ´»å¹¶æµ‹è¯•è¿æ¥")],64)):(o(),r(z,{key:2},[K("ğŸ’¾ ä¿å­˜å¹¶æµ‹è¯•è¿æ¥")],64))],8,nu),t.config.hasApiKey||t.config.baseUrl||t.connectionOk?(o(),r("button",{key:0,class:"btn danger",onClick:s[11]||(s[11]=c=>t.showClearConfirm=!0),disabled:t.clearing},u(t.clearing?"â³ æ¸…é™¤ä¸­...":"ğŸ—‘ï¸ æ¸…é™¤é…ç½®"),9,lu)):b("",!0)]),t.testError&&!t.connectionOk?(o(),r("div",au,[e("div",iu,[s[34]||(s[34]=e("span",{class:"error-icon"},"âš ï¸",-1)),e("span",ou,u(t.testError.title),1)]),t.testError.detail?(o(),r("div",ru,u(t.testError.detail),1)):b("",!0),t.testError.suggestions.length?(o(),r("div",du,[s[35]||(s[35]=e("div",{class:"suggestion-title"},"æ’æŸ¥å»ºè®®ï¼š",-1)),e("ul",null,[(o(!0),r(z,null,O(t.testError.suggestions,(c,k)=>(o(),r("li",{key:k},u(c),1))),128))])])):b("",!0)])):b("",!0)])]),e("div",uu,[e("div",cu,[s[36]||(s[36]=e("h3",null,"æ‰¹é‡ç”Ÿæˆ",-1)),e("button",{class:"icon-btn",onClick:s[12]||(s[12]=(...c)=>i.refreshStats&&i.refreshStats(...c)),disabled:t.refreshing},u(t.refreshing?"â³":"ğŸ”„"),9,vu)]),t.stats?(o(),r("div",pu,[e("div",mu,[e("span",null,u(t.stats.total),1),s[37]||(s[37]=K("æ€»æ•°",-1))]),e("div",{class:W(["stat",{warn:t.stats.emptyName}])},[e("span",null,u(t.stats.emptyName),1),s[38]||(s[38]=K("ç¼ºåç§°",-1))],2),e("div",{class:W(["stat",{warn:t.stats.emptyDesc}])},[e("span",null,u(t.stats.emptyDesc),1),s[39]||(s[39]=K("ç¼ºæè¿°",-1))],2),e("div",{class:W(["stat",{warn:t.stats.emptyTags}])},[e("span",null,u(t.stats.emptyTags),1),s[40]||(s[40]=K("ç¼ºæ ‡ç­¾",-1))],2)])):b("",!0),t.task.running&&!t.showWizard?(o(),r("div",hu,[e("div",gu,[e("span",fu,u(i.taskTitle),1),e("div",yu,[e("span",ku,"æˆåŠŸ: "+u(t.task.successCount||0),1),t.task.failCount?(o(),r("span",bu,"å¤±è´¥: "+u(t.task.failCount),1)):b("",!0),e("span",wu,u(t.task.current)+" / "+u(t.task.total),1)])]),e("div",_u,[e("div",Cu,[e("div",{class:"progress-fill",style:ve({width:i.taskPercent+"%"})},null,4)]),e("span",Mu,u(i.taskPercent)+"%",1)]),e("div",Su,[t.task.currentCard?(o(),r("span",{key:0,class:"task-current",title:t.task.currentCard},"æ­£åœ¨å¤„ç†: "+u(t.task.currentCard),9,Uu)):b("",!0),i.taskEta?(o(),r("span",$u,"å‰©ä½™çº¦ "+u(i.taskEta),1)):b("",!0)]),t.task.failCount>0?(o(),r("div",xu,[e("div",Tu,[e("span",null,"å¤±è´¥è¯¦æƒ… ("+u(t.task.errors?t.task.errors.length:0)+"/"+u(t.task.failCount)+")",1),!t.task.running&&t.task.failCount>0?(o(),r("button",{key:0,class:"btn xs outline retry-all-btn",onClick:s[13]||(s[13]=(...c)=>i.retryAllFailed&&i.retryAllFailed(...c)),disabled:t.starting}," ğŸ”„ é‡è¯•å…¨éƒ¨å¤±è´¥ ",8,Au)):b("",!0)]),t.task.errors&&t.task.errors.length>0?(o(),r("div",Vu,[(o(!0),r(z,null,O(t.task.errors,(c,k)=>(o(),r("div",{key:k,class:"error-item"},[e("div",Iu,[e("span",{class:"err-title",title:c.cardTitle},u(c.cardTitle)+":",9,Bu),e("span",{class:"err-msg",title:c.error},u(c.error),9,Du)]),e("button",{class:"btn xs outline",onClick:y=>i.retryCard(c),disabled:t.starting||t.task.running},"é‡è¯•",8,Pu)]))),128))])):(o(),r("div",Ru," æ­£åœ¨åŒæ­¥å¤±è´¥è¯¦æƒ…... "))])):b("",!0),e("div",Eu,[t.task.concurrency?(o(),r("div",Ku,[K(" å¹¶å‘æ•°: "+u(t.task.concurrency)+" ",1),t.task.isRateLimited?(o(),r("span",Lu,"é™æµä¸­")):b("",!0)])):b("",!0),e("button",{class:"btn danger sm",onClick:s[14]||(s[14]=(...c)=>i.stopTask&&i.stopTask(...c)),disabled:t.stopping},u(t.stopping?"åœæ­¢ä¸­...":"â¹ï¸ åœæ­¢ä»»åŠ¡"),9,Wu)])])):(o(),r("div",zu,[e("div",Ou,[e("button",{class:"btn primary lg main-action",onClick:s[15]||(s[15]=c=>i.startTask("all","empty")),disabled:!t.config.hasApiKey||t.starting||i.totalMissing===0}," âœ¨ æ™ºèƒ½è¡¥å…¨ç¼ºå¤±å†…å®¹ ("+u(i.totalMissing)+") ",9,Nu),e("button",{class:"btn lg outline wizard-action",onClick:s[16]||(s[16]=c=>t.showWizard=!0),disabled:!t.config.hasApiKey}," ğŸ¯ é«˜çº§æ‰¹é‡ç”Ÿæˆå‘å¯¼ ",8,Fu)]),i.totalMissing>0?(o(),r("p",Hu," è¡¥å…¨å°†è‡ªåŠ¨åˆ†æ URL å¹¶ç”Ÿæˆç¼ºå¤±çš„åç§°ã€æè¿°å’Œæ ‡ç­¾ã€‚ ")):b("",!0)]))]),He(d,{visible:t.showWizard,"active-task":t.task,onClose:i.onWizardClose,onStart:i.onWizardStart},null,8,["visible","active-task","onClose","onStart"]),t.showClearConfirm?(o(),r("div",{key:1,class:"modal-overlay",onClick:s[21]||(s[21]=c=>t.showClearConfirm=!1)},[e("div",{class:"modal-content",onClick:s[20]||(s[20]=oe(()=>{},["stop"]))},[e("div",qu,[s[41]||(s[41]=e("h3",null,"âš ï¸ ç¡®è®¤æ¸…é™¤",-1)),e("button",{onClick:s[17]||(s[17]=c=>t.showClearConfirm=!1),class:"close-btn"},"Ã—")]),s[42]||(s[42]=e("div",{class:"modal-body"},[e("p",{class:"warning-text"},"æ¸…é™¤åï¼Œæ‰€æœ‰ AI åŠŸèƒ½å°†ä¸å¯ç”¨ï¼ŒåŒ…æ‹¬ï¼š"),e("ul",{class:"warning-list"},[e("li",null,"è‡ªåŠ¨ç”Ÿæˆå¡ç‰‡åç§°ã€æè¿°å’Œæ ‡ç­¾"),e("li",null,"æ‰¹é‡æ™ºèƒ½è¡¥å…¨åŠŸèƒ½"),e("li",null,"æ‰‹åŠ¨ AI ç”ŸæˆåŠŸèƒ½")]),e("p",{class:"warning-text"},"ç¡®å®šè¦æ¸…é™¤ API é…ç½®å—ï¼Ÿ")],-1)),e("div",ju,[e("button",{class:"btn",onClick:s[18]||(s[18]=c=>t.showClearConfirm=!1)},"å–æ¶ˆ"),e("button",{class:"btn danger",onClick:s[19]||(s[19]=(...c)=>i.clearConfig&&i.clearConfig(...c)),disabled:t.clearing},u(t.clearing?"æ¸…é™¤ä¸­...":"ç¡®è®¤æ¸…é™¤"),9,Gu)])])])):b("",!0),e("div",{class:W(["toast",[t.toast.type,{show:t.toast.show}]])},u(t.toast.msg),3)])}const Qu=Y(kd,[["render",Ju],["__scopeId","data-v-af6b15da"]]),Xu={key:0,class:"login-container"},Yu={class:"login-card"},Zu={class:"login-form"},ec={class:"password-input-wrapper"},sc=["type"],tc={key:0,width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"#2566d8","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},nc={key:1,width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"#2566d8","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},lc={class:"login-buttons"},ac=["disabled"],ic={key:0,class:"login-error"},oc={key:1,class:"admin-layout"},rc={class:"menu-list"},dc={class:"admin-main"},uc={class:"admin-header"},cc={class:"header-title"},vc={class:"admin-content"},Ne=1800*1e3,pc={__name:"Admin",setup(a){const s=$("welcome");let l=null,g=Date.now();function t(){g=Date.now(),localStorage.setItem("lastActivityTime",g.toString()),l&&clearTimeout(l),v.value&&(l=setTimeout(()=>{i()},Ne))}function i(){v.value&&(alert("ç”±äºé•¿æ—¶é—´æœªæ“ä½œï¼Œå·²è‡ªåŠ¨é€€å‡ºç™»å½•"),N())}function d(){const P=localStorage.getItem("lastActivityTime");return P&&Date.now()-parseInt(P)>=Ne?(localStorage.removeItem("token"),localStorage.removeItem("lastActivityTime"),!0):!1}const C=["mousedown","mousemove","keydown","scroll","touchstart","click"];function c(){C.forEach(P=>{document.addEventListener(P,t,{passive:!0})})}function k(){C.forEach(P=>{document.removeEventListener(P,t)})}Fe(()=>{l&&clearTimeout(l),k()});const y={welcome:qs,menu:Ot,card:Tn,duplicate:vl,tag:Al,promo:oa,friend:fa,user:Pa,backup:Eo,ai:Qu},_=ce(()=>y[s.value]),V=ce(()=>s.value==="welcome"?{lastLoginTime:w.value,lastLoginIp:p.value,currentUsername:h.value}:{}),w=$(""),p=$(""),h=$("admin"),v=$(!1),B=$(""),A=$(""),I=$(!1),H=$(""),X=$(!1),ee=$(!1),se=ce(()=>{switch(s.value){case"menu":return"æ ç›®ç®¡ç†";case"card":return"å¡ç‰‡ç®¡ç†";case"duplicate":return"å»é‡ç®¡ç†";case"tag":return"æ ‡ç­¾ç®¡ç†";case"promo":return"å®£ä¼ ç®¡ç†";case"friend":return"å‹é“¾ç®¡ç†";case"user":return"ç”¨æˆ·ç®¡ç†";case"backup":return"å¤‡ä»½ç®¡ç†";case"ai":return"AI è®¾ç½®";default:return""}});le(()=>x(null,null,function*(){if(d()){v.value=!1;return}localStorage.getItem("token")?(v.value=!0,yield ae(),v.value&&(t(),c())):v.value=!1}));function ae(){return x(this,null,function*(){try{const P=yield fetch("/api/users/me",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(P.ok){const f=yield P.json();w.value=f.last_login_time||"",p.value=f.last_login_ip||"",h.value=f.username||"admin"}else P.status===401&&(console.warn("TokenéªŒè¯å¤±è´¥ï¼Œè‡ªåŠ¨é€€å‡ºç™»å½•"),N())}catch(P){console.error("è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:",P)}})}function te(){return x(this,null,function*(){var P,f;if(!B.value||!A.value){H.value="è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ";return}I.value=!0,H.value="";try{const m=yield Es(B.value,A.value);m.data.token&&(localStorage.setItem("token",m.data.token),v.value=!0,w.value=m.data.lastLoginTime||"",p.value=m.data.lastLoginIp||"",yield ae(),t(),c())}catch(m){H.value=((f=(P=m.response)==null?void 0:P.data)==null?void 0:f.message)||"ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç "}finally{I.value=!1}})}function N(){l&&(clearTimeout(l),l=null),k(),localStorage.removeItem("token"),localStorage.removeItem("lastActivityTime"),v.value=!1,B.value="",A.value="",H.value=""}function L(){window.open("/","_blank")}function U(){ee.value=!ee.value}function D(){ee.value=!1}return(P,f)=>v.value?(o(),r("div",oc,[e("aside",{class:W(["admin-sider",{open:ee.value}]),onClick:oe(D,["self"])},[e("div",{class:"logo clickable",onClick:f[3]||(f[3]=m=>{s.value="welcome",D()})},"Admin"),e("ul",rc,[e("li",{class:W({active:s.value==="menu"}),onClick:f[4]||(f[4]=m=>{s.value="menu",D()})},"æ ç›®ç®¡ç†",2),e("li",{class:W({active:s.value==="card"}),onClick:f[5]||(f[5]=m=>{s.value="card",D()})},"å¡ç‰‡ç®¡ç†",2),e("li",{class:W({active:s.value==="duplicate"}),onClick:f[6]||(f[6]=m=>{s.value="duplicate",D()})},"å»é‡ç®¡ç†",2),e("li",{class:W({active:s.value==="tag"}),onClick:f[7]||(f[7]=m=>{s.value="tag",D()})},"æ ‡ç­¾ç®¡ç†",2),e("li",{class:W({active:s.value==="promo"}),onClick:f[8]||(f[8]=m=>{s.value="promo",D()})},"å®£ä¼ ç®¡ç†",2),e("li",{class:W({active:s.value==="friend"}),onClick:f[9]||(f[9]=m=>{s.value="friend",D()})},"å‹é“¾ç®¡ç†",2),e("li",{class:W({active:s.value==="user"}),onClick:f[10]||(f[10]=m=>{s.value="user",D()})},"ç”¨æˆ·ç®¡ç†",2),e("li",{class:W({active:s.value==="backup"}),onClick:f[11]||(f[11]=m=>{s.value="backup",D()})},"å¤‡ä»½ç®¡ç†",2),e("li",{class:W({active:s.value==="ai"}),onClick:f[12]||(f[12]=m=>{s.value="ai",D()})},"AI è®¾ç½®",2)])],2),e("main",dc,[e("div",uc,[e("button",{class:"menu-toggle",onClick:U}," â˜° "),e("div",cc,u(se.value),1),e("div",{class:"header-actions"},[e("span",{class:"home-icon",onClick:L,title:"è¿›å…¥ä¸»é¡µ"},[...f[17]||(f[17]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[e("path",{d:"M3 10.5L12 4l9 6.5V20a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1v-4h-4v4a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V10.5z",stroke:"#2566d8","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])]),e("button",{class:"btn logout-btn",onClick:N},"é€€å‡ºç™»å½•")])]),e("div",vc,[He(as,{name:"fade",mode:"out-in"},{default:ls(()=>[(o(),is(os(_.value),rs({key:s.value},V.value),null,16))]),_:1})]),f[18]||(f[18]=e("footer",{class:"admin-footer"},[e("p",{class:"admin-copyright"},[K("Copyright Â© 2025 Con-Nav-Item | "),e("a",{href:"https://github.com/zczy-k/Con-Nav-Item",target:"_blank",class:"footer-link"},"Powered by zczy-k")])],-1))])])):(o(),r("div",Xu,[e("div",Yu,[f[16]||(f[16]=e("h2",{class:"login-title"},"åå°ç®¡ç†ç™»å½•",-1)),e("div",Zu,[S(e("input",{"onUpdate:modelValue":f[0]||(f[0]=m=>B.value=m),type:"text",placeholder:"ç”¨æˆ·åï¼ˆé»˜è®¤ï¼šadminï¼‰",class:"login-input",onKeyup:Te(te,["enter"])},null,544),[[E,B.value]]),e("div",ec,[S(e("input",{"onUpdate:modelValue":f[1]||(f[1]=m=>A.value=m),type:X.value?"text":"password",placeholder:"å¯†ç ï¼ˆé»˜è®¤ï¼š123456ï¼‰",class:"login-input password-input",onKeyup:Te(te,["enter"])},null,40,sc),[[qe,A.value]]),e("span",{class:"toggle-password",onClick:f[2]||(f[2]=m=>X.value=!X.value)},[X.value?(o(),r("svg",tc,[...f[13]||(f[13]=[e("path",{d:"M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"},null,-1),e("circle",{cx:"12",cy:"12",r:"3"},null,-1)])])):(o(),r("svg",nc,[...f[14]||(f[14]=[e("path",{d:"M17.94 17.94A10.94 10.94 0 0 1 12 19c-7 0-11-7-11-7a21.77 21.77 0 0 1 5.06-6.06"},null,-1),e("path",{d:"M1 1l22 22"},null,-1),e("path",{d:"M9.53 9.53A3 3 0 0 0 12 15a3 3 0 0 0 2.47-5.47"},null,-1)])]))])]),e("div",lc,[e("button",{onClick:L,class:"back-btn"},[...f[15]||(f[15]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),K(" è¿”å›é¦–é¡µ ",-1)])]),e("button",{onClick:te,class:"login-btn",disabled:I.value},u(I.value?"ç™»å½•ä¸­...":"ç™»å½•"),9,ac)]),H.value?(o(),r("p",ic,u(H.value),1)):b("",!0)])])]))}},fc=Y(pc,[["__scopeId","data-v-52d75759"]]);export{fc as default};
