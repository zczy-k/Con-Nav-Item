import{S as $}from"./Home-SI2Pb6gP.js";import{_ as N,r as w,w as C,o as z,n as c,a as O,c as u,b as g,F as R,e as D,y as E,g as m,f as s,d as U,t as j}from"./index-DanJ1mwq.js";import"./urlNormalizer-B9d79qZ3.js";const A=["data-card-id"],B=["href","target","title"],G=["src","onError"],F={class:"link-text"},L={key:0,class:"card-btns"},V=["checked","onClick"],J=["onClick"],T=["onClick"],P={__name:"CardGrid",props:{cards:Array,editMode:Boolean,selectedCards:Array,categoryId:Number,subCategoryId:[Number,null]},emits:["cardsReordered","editCard","deleteCard","toggleCardSelection"],setup(r,{emit:k}){const o=r,y=k,b=w(null);let d=null;function f(){if(!o.editMode||d)return;const e=b.value;e&&(d=new $(e,{animation:150,group:"cards",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",handle:".drag-handle",filter:".card-btn, .card-checkbox",preventOnFilter:!1,onEnd:n=>{const t=n.to,a=Array.from(t.children).map(i=>parseInt(i.getAttribute("data-card-id"))).filter(i=>!isNaN(i));y("cardsReordered",a,o.categoryId,o.subCategoryId)}}))}function h(){d&&(d.destroy(),d=null)}C(()=>o.editMode,e=>{e?c(()=>f()):h()}),z(()=>{o.editMode&&c(()=>f())}),O(()=>{h()}),C(()=>o.cards,(e,n)=>{e&&e.length>0&&(!n||n.length===0||JSON.stringify(e)!==JSON.stringify(n))&&c(()=>{o.editMode&&(h(),c(()=>f()))})},{deep:!0,immediate:!1});function v(e){return{}}function p(e){try{return new URL(e).origin}catch(n){return null}}function x(e){if(e.logo_url)return e.logo_url;const n=p(e.url);return n?`https://api.xinac.net/icon/?url=${n}&sz=128`:"/default-favicon.png"}const l=[e=>`https://api.xinac.net/icon/?url=${e}&sz=128`,e=>`https://api.afmax.cn/so/ico/index.php?r=${e}&sz=128`,e=>`https://icon.horse/icon/${e}`,e=>`https://www.google.com/s2/favicons?domain=${e}&sz=128`,e=>`https://favicon.im/${e}?larger=true`];function S(e,n){const t=e.target.src,a=p(n.url);if(!a){e.target.src="/default-favicon.png";return}e.target._cdnIndex===void 0&&(e.target._cdnIndex=0);for(let i=0;i<l.length;i++)if(l[i](a),t.includes("api.xinac.net")&&i===0||t.includes("api.afmax.cn")&&i===1||t.includes("icon.horse")&&i===2||t.includes("www.google.com/s2/favicons")&&i===3||t.includes("favicon.im")&&i===4){if(i+1<l.length){e.target._cdnIndex=i+1,e.target.src=l[i+1](a);return}break}e.target.src="/default-favicon.png"}function _(e){let n="";return e.desc&&(n+=e.desc+`
`),e.tags&&e.tags.length>0&&(n+="æ ‡ç­¾: "+e.tags.map(t=>t.name).join(", ")+`
`),n+=e.url,n}function I(e){return e?e.length>20?e.slice(0,20)+"...":e:""}function M(e){var n;return((n=o.selectedCards)==null?void 0:n.some(t=>t.id===e.id))||!1}return(e,n)=>(g(),u("div",{ref_key:"cardGridRef",ref:b,class:m(["container card-grid",{"edit-mode":r.editMode}])},[(g(!0),u(R,null,D(r.cards,(t,a)=>(g(),u("div",{key:t.id,class:m(["link-item",{draggable:r.editMode}]),"data-card-id":t.id,style:E(v())},[s("a",{href:r.editMode?"javascript:void(0)":t.url,target:r.editMode?"":"_blank",title:_(t),onClick:n[0]||(n[0]=i=>r.editMode?i.preventDefault():null),class:m({"drag-handle":r.editMode})},[s("img",{class:"link-icon",src:x(t),alt:"",onError:i=>S(i,t),loading:"lazy"},null,40,G),s("span",F,j(I(t.title)),1)],10,B),r.editMode?(g(),u("div",L,[s("input",{type:"checkbox",class:"card-checkbox",checked:M(t),onClick:i=>e.$emit("toggleCardSelection",t),title:"é€‰ä¸­"},null,8,V),s("button",{onClick:i=>e.$emit("editCard",t),class:"card-btn edit-btn",title:"ç¼–è¾‘"},"âœï¸",8,J),s("button",{onClick:i=>e.$emit("deleteCard",t),class:"card-btn del-btn",title:"åˆ é™¤"},"ğŸ—‘ï¸",8,T)])):U("",!0)],14,A))),128))],2))}},Q=N(P,[["__scopeId","data-v-2e8eea9c"]]);export{Q as default};
