var H=Object.defineProperty,J=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var M=(v,o,l)=>o in v?H(v,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):v[o]=l,$=(v,o)=>{for(var l in o||(o={}))Q.call(o,l)&&M(v,l,o[l]);if(B)for(var l of B(o))W.call(o,l)&&M(v,l,o[l]);return v},x=(v,o)=>J(v,K(o));var b=(v,o,l)=>new Promise((c,h)=>{var y=m=>{try{f(l.next(m))}catch(_){h(_)}},C=m=>{try{f(l.throw(m))}catch(_){h(_)}},f=m=>m.done?c(m.value):Promise.resolve(m.value).then(y,C);f((l=l.apply(v,o)).next())});import{_ as X,r as k,e as E,g as Y,c as u,b as a,i as V,k as U,q as Z,d as A,t as p,F as S,a as T,o as d,p as z,n as tt,w as et,C as st}from"./index-miVMAtv-.js";import{g as at,O as ot,i as nt}from"./api-BJTa35S1.js";const lt={class:"bookmark-manager"},it={class:"header"},ct={class:"header-left"},rt={key:0,class:"import-panel"},ut={class:"import-header"},dt={class:"import-actions"},vt=["disabled"],mt={key:0,class:"check-summary"},pt={class:"batch-toolbar"},ft={class:"selected-count"},ht={class:"bookmark-list"},kt=["checked","onChange"],gt={class:"status-icon"},_t={key:0},bt={key:1},yt={key:2},Ct={key:3},wt={key:4},It={class:"bookmark-info"},Bt={class:"bookmark-title"},Mt={class:"bookmark-url"},$t={key:0,class:"bookmark-folder"},xt={class:"bookmark-category"},Et=["onUpdate:modelValue"],Vt=["value"],Ut={class:"import-footer"},At=["disabled"],St={key:1,class:"empty-state"},Tt={__name:"BookmarkManager",setup(v){const o=k([]),l=k([]),c=k([]),h=k(!1),y=k(0),C=k(!1),f=k(""),m=k(!1),_={"github.com":"å¼€å‘å·¥å…·","gitlab.com":"å¼€å‘å·¥å…·","stackoverflow.com":"å¼€å‘å·¥å…·","youtube.com":"è§†é¢‘","bilibili.com":"è§†é¢‘","twitter.com":"ç¤¾äº¤","facebook.com":"ç¤¾äº¤","weibo.com":"ç¤¾äº¤","zhihu.com":"ç¤¾åŒº","reddit.com":"ç¤¾åŒº","amazon.com":"è´­ç‰©","taobao.com":"è´­ç‰©","jd.com":"è´­ç‰©"},w=E(()=>{const s={valid:0,invalid:0,timeout:0,duplicate:0,pending:0};return o.value.forEach(t=>{s[t.status||"pending"]++}),s}),N=E(()=>f.value?o.value.filter(s=>s.status===f.value):o.value);function O(s){try{const t=new URL(s).hostname.replace("www.","");for(const[i,e]of Object.entries(_))if(t.includes(i)){const r=l.value.find(n=>n.name.includes(e));return(r==null?void 0:r.id)||""}}catch(t){}return""}function j(){return b(this,null,function*(){try{const s=yield at();l.value=s.data}catch(s){console.error("åŠ è½½èœå•å¤±è´¥:",s)}})}function D(){return b(this,null,function*(){var t,i;if(h.value)return;h.value=!0,y.value=0;const s=o.value.map(e=>({url:e.url,title:e.title,folder:e.folder}));try{const e=yield ot(s),r={};[...e.data.valid,...e.data.invalid,...e.data.timeout,...e.data.duplicate].forEach(n=>{r[n.url]=n.status}),o.value.forEach(n=>{n.status=r[n.url]||"valid"}),C.value=!0}catch(e){console.error("æ£€æµ‹å¤±è´¥:",e),alert("æ£€æµ‹å¤±è´¥: "+(((i=(t=e.response)==null?void 0:t.data)==null?void 0:i.error)||e.message))}finally{h.value=!1}})}function L(s){const t=c.value.indexOf(s);t>-1?c.value.splice(t,1):c.value.push(s)}function R(){c.value=o.value.map((s,t)=>t)}function F(){c.value=o.value.map((s,t)=>s.status==="valid"||!s.status?t:-1).filter(s=>s>=0)}function q(){c.value=[]}function P(){return b(this,null,function*(){var s,t;if(c.value.length!==0){m.value=!0;try{const i={};c.value.forEach(r=>{var I;const n=o.value[r],g=n.targetMenuId||((I=l.value[0])==null?void 0:I.id);g&&(i[g]||(i[g]=[]),i[g].push({title:n.title,url:n.url,logo:`https://api.xinac.net/icon/?url=${new URL(n.url).origin}&sz=128`,description:""}))});let e=0;for(const[r,n]of Object.entries(i)){const g=yield nt(parseInt(r),null,n);e+=g.data.added||0}alert(`æˆåŠŸå¯¼å…¥ ${e} ä¸ªä¹¦ç­¾`),typeof chrome!="undefined"&&chrome.storage&&(yield chrome.storage.local.remove(["pendingBookmarks","bookmarkImportTime"])),window.location.href="/"}catch(i){console.error("å¯¼å…¥å¤±è´¥:",i),alert("å¯¼å…¥å¤±è´¥: "+(((t=(s=i.response)==null?void 0:s.data)==null?void 0:t.error)||i.message))}finally{m.value=!1}}})}function G(){typeof chrome!="undefined"&&chrome.storage&&chrome.storage.local.remove(["pendingBookmarks","bookmarkImportTime"]),window.location.href="/"}return Y(()=>b(null,null,function*(){if(yield j(),typeof chrome!="undefined"&&chrome.storage)try{const s=yield chrome.storage.local.get(["pendingBookmarks","bookmarkImportTime"]);s.pendingBookmarks&&s.pendingBookmarks.length>0&&(Date.now()-(s.bookmarkImportTime||0)>6e5||(o.value=s.pendingBookmarks.map(i=>x($({},i),{status:"",targetMenuId:O(i.url)}))))}catch(s){console.error("èŽ·å–å¾…å¯¼å…¥ä¹¦ç­¾å¤±è´¥:",s)}})),(s,t)=>{const i=Z("router-link");return d(),u("div",lt,[a("div",it,[a("div",ct,[V(i,{to:"/",class:"back-btn"},{default:U(()=>t[5]||(t[5]=[z("â† è¿”å›žé¦–é¡µ")])),_:1,__:[5]}),t[6]||(t[6]=a("h1",null,"ðŸ“š ä¹¦ç­¾å¯¼å…¥",-1))])]),o.value.length>0?(d(),u("div",rt,[a("div",ut,[a("h2",null,"å¾…å¯¼å…¥ä¹¦ç­¾ ("+p(o.value.length)+")",1),a("div",dt,[a("button",{onClick:D,class:"btn btn-check",disabled:h.value},p(h.value?`æ£€æµ‹ä¸­ ${y.value}/${o.value.length}`:"ðŸ” æ£€æµ‹é“¾æŽ¥æœ‰æ•ˆæ€§"),9,vt)])]),C.value?(d(),u("div",mt,[a("span",{class:"status-tag valid",onClick:t[0]||(t[0]=e=>f.value="valid")},"âœ… æœ‰æ•ˆ "+p(w.value.valid),1),a("span",{class:"status-tag timeout",onClick:t[1]||(t[1]=e=>f.value="timeout")},"âš ï¸ è¶…æ—¶ "+p(w.value.timeout),1),a("span",{class:"status-tag invalid",onClick:t[2]||(t[2]=e=>f.value="invalid")},"âŒ å¤±æ•ˆ "+p(w.value.invalid),1),a("span",{class:"status-tag duplicate",onClick:t[3]||(t[3]=e=>f.value="duplicate")},"ðŸ”„ é‡å¤ "+p(w.value.duplicate),1),a("span",{class:"status-tag",onClick:t[4]||(t[4]=e=>f.value="")},"å…¨éƒ¨")])):A("",!0),a("div",pt,[a("button",{onClick:F,class:"btn btn-sm"},"å…¨é€‰æœ‰æ•ˆ"),a("button",{onClick:R,class:"btn btn-sm"},"å…¨é€‰"),a("button",{onClick:q,class:"btn btn-sm"},"æ¸…é™¤é€‰æ‹©"),a("span",ft,"å·²é€‰ "+p(c.value.length)+" é¡¹",1)]),a("div",ht,[(d(!0),u(S,null,T(N.value,(e,r)=>(d(),u("div",{key:r,class:tt(["bookmark-item",[e.status,{selected:c.value.includes(r)}]])},[a("input",{type:"checkbox",checked:c.value.includes(r),onChange:n=>L(r)},null,40,kt),a("div",gt,[e.status==="valid"?(d(),u("span",_t,"âœ…")):e.status==="invalid"?(d(),u("span",bt,"âŒ")):e.status==="timeout"?(d(),u("span",yt,"âš ï¸")):e.status==="duplicate"?(d(),u("span",Ct,"ðŸ”„")):(d(),u("span",wt,"â³"))]),a("div",It,[a("div",Bt,p(e.title),1),a("div",Mt,p(e.url),1),e.folder?(d(),u("div",$t,"ðŸ“ "+p(e.folder),1)):A("",!0)]),a("div",xt,[et(a("select",{"onUpdate:modelValue":n=>e.targetMenuId=n,class:"category-select"},[t[7]||(t[7]=a("option",{value:""},"é€‰æ‹©åˆ†ç±»",-1)),(d(!0),u(S,null,T(l.value,n=>(d(),u("option",{key:n.id,value:n.id},p(n.name),9,Vt))),128))],8,Et),[[st,e.targetMenuId]])])],2))),128))]),a("div",Ut,[a("button",{onClick:G,class:"btn btn-secondary"},"å–æ¶ˆ"),a("button",{onClick:P,class:"btn btn-primary",disabled:c.value.length===0||m.value},p(m.value?"å¯¼å…¥ä¸­...":`å¯¼å…¥é€‰ä¸­ (${c.value.length})`),9,At)])])):(d(),u("div",St,[t[9]||(t[9]=a("p",null,"ðŸ“­ æš‚æ— å¾…å¯¼å…¥çš„ä¹¦ç­¾",-1)),t[10]||(t[10]=a("p",{class:"hint"},"è¯·ä½¿ç”¨æµè§ˆå™¨æ‰©å±•é€‰æ‹©ä¹¦ç­¾åŽå¯¼å…¥",-1)),V(i,{to:"/",class:"btn btn-primary"},{default:U(()=>t[8]||(t[8]=[z("è¿”å›žé¦–é¡µ")])),_:1,__:[8]})]))])}}},jt=X(Tt,[["__scopeId","data-v-70507ad9"]]);export{jt as default};
