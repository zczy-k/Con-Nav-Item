import{_ as V,r as u,o as _,a as A,b as d,d as c,f as F,F as X,g as Y,w as M,i as w,e as o,h as E,t as S,n as q,T as H}from"./index-G4tFHV3w.js";const J=["data-card-id","onContextmenu","onClick"],Q=["href","target","title","onClick"],W=["src","onError"],Z={class:"link-text"},ee={key:0,class:"card-selected-badge"},ne={__name:"CardGrid",props:{cards:Array,selectedCards:Array,categoryId:Number,subCategoryId:[Number,null],selectionMode:Boolean},emits:["contextEdit","contextDelete","toggleCardSelection","openMovePanel","requireAuth","cardClicked"],setup(r,{emit:D}){const g=r,a=D,L=u(null),f=u(!1),x=u(0),C=u(0),i=u(null);function z(e,n){i.value=n,x.value=e.clientX,C.value=e.clientY,f.value=!0}function s(){f.value=!1,i.value=null}function I(){i.value&&a("contextEdit",i.value),s()}function O(){i.value&&a("contextDelete",i.value),s()}function $(){i.value&&a("toggleCardSelection",i.value),s()}function P(){i.value&&(p(i.value)||a("toggleCardSelection",i.value),a("openMovePanel")),s()}function T(){i.value&&(h(i.value.id),window.open(i.value.url,"_blank")),s()}function U(){if(i.value){const e=i.value.url;navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(e).catch(()=>{k(e)}):k(e)}s()}function k(e){const n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.left="-9999px",document.body.appendChild(n),n.select();try{document.execCommand("copy")}catch(t){console.error("Copy failed:",t)}document.body.removeChild(n)}function y(e){f.value&&s()}function B(e,n){(e.ctrlKey||e.metaKey||g.selectionMode)&&(e.preventDefault(),e.stopPropagation(),a("toggleCardSelection",n))}function N(e,n){e.ctrlKey||e.metaKey||g.selectionMode?(e.preventDefault(),e.stopPropagation(),a("toggleCardSelection",n)):h(n.id)}function h(e){fetch(`/api/cards/${e}/click`,{method:"POST"}).catch(()=>{}),a("cardClicked",e)}_(()=>{document.addEventListener("click",y),document.addEventListener("scroll",s)}),A(()=>{document.removeEventListener("click",y),document.removeEventListener("scroll",s)});function b(e){try{return new URL(e).origin}catch(n){return null}}function R(e){if(e.logo_url)return e.logo_url;const n=b(e.url);return n?`https://api.xinac.net/icon/?url=${n}&sz=128`:"/default-favicon.png"}const m=[e=>`https://api.xinac.net/icon/?url=${e}&sz=128`,e=>`https://api.afmax.cn/so/ico/index.php?r=${e}&sz=128`,e=>`https://icon.horse/icon/${e}`,e=>`https://www.google.com/s2/favicons?domain=${e}&sz=128`,e=>`https://favicon.im/${e}?larger=true`];function j(e,n){const t=e.target.src,v=b(n.url);if(!v){e.target.src="/default-favicon.png";return}e.target._cdnIndex===void 0&&(e.target._cdnIndex=0);for(let l=0;l<m.length;l++)if(m[l](v),t.includes("api.xinac.net")&&l===0||t.includes("api.afmax.cn")&&l===1||t.includes("icon.horse")&&l===2||t.includes("www.google.com/s2/favicons")&&l===3||t.includes("favicon.im")&&l===4){if(l+1<m.length){e.target._cdnIndex=l+1,e.target.src=m[l+1](v);return}break}e.target.src="/default-favicon.png"}function G(e){let n="";return e.desc&&(n+=e.desc+`
`),e.tags&&e.tags.length>0&&(n+="æ ‡ç­¾: "+e.tags.map(t=>t.name).join(", ")+`
`),n+=e.url,n}function K(e){return e?e.length>20?e.slice(0,20)+"...":e:""}function p(e){var n;return((n=g.selectedCards)==null?void 0:n.some(t=>t.id===e.id))||!1}return(e,n)=>(c(),d("div",{ref_key:"cardGridRef",ref:L,class:w(["container card-grid",{"selection-mode":r.selectionMode}])},[(c(!0),d(X,null,Y(r.cards,(t,v)=>(c(),d("div",{key:t.id,class:w(["link-item",{selected:p(t)}]),"data-card-id":t.id,onContextmenu:M(l=>z(l,t),["prevent"]),onClick:l=>B(l,t)},[o("a",{href:r.selectionMode?"javascript:void(0)":t.url,target:r.selectionMode?"":"_blank",title:G(t),onClick:l=>N(l,t),class:"card-link"},[o("img",{class:"link-icon",src:R(t),alt:"",onError:l=>j(l,t),loading:"lazy"},null,40,W),o("span",Z,S(K(t.title)),1)],8,Q),p(t)?(c(),d("div",ee,"âœ“")):E("",!0)],42,J))),128)),(c(),F(H,{to:"body"},[f.value?(c(),d("div",{key:0,class:"context-menu",style:q({left:x.value+"px",top:C.value+"px"}),onClick:n[0]||(n[0]=M(()=>{},["stop"]))},[o("div",{class:"context-menu-item",onClick:I},[...n[1]||(n[1]=[o("span",{class:"context-menu-icon"},"âœï¸",-1),o("span",null,"ç¼–è¾‘",-1)])]),o("div",{class:"context-menu-item",onClick:O},[...n[2]||(n[2]=[o("span",{class:"context-menu-icon"},"ğŸ—‘ï¸",-1),o("span",null,"åˆ é™¤",-1)])]),n[7]||(n[7]=o("div",{class:"context-menu-divider"},null,-1)),o("div",{class:"context-menu-item",onClick:$},[n[3]||(n[3]=o("span",{class:"context-menu-icon"},"â˜‘ï¸",-1)),o("span",null,S(p(i.value)?"å–æ¶ˆé€‰ä¸­":"é€‰ä¸­"),1)]),o("div",{class:"context-menu-item",onClick:P},[...n[4]||(n[4]=[o("span",{class:"context-menu-icon"},"ğŸ“",-1),o("span",null,"ç§»åŠ¨åˆ°...",-1)])]),n[8]||(n[8]=o("div",{class:"context-menu-divider"},null,-1)),o("div",{class:"context-menu-item",onClick:T},[...n[5]||(n[5]=[o("span",{class:"context-menu-icon"},"ğŸ”—",-1),o("span",null,"åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€",-1)])]),o("div",{class:"context-menu-item",onClick:U},[...n[6]||(n[6]=[o("span",{class:"context-menu-icon"},"ğŸ“‹",-1),o("span",null,"å¤åˆ¶é“¾æ¥",-1)])])],4)):E("",!0)]))],2))}},oe=V(ne,[["__scopeId","data-v-46e75563"]]);export{oe as default};
