var pe=Object.defineProperty,ge=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var G=(a,s,t)=>s in a?pe(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t,D=(a,s)=>{for(var t in s||(s={}))Ce.call(s,t)&&G(a,t,s[t]);if($)for(var t of $(s))he.call(s,t)&&G(a,t,s[t]);return a},q=(a,s)=>ge(a,ve(s));var I=(a,s,t)=>new Promise((c,p)=>{var w=m=>{try{r(t.next(m))}catch(d){p(d)}},l=m=>{try{r(t.throw(m))}catch(d){p(d)}},r=m=>m.done?c(m.value):Promise.resolve(m.value).then(w,l);r((t=t.apply(a,s)).next())});import{r as k,E as X,_ as xe,a as O,o as F,b as M,d as y,f as Q,F as J,g as Z,w as R,i as z,e as u,h as B,t as N,n as ee,T as ne,D as ye,p as ke,L as we,M as be,N as Me,y as Re,B as Ee,H as Se,C as Te,v as Ue,G as Ie,s as Le,O as Pe,P as De,Q as qe,S as Oe,R as ze,U as Be,V as Ne,W as Ve,c as Ae,X as _e,A as je,z as He,l as Ke,x as We,Y as $e,Z as Ge,$ as Ye,a0 as Xe,a1 as Fe,a2 as Qe,a3 as Je,a4 as Ze,K as en,j as nn,a5 as tn,a6 as on,a7 as an,a8 as sn,a9 as rn,aa as cn,ab as ln,ac as un,ad as dn,ae as fn,af as mn,ag as pn,I as gn,J as vn,ah as Cn,ai as hn,aj as xn,ak as yn,al as kn,am as wn,an as bn,k as Mn,m as Rn,q as En,ao as Sn,ap as Tn,aq as Un,ar as In,as as Ln,at as Pn,au as Dn,av as qn,aw as On,ax as zn,ay as Bn,az as Nn,aA as Vn,aB as An,aC as _n,aD as jn,u as Hn,aE as Kn,aF as Wn,aG as $n}from"./index-IpXrYYTb.js";const Gn=Object.freeze(Object.defineProperty({__proto__:null,BaseTransition:Pe,BaseTransitionPropsValidators:De,Comment:qe,EffectScope:Sn,Fragment:J,ReactiveEffect:Tn,Static:Oe,Teleport:ne,Text:ze,Transition:ke,callWithAsyncErrorHandling:Be,callWithErrorHandling:Ne,camelize:Kn,capitalize:Wn,cloneVNode:Ve,computed:Ae,createApp:we,createBlock:Q,createCommentVNode:B,createElementBlock:M,createElementVNode:u,createRenderer:_e,createStaticVNode:je,createTextVNode:He,createVNode:Ke,defineAsyncComponent:We,defineComponent:$e,getCurrentInstance:Ge,getCurrentScope:Un,getTransitionRawChildren:Ye,guardReactiveProps:Xe,h:Fe,handleError:Qe,inject:Je,isProxy:In,isReactive:Ln,isReadonly:Pn,isRef:Dn,isShallow:qn,isVNode:Ze,markRaw:On,mergeProps:en,nextTick:nn,nodeOps:be,normalizeClass:z,normalizeStyle:ee,onActivated:tn,onBeforeMount:on,onBeforeUnmount:an,onBeforeUpdate:sn,onDeactivated:rn,onErrorCaptured:cn,onMounted:F,onRenderTracked:ln,onRenderTriggered:un,onServerPrefetch:dn,onUnmounted:O,onUpdated:fn,onWatcherCleanup:zn,openBlock:y,patchProp:Me,provide:mn,proxyRefs:Bn,queuePostFlushCb:pn,reactive:X,readonly:Nn,ref:k,renderList:Z,resolveComponent:gn,resolveDynamicComponent:vn,resolveTransitionHooks:Cn,setBlockTracking:hn,setTransitionHooks:xn,shallowReactive:Vn,shallowReadonly:An,shallowRef:_n,ssrContextKey:yn,toDisplayString:N,toHandlerKey:$n,toRaw:jn,unref:Hn,useSSRContext:kn,useTransitionState:wn,vModelCheckbox:Re,vModelDynamic:Ee,vModelRadio:Se,vModelSelect:Te,vModelText:Ue,vShow:Ie,version:bn,watch:Mn,withCtx:Rn,withDirectives:En,withKeys:Le,withModifiers:R},Symbol.toStringTag,{value:"Module"})),Yn=4,Y=[1e3,2e3,4e3],i=X({queue:[],running:0,cache:new Map,failedUrls:new Set,observers:new Map});function Xn(a,s=0){const t=[c=>`/api/icon?url=${encodeURIComponent(c)}`,c=>`https://api.xinac.net/icon/?url=${c}&sz=128`,c=>`https://www.google.com/s2/favicons?domain=${new URL(c).hostname}&sz=128`,c=>`https://icon.horse/icon/${new URL(c).hostname}`,c=>`https://favicon.im/${new URL(c).hostname}?larger=true`];try{return t[s%t.length](a)}catch(c){return t[0](a)}}function V(){for(;i.running<Yn&&i.queue.length>0;){const a=i.queue.shift();i.running++,Fn(a).finally(()=>{i.running--,V()})}}function Fn(a){return I(this,null,function*(){const{url:s,element:t,cardId:c,resolve:p,reject:w,retryCount:l=0,cdnIndex:r=0}=a;if(i.cache.has(s)){const d=i.cache.get(s);t&&(t.src=d),p==null||p(d);return}const m=Xn(s,r);return new Promise(d=>{const g=new Image;g.crossOrigin="anonymous";const v=setTimeout(()=>{g.src="",b()},8e3);g.onload=()=>{clearTimeout(v),i.cache.set(s,m),t&&(t.src=m),p==null||p(m),d(m)},g.onerror=()=>{clearTimeout(v),b()};function b(){if(r<4)i.queue.unshift(q(D({},a),{cdnIndex:r+1,retryCount:0})),d(null);else if(l<Y.length)setTimeout(()=>{i.queue.push(q(D({},a),{retryCount:l+1,cdnIndex:0})),V()},Y[l]),d(null);else{i.failedUrls.add(s);const f="/icons/common/default-favicon.png";t&&(t.src=f),p==null||p(f),d(f)}}g.src=m})})}function Qn(){const a=k(!1);function s(l,r=null,m=null){return new Promise((d,g)=>{if(!l){d("/icons/common/default-favicon.png");return}if(i.cache.has(l)){const v=i.cache.get(l);r&&(r.src=v),d(v);return}if(i.failedUrls.has(l)){const v="/icons/common/default-favicon.png";r&&(r.src=v),d(v);return}i.queue.push({url:l,element:r,cardId:m,resolve:d,reject:g}),V()})}function t(l,r,m=null){if(!l||!r)return;i.observers.has(l)&&i.observers.get(l).disconnect();const d=new IntersectionObserver(g=>{g.forEach(v=>{v.isIntersecting&&(s(r,l,m),d.disconnect(),i.observers.delete(l))})},{rootMargin:"200px",threshold:.01});return d.observe(l),i.observers.set(l,d),()=>{d.disconnect(),i.observers.delete(l)}}function c(l){l.forEach(r=>{!i.cache.has(r)&&!i.failedUrls.has(r)&&s(r)})}function p(){i.cache.clear(),i.failedUrls.clear()}function w(){return{cached:i.cache.size,failed:i.failedUrls.size,queued:i.queue.length,running:i.running}}return{queueIcon:s,setupLazyLoad:t,preloadIcons:c,clearCache:p,getCacheStats:w,isLoading:a}}const Jn=["data-card-id","onContextmenu","onClick"],Zn=["href","target","title","onClick"],et=["data-url","onError"],nt={key:0,class:"card-selected-badge"},L="/icons/common/default-favicon.png",tt={__name:"CardGrid",props:{cards:Array,selectedCards:Array,categoryId:Number,subCategoryId:[Number,null],selectionMode:Boolean},emits:["contextEdit","contextDelete","toggleCardSelection","openMovePanel","requireAuth","cardClicked"],setup(a,{emit:s}){const t=a,c=s,p=k(null),{setupLazyLoad:w,queueIcon:l}=Qn(),r=new Map;function m(n){try{return new URL(n).origin}catch(e){return null}}function d(n,e){if(!n||!e.url)return;if(r.has(e.id)&&r.get(e.id)(),e.logo_url){n.src=e.logo_url;return}const o=m(e.url);if(!o){n.src=L;return}const x=w(n,o,e.id);x&&r.set(e.id,x)}O(()=>{r.forEach(n=>n()),r.clear()});const g=k(!1),v=k(0),b=k(0),f=k(null);function te(n,e){return I(this,null,function*(){f.value=e,g.value=!0;const o=n.clientX,x=n.clientY,{nextTick:C}=yield ye(()=>I(null,null,function*(){const{nextTick:S}=yield Promise.resolve().then(()=>Gn);return{nextTick:S}}),void 0);yield C();const P=document.querySelector(".context-menu");if(P){const S=P.offsetWidth,H=P.offsetHeight,K=window.innerWidth,W=window.innerHeight;let T=o,U=x;o+S>K&&(T=K-S-10),x+H>W&&(U=W-H-10),T=Math.max(10,T),U=Math.max(10,U),v.value=T,b.value=U}else v.value=o,b.value=x})}function h(){g.value=!1,f.value=null}function oe(){f.value&&c("contextEdit",f.value),h()}function ae(){f.value&&c("contextDelete",f.value),h()}function se(){f.value&&c("toggleCardSelection",f.value),h()}function ie(){f.value&&(E(f.value)||c("toggleCardSelection",f.value),c("openMovePanel")),h()}function re(){f.value&&(j(f.value.id),window.open(f.value.url,"_blank")),h()}function ce(){if(f.value){const n=f.value.url;navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(n).catch(()=>{A(n)}):A(n)}h()}function A(n){const e=document.createElement("textarea");e.value=n,e.style.position="fixed",e.style.left="-9999px",document.body.appendChild(e),e.select();try{document.execCommand("copy")}catch(o){console.error("Copy failed:",o)}document.body.removeChild(e)}function _(n){g.value&&h()}function le(n,e){(n.ctrlKey||n.metaKey||t.selectionMode)&&(n.preventDefault(),n.stopPropagation(),c("toggleCardSelection",e))}function ue(n,e){n.ctrlKey||n.metaKey||t.selectionMode?(n.preventDefault(),n.stopPropagation(),c("toggleCardSelection",e)):j(e.id)}function j(n){fetch(`/api/cards/${n}/click`,{method:"POST"}).catch(()=>{}),c("cardClicked",n)}F(()=>{document.addEventListener("click",_),document.addEventListener("scroll",h)}),O(()=>{document.removeEventListener("click",_),document.removeEventListener("scroll",h)});function de(n,e){if(n.target._retried){n.target.src=L;return}n.target._retried=!0;const o=m(e.url);o?l(o,n.target,e.id):n.target.src=L}function fe(n){let e="";return n.desc&&(e+=n.desc+`
`),n.tags&&n.tags.length>0&&(e+="æ ‡ç­¾: "+n.tags.map(o=>o.name).join(", ")+`
`),e+=n.url,e}function me(n){return n?n.length>20?n.slice(0,20)+"...":n:""}function E(n){var e;return((e=t.selectedCards)==null?void 0:e.some(o=>o.id===n.id))||!1}return(n,e)=>(y(),M("div",{ref_key:"cardGridRef",ref:p,class:z(["container card-grid",{"selection-mode":a.selectionMode}])},[(y(!0),M(J,null,Z(a.cards,(o,x)=>(y(),M("div",{key:o.id,class:z(["link-item",{selected:E(o)}]),"data-card-id":o.id,draggable:"false",onContextmenu:R(C=>te(C,o),["prevent"]),onClick:C=>le(C,o)},[u("a",{href:a.selectionMode?"javascript:void(0)":o.url,target:a.selectionMode?"":"_blank",title:fe(o),draggable:"false",onClick:C=>ue(C,o),onContextmenu:e[2]||(e[2]=R(()=>{},["prevent"])),class:"card-link"},[u("img",{class:"link-icon",ref_for:!0,ref:C=>C&&d(C,o),src:L,"data-url":o.url,alt:"",draggable:"false",onError:C=>de(C,o),onContextmenu:e[0]||(e[0]=R(()=>{},["prevent"]))},null,40,et),u("span",{class:"link-text",onContextmenu:e[1]||(e[1]=R(()=>{},["prevent"]))},N(me(o.title)),33)],40,Zn),E(o)?(y(),M("div",nt,"âœ“")):B("",!0)],42,Jn))),128)),(y(),Q(ne,{to:"body"},[g.value?(y(),M("div",{key:0,class:"context-menu",style:ee({left:v.value+"px",top:b.value+"px"}),onClick:e[3]||(e[3]=R(()=>{},["stop"]))},[u("div",{class:"context-menu-item",onClick:oe},[...e[4]||(e[4]=[u("span",{class:"context-menu-icon"},"âœï¸",-1),u("span",null,"ç¼–è¾‘",-1)])]),u("div",{class:"context-menu-item",onClick:ae},[...e[5]||(e[5]=[u("span",{class:"context-menu-icon"},"ğŸ—‘ï¸",-1),u("span",null,"åˆ é™¤",-1)])]),e[10]||(e[10]=u("div",{class:"context-menu-divider"},null,-1)),u("div",{class:"context-menu-item",onClick:se},[e[6]||(e[6]=u("span",{class:"context-menu-icon"},"â˜‘ï¸",-1)),u("span",null,N(E(f.value)?"å–æ¶ˆé€‰ä¸­":"é€‰ä¸­"),1)]),u("div",{class:"context-menu-item",onClick:ie},[...e[7]||(e[7]=[u("span",{class:"context-menu-icon"},"ğŸ“",-1),u("span",null,"ç§»åŠ¨åˆ°...",-1)])]),e[11]||(e[11]=u("div",{class:"context-menu-divider"},null,-1)),u("div",{class:"context-menu-item",onClick:re},[...e[8]||(e[8]=[u("span",{class:"context-menu-icon"},"ğŸ”—",-1),u("span",null,"åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€",-1)])]),u("div",{class:"context-menu-item",onClick:ce},[...e[9]||(e[9]=[u("span",{class:"context-menu-icon"},"ğŸ“‹",-1),u("span",null,"å¤åˆ¶é“¾æ¥",-1)])])],4)):B("",!0)]))],2))}},st=xe(tt,[["__scopeId","data-v-bc868cb6"]]);export{st as default};
