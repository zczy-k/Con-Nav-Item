var pe=Object.defineProperty,ve=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var G=(a,s,t)=>s in a?pe(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t,P=(a,s)=>{for(var t in s||(s={}))he.call(s,t)&&G(a,t,s[t]);if($)for(var t of $(s))Ce.call(s,t)&&G(a,t,s[t]);return a},_=(a,s)=>ve(a,ge(s));var U=(a,s,t)=>new Promise((c,p)=>{var w=m=>{try{r(t.next(m))}catch(d){p(d)}},l=m=>{try{r(t.throw(m))}catch(d){p(d)}},r=m=>m.done?c(m.value):Promise.resolve(m.value).then(w,l);r((t=t.apply(a,s)).next())});import{r as k,E as X,_ as xe,a as D,o as F,b as M,d as y,f as Q,F as J,g as Z,w as q,i as O,e as u,h as z,t as B,n as ee,T as ne,D as ye,p as ke,L as we,M as be,N as Me,y as Re,B as Ee,H as Se,C as Te,v as Ue,G as Ie,s as Le,O as Pe,P as _e,Q as De,S as qe,R as Oe,U as ze,V as Be,W as Ne,c as Ve,X as Ae,A as je,z as He,l as Ke,x as We,Y as $e,Z as Ge,$ as Ye,a0 as Xe,a1 as Fe,a2 as Qe,a3 as Je,a4 as Ze,K as en,j as nn,a5 as tn,a6 as on,a7 as an,a8 as sn,a9 as rn,aa as cn,ab as ln,ac as un,ad as dn,ae as fn,af as mn,ag as pn,I as vn,J as gn,ah as hn,ai as Cn,aj as xn,ak as yn,al as kn,am as wn,an as bn,k as Mn,m as Rn,q as En,ao as Sn,ap as Tn,aq as Un,ar as In,as as Ln,at as Pn,au as _n,av as Dn,aw as qn,ax as On,ay as zn,az as Bn,aA as Nn,aB as Vn,aC as An,aD as jn,u as Hn,aE as Kn,aF as Wn,aG as $n}from"./index-yekmaQp4.js";const Gn=Object.freeze(Object.defineProperty({__proto__:null,BaseTransition:Pe,BaseTransitionPropsValidators:_e,Comment:De,EffectScope:Sn,Fragment:J,ReactiveEffect:Tn,Static:qe,Teleport:ne,Text:Oe,Transition:ke,callWithAsyncErrorHandling:ze,callWithErrorHandling:Be,camelize:Kn,capitalize:Wn,cloneVNode:Ne,computed:Ve,createApp:we,createBlock:Q,createCommentVNode:z,createElementBlock:M,createElementVNode:u,createRenderer:Ae,createStaticVNode:je,createTextVNode:He,createVNode:Ke,defineAsyncComponent:We,defineComponent:$e,getCurrentInstance:Ge,getCurrentScope:Un,getTransitionRawChildren:Ye,guardReactiveProps:Xe,h:Fe,handleError:Qe,inject:Je,isProxy:In,isReactive:Ln,isReadonly:Pn,isRef:_n,isShallow:Dn,isVNode:Ze,markRaw:qn,mergeProps:en,nextTick:nn,nodeOps:be,normalizeClass:O,normalizeStyle:ee,onActivated:tn,onBeforeMount:on,onBeforeUnmount:an,onBeforeUpdate:sn,onDeactivated:rn,onErrorCaptured:cn,onMounted:F,onRenderTracked:ln,onRenderTriggered:un,onServerPrefetch:dn,onUnmounted:D,onUpdated:fn,onWatcherCleanup:On,openBlock:y,patchProp:Me,provide:mn,proxyRefs:zn,queuePostFlushCb:pn,reactive:X,readonly:Bn,ref:k,renderList:Z,resolveComponent:vn,resolveDynamicComponent:gn,resolveTransitionHooks:hn,setBlockTracking:Cn,setTransitionHooks:xn,shallowReactive:Nn,shallowReadonly:Vn,shallowRef:An,ssrContextKey:yn,toDisplayString:B,toHandlerKey:$n,toRaw:jn,unref:Hn,useSSRContext:kn,useTransitionState:wn,vModelCheckbox:Re,vModelDynamic:Ee,vModelRadio:Se,vModelSelect:Te,vModelText:Ue,vShow:Ie,version:bn,watch:Mn,withCtx:Rn,withDirectives:En,withKeys:Le,withModifiers:q},Symbol.toStringTag,{value:"Module"})),Yn=4,Y=[1e3,2e3,4e3],i=X({queue:[],running:0,cache:new Map,failedUrls:new Set,observers:new Map});function Xn(a,s=0){const t=[c=>`/api/icon?url=${encodeURIComponent(c)}`,c=>`https://api.xinac.net/icon/?url=${c}&sz=128`,c=>`https://www.google.com/s2/favicons?domain=${new URL(c).hostname}&sz=128`,c=>`https://icon.horse/icon/${new URL(c).hostname}`,c=>`https://favicon.im/${new URL(c).hostname}?larger=true`];try{return t[s%t.length](a)}catch(c){return t[0](a)}}function N(){for(;i.running<Yn&&i.queue.length>0;){const a=i.queue.shift();i.running++,Fn(a).finally(()=>{i.running--,N()})}}function Fn(a){return U(this,null,function*(){const{url:s,element:t,cardId:c,resolve:p,reject:w,retryCount:l=0,cdnIndex:r=0}=a;if(i.cache.has(s)){const d=i.cache.get(s);t&&(t.src=d),p==null||p(d);return}const m=Xn(s,r);return new Promise(d=>{const v=new Image;v.crossOrigin="anonymous";const g=setTimeout(()=>{v.src="",b()},8e3);v.onload=()=>{clearTimeout(g),i.cache.set(s,m),t&&(t.src=m),p==null||p(m),d(m)},v.onerror=()=>{clearTimeout(g),b()};function b(){if(r<4)i.queue.unshift(_(P({},a),{cdnIndex:r+1,retryCount:0})),d(null);else if(l<Y.length)setTimeout(()=>{i.queue.push(_(P({},a),{retryCount:l+1,cdnIndex:0})),N()},Y[l]),d(null);else{i.failedUrls.add(s);const f="/icons/common/default-favicon.png";t&&(t.src=f),p==null||p(f),d(f)}}v.src=m})})}function Qn(){const a=k(!1);function s(l,r=null,m=null){return new Promise((d,v)=>{if(!l){d("/icons/common/default-favicon.png");return}if(i.cache.has(l)){const g=i.cache.get(l);r&&(r.src=g),d(g);return}if(i.failedUrls.has(l)){const g="/icons/common/default-favicon.png";r&&(r.src=g),d(g);return}i.queue.push({url:l,element:r,cardId:m,resolve:d,reject:v}),N()})}function t(l,r,m=null){if(!l||!r)return;i.observers.has(l)&&i.observers.get(l).disconnect();const d=new IntersectionObserver(v=>{v.forEach(g=>{g.isIntersecting&&(s(r,l,m),d.disconnect(),i.observers.delete(l))})},{rootMargin:"200px",threshold:.01});return d.observe(l),i.observers.set(l,d),()=>{d.disconnect(),i.observers.delete(l)}}function c(l){l.forEach(r=>{!i.cache.has(r)&&!i.failedUrls.has(r)&&s(r)})}function p(){i.cache.clear(),i.failedUrls.clear()}function w(){return{cached:i.cache.size,failed:i.failedUrls.size,queued:i.queue.length,running:i.running}}return{queueIcon:s,setupLazyLoad:t,preloadIcons:c,clearCache:p,getCacheStats:w,isLoading:a}}const Jn=["data-card-id","onContextmenu","onClick"],Zn=["href","target","title","onClick"],et=["data-url","onError"],nt={class:"link-text"},tt={key:0,class:"card-selected-badge"},I="/icons/common/default-favicon.png",ot={__name:"CardGrid",props:{cards:Array,selectedCards:Array,categoryId:Number,subCategoryId:[Number,null],selectionMode:Boolean},emits:["contextEdit","contextDelete","toggleCardSelection","openMovePanel","requireAuth","cardClicked"],setup(a,{emit:s}){const t=a,c=s,p=k(null),{setupLazyLoad:w,queueIcon:l}=Qn(),r=new Map;function m(n){try{return new URL(n).origin}catch(e){return null}}function d(n,e){if(!n||!e.url)return;if(r.has(e.id)&&r.get(e.id)(),e.logo_url){n.src=e.logo_url;return}const o=m(e.url);if(!o){n.src=I;return}const x=w(n,o,e.id);x&&r.set(e.id,x)}D(()=>{r.forEach(n=>n()),r.clear()});const v=k(!1),g=k(0),b=k(0),f=k(null);function te(n,e){return U(this,null,function*(){f.value=e,v.value=!0;const o=n.clientX,x=n.clientY,{nextTick:h}=yield ye(()=>U(null,null,function*(){const{nextTick:E}=yield Promise.resolve().then(()=>Gn);return{nextTick:E}}),void 0);yield h();const L=document.querySelector(".context-menu");if(L){const E=L.offsetWidth,H=L.offsetHeight,K=window.innerWidth,W=window.innerHeight;let S=o,T=x;o+E>K&&(S=K-E-10),x+H>W&&(T=W-H-10),S=Math.max(10,S),T=Math.max(10,T),g.value=S,b.value=T}else g.value=o,b.value=x})}function C(){v.value=!1,f.value=null}function oe(){f.value&&c("contextEdit",f.value),C()}function ae(){f.value&&c("contextDelete",f.value),C()}function se(){f.value&&c("toggleCardSelection",f.value),C()}function ie(){f.value&&(R(f.value)||c("toggleCardSelection",f.value),c("openMovePanel")),C()}function re(){f.value&&(j(f.value.id),window.open(f.value.url,"_blank")),C()}function ce(){if(f.value){const n=f.value.url;navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(n).catch(()=>{V(n)}):V(n)}C()}function V(n){const e=document.createElement("textarea");e.value=n,e.style.position="fixed",e.style.left="-9999px",document.body.appendChild(e),e.select();try{document.execCommand("copy")}catch(o){console.error("Copy failed:",o)}document.body.removeChild(e)}function A(n){v.value&&C()}function le(n,e){(n.ctrlKey||n.metaKey||t.selectionMode)&&(n.preventDefault(),n.stopPropagation(),c("toggleCardSelection",e))}function ue(n,e){n.ctrlKey||n.metaKey||t.selectionMode?(n.preventDefault(),n.stopPropagation(),c("toggleCardSelection",e)):j(e.id)}function j(n){fetch(`/api/cards/${n}/click`,{method:"POST"}).catch(()=>{}),c("cardClicked",n)}F(()=>{document.addEventListener("click",A),document.addEventListener("scroll",C)}),D(()=>{document.removeEventListener("click",A),document.removeEventListener("scroll",C)});function de(n,e){if(n.target._retried){n.target.src=I;return}n.target._retried=!0;const o=m(e.url);o?l(o,n.target,e.id):n.target.src=I}function fe(n){let e="";return n.desc&&(e+=n.desc+`
`),n.tags&&n.tags.length>0&&(e+="æ ‡ç­¾: "+n.tags.map(o=>o.name).join(", ")+`
`),e+=n.url,e}function me(n){return n?n.length>20?n.slice(0,20)+"...":n:""}function R(n){var e;return((e=t.selectedCards)==null?void 0:e.some(o=>o.id===n.id))||!1}return(n,e)=>(y(),M("div",{ref_key:"cardGridRef",ref:p,class:O(["container card-grid",{"selection-mode":a.selectionMode}])},[(y(!0),M(J,null,Z(a.cards,(o,x)=>(y(),M("div",{key:o.id,class:O(["link-item",{selected:R(o)}]),"data-card-id":o.id,onContextmenu:q(h=>te(h,o),["prevent"]),onClick:h=>le(h,o)},[u("a",{href:a.selectionMode?"javascript:void(0)":o.url,target:a.selectionMode?"":"_blank",title:fe(o),onClick:h=>ue(h,o),class:"card-link"},[u("img",{class:"link-icon",ref_for:!0,ref:h=>h&&d(h,o),src:I,"data-url":o.url,alt:"",onError:h=>de(h,o)},null,40,et),u("span",nt,B(me(o.title)),1)],8,Zn),R(o)?(y(),M("div",tt,"âœ“")):z("",!0)],42,Jn))),128)),(y(),Q(ne,{to:"body"},[v.value?(y(),M("div",{key:0,class:"context-menu",style:ee({left:g.value+"px",top:b.value+"px"}),onClick:e[0]||(e[0]=q(()=>{},["stop"]))},[u("div",{class:"context-menu-item",onClick:oe},[...e[1]||(e[1]=[u("span",{class:"context-menu-icon"},"âœï¸",-1),u("span",null,"ç¼–è¾‘",-1)])]),u("div",{class:"context-menu-item",onClick:ae},[...e[2]||(e[2]=[u("span",{class:"context-menu-icon"},"ğŸ—‘ï¸",-1),u("span",null,"åˆ é™¤",-1)])]),e[7]||(e[7]=u("div",{class:"context-menu-divider"},null,-1)),u("div",{class:"context-menu-item",onClick:se},[e[3]||(e[3]=u("span",{class:"context-menu-icon"},"â˜‘ï¸",-1)),u("span",null,B(R(f.value)?"å–æ¶ˆé€‰ä¸­":"é€‰ä¸­"),1)]),u("div",{class:"context-menu-item",onClick:ie},[...e[4]||(e[4]=[u("span",{class:"context-menu-icon"},"ğŸ“",-1),u("span",null,"ç§»åŠ¨åˆ°...",-1)])]),e[8]||(e[8]=u("div",{class:"context-menu-divider"},null,-1)),u("div",{class:"context-menu-item",onClick:re},[...e[5]||(e[5]=[u("span",{class:"context-menu-icon"},"ğŸ”—",-1),u("span",null,"åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€",-1)])]),u("div",{class:"context-menu-item",onClick:ce},[...e[6]||(e[6]=[u("span",{class:"context-menu-icon"},"ğŸ“‹",-1),u("span",null,"å¤åˆ¶é“¾æ¥",-1)])])],4)):z("",!0)]))],2))}},it=xe(ot,[["__scopeId","data-v-a4b9dd37"]]);export{it as default};
