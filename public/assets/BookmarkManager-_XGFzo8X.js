var H=Object.defineProperty,K=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var $=(v,o,l)=>o in v?H(v,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):v[o]=l,S=(v,o)=>{for(var l in o||(o={}))W.call(o,l)&&$(v,l,o[l]);if(I)for(var l of I(o))X.call(o,l)&&$(v,l,o[l]);return v},A=(v,o)=>K(v,Q(o));var b=(v,o,l)=>new Promise((r,p)=>{var y=m=>{try{k(l.next(m))}catch(_){p(_)}},C=m=>{try{k(l.throw(m))}catch(_){p(_)}},k=m=>m.done?r(m.value):Promise.resolve(m.value).then(y,C);k((l=l.apply(v,o)).next())});import{_ as Y,r as h,e as V,g as Z,c as u,b as s,i as E,k as N,q as ee,d as U,t as g,F as x,a as R,o as d,p as z,n as te,w as se,C as ae}from"./index-BL-DYIQS.js";import{g as oe,N as ne,h as le}from"./api-DfQIEmB0.js";const ie={class:"bookmark-manager"},re={class:"header"},ce={class:"header-left"},ue={key:0,class:"import-panel"},de={class:"import-header"},ve={class:"import-actions"},me=["disabled"],ge={key:0,class:"check-summary"},ke={class:"batch-toolbar"},pe={class:"selected-count"},he={class:"bookmark-list"},fe=["checked","onChange"],_e={class:"status-icon"},be={key:0},ye={key:1},Ce={key:2},we={key:3},Me={key:4},Be={class:"bookmark-info"},Ie={class:"bookmark-title"},$e={class:"bookmark-url"},Se={key:0,class:"bookmark-folder"},Ae={class:"bookmark-category"},Ve=["onUpdate:modelValue"],Ee=["value"],Ne={class:"import-footer"},Ue=["disabled"],xe={key:1,class:"empty-state"},Re={__name:"BookmarkManager",setup(v){const o=h([]),l=h([]),r=h([]),p=h(!1),y=h(0),C=h(!1),k=h(""),m=h(!1),_={"github.com":"å¼€å‘å·¥å…·","gitlab.com":"å¼€å‘å·¥å…·","stackoverflow.com":"å¼€å‘å·¥å…·","youtube.com":"è§†é¢‘","bilibili.com":"è§†é¢‘","twitter.com":"ç¤¾äº¤","facebook.com":"ç¤¾äº¤","weibo.com":"ç¤¾äº¤","zhihu.com":"ç¤¾åŒº","reddit.com":"ç¤¾åŒº","amazon.com":"è´­ç‰©","taobao.com":"è´­ç‰©","jd.com":"è´­ç‰©"},w=V(()=>{const a={valid:0,invalid:0,timeout:0,duplicate:0,pending:0};return o.value.forEach(e=>{a[e.status||"pending"]++}),a}),L=V(()=>k.value?o.value.filter(a=>a.status===k.value):o.value);function O(a){try{const e=new URL(a).hostname.replace("www.","");for(const[i,t]of Object.entries(_))if(e.includes(i)){const c=l.value.find(n=>n.name.includes(t));return(c==null?void 0:c.id)||""}}catch(e){}return""}function j(){return b(this,null,function*(){try{const a=yield oe();l.value=a.data}catch(a){console.error("åŠ è½½èœå•å¤±è´¥:",a)}})}function D(){return b(this,null,function*(){var e,i;if(p.value)return;p.value=!0,y.value=0;const a=o.value.map(t=>({url:t.url,title:t.title,folder:t.folder}));try{const t=yield ne(a),c={};[...t.data.valid,...t.data.invalid,...t.data.timeout,...t.data.duplicate].forEach(n=>{c[n.url]=n.status}),o.value.forEach(n=>{n.status=c[n.url]||"valid"}),C.value=!0}catch(t){console.error("æ£€æµ‹å¤±è´¥:",t),alert("æ£€æµ‹å¤±è´¥: "+(((i=(e=t.response)==null?void 0:e.data)==null?void 0:i.error)||t.message))}finally{p.value=!1}})}function F(a){const e=r.value.indexOf(a);e>-1?r.value.splice(e,1):r.value.push(a)}function T(){r.value=o.value.map((a,e)=>e)}function q(){r.value=o.value.map((a,e)=>a.status==="valid"||!a.status?e:-1).filter(a=>a>=0)}function J(){r.value=[]}function P(){return b(this,null,function*(){var a,e;if(r.value.length!==0){m.value=!0;try{const i={};r.value.forEach(c=>{var B;const n=o.value[c],f=n.targetMenuId||((B=l.value[0])==null?void 0:B.id);f&&(i[f]||(i[f]=[]),i[f].push({title:n.title,url:n.url,logo:`https://api.xinac.net/icon/?url=${new URL(n.url).origin}&sz=128`,description:""}))});let t=0;for(const[c,n]of Object.entries(i)){const f=yield le(parseInt(c),null,n);t+=f.data.added||0}alert(`æˆåŠŸå¯¼å…¥ ${t} ä¸ªä¹¦ç­¾`),window.location.href="/"}catch(i){console.error("å¯¼å…¥å¤±è´¥:",i),alert("å¯¼å…¥å¤±è´¥: "+(((e=(a=i.response)==null?void 0:a.data)==null?void 0:e.error)||i.message))}finally{m.value=!1}}})}function G(){window.location.href="/"}function M(){console.log("[BookmarkManager] å°è¯•ä»ŽsessionStorageåŠ è½½ä¹¦ç­¾...");const a=sessionStorage.getItem("pendingBookmarks");if(console.log("[BookmarkManager] sessionStorageæ•°æ®:",a?`${a.length}å­—ç¬¦`:"null"),a)try{const e=JSON.parse(a);console.log("[BookmarkManager] è§£æžåˆ°ä¹¦ç­¾æ•°é‡:",e.length),Array.isArray(e)&&e.length>0&&(o.value=e.map(i=>A(S({},i),{status:"",targetMenuId:O(i.url)})),console.log("[BookmarkManager] ä¹¦ç­¾åŠ è½½æˆåŠŸ:",o.value.length),sessionStorage.removeItem("pendingBookmarks"))}catch(e){console.error("[BookmarkManager] è§£æžä¹¦ç­¾æ•°æ®å¤±è´¥:",e)}else console.log("[BookmarkManager] æ²¡æœ‰æ‰¾åˆ°å¾…å¯¼å…¥çš„ä¹¦ç­¾æ•°æ®")}return Z(()=>b(null,null,function*(){console.log("[BookmarkManager] ç»„ä»¶å·²æŒ‚è½½"),yield j(),M(),window.addEventListener("bookmarksReady",()=>{console.log("[BookmarkManager] æ”¶åˆ°bookmarksReadyäº‹ä»¶"),M()}),setTimeout(()=>{o.value.length===0&&(console.log("[BookmarkManager] 1ç§’åŽé‡è¯•åŠ è½½..."),M())},1e3)})),(a,e)=>{const i=ee("router-link");return d(),u("div",ie,[s("div",re,[s("div",ce,[E(i,{to:"/",class:"back-btn"},{default:N(()=>e[5]||(e[5]=[z("â† è¿”å›žé¦–é¡µ")])),_:1,__:[5]}),e[6]||(e[6]=s("h1",null,"ðŸ“š ä¹¦ç­¾å¯¼å…¥",-1))])]),o.value.length>0?(d(),u("div",ue,[s("div",de,[s("h2",null,"å¾…å¯¼å…¥ä¹¦ç­¾ ("+g(o.value.length)+")",1),s("div",ve,[s("button",{onClick:D,class:"btn btn-check",disabled:p.value},g(p.value?`æ£€æµ‹ä¸­ ${y.value}/${o.value.length}`:"ðŸ” æ£€æµ‹é“¾æŽ¥æœ‰æ•ˆæ€§"),9,me)])]),C.value?(d(),u("div",ge,[s("span",{class:"status-tag valid",onClick:e[0]||(e[0]=t=>k.value="valid")},"âœ… æœ‰æ•ˆ "+g(w.value.valid),1),s("span",{class:"status-tag timeout",onClick:e[1]||(e[1]=t=>k.value="timeout")},"âš ï¸ è¶…æ—¶ "+g(w.value.timeout),1),s("span",{class:"status-tag invalid",onClick:e[2]||(e[2]=t=>k.value="invalid")},"âŒ å¤±æ•ˆ "+g(w.value.invalid),1),s("span",{class:"status-tag duplicate",onClick:e[3]||(e[3]=t=>k.value="duplicate")},"ðŸ”„ é‡å¤ "+g(w.value.duplicate),1),s("span",{class:"status-tag",onClick:e[4]||(e[4]=t=>k.value="")},"å…¨éƒ¨")])):U("",!0),s("div",ke,[s("button",{onClick:q,class:"btn btn-sm"},"å…¨é€‰æœ‰æ•ˆ"),s("button",{onClick:T,class:"btn btn-sm"},"å…¨é€‰"),s("button",{onClick:J,class:"btn btn-sm"},"æ¸…é™¤é€‰æ‹©"),s("span",pe,"å·²é€‰ "+g(r.value.length)+" é¡¹",1)]),s("div",he,[(d(!0),u(x,null,R(L.value,(t,c)=>(d(),u("div",{key:c,class:te(["bookmark-item",[t.status,{selected:r.value.includes(c)}]])},[s("input",{type:"checkbox",checked:r.value.includes(c),onChange:n=>F(c)},null,40,fe),s("div",_e,[t.status==="valid"?(d(),u("span",be,"âœ…")):t.status==="invalid"?(d(),u("span",ye,"âŒ")):t.status==="timeout"?(d(),u("span",Ce,"âš ï¸")):t.status==="duplicate"?(d(),u("span",we,"ðŸ”„")):(d(),u("span",Me,"â³"))]),s("div",Be,[s("div",Ie,g(t.title),1),s("div",$e,g(t.url),1),t.folder?(d(),u("div",Se,"ðŸ“ "+g(t.folder),1)):U("",!0)]),s("div",Ae,[se(s("select",{"onUpdate:modelValue":n=>t.targetMenuId=n,class:"category-select"},[e[7]||(e[7]=s("option",{value:""},"é€‰æ‹©åˆ†ç±»",-1)),(d(!0),u(x,null,R(l.value,n=>(d(),u("option",{key:n.id,value:n.id},g(n.name),9,Ee))),128))],8,Ve),[[ae,t.targetMenuId]])])],2))),128))]),s("div",Ne,[s("button",{onClick:G,class:"btn btn-secondary"},"å–æ¶ˆ"),s("button",{onClick:P,class:"btn btn-primary",disabled:r.value.length===0||m.value},g(m.value?"å¯¼å…¥ä¸­...":`å¯¼å…¥é€‰ä¸­ (${r.value.length})`),9,Ue)])])):(d(),u("div",xe,[e[9]||(e[9]=s("p",null,"ðŸ“­ æš‚æ— å¾…å¯¼å…¥çš„ä¹¦ç­¾",-1)),e[10]||(e[10]=s("p",{class:"hint"},"è¯·ä½¿ç”¨æµè§ˆå™¨æ‰©å±•é€‰æ‹©ä¹¦ç­¾åŽå¯¼å…¥",-1)),E(i,{to:"/",class:"btn btn-primary"},{default:N(()=>e[8]||(e[8]=[z("è¿”å›žé¦–é¡µ")])),_:1,__:[8]})]))])}}},je=Y(Re,[["__scopeId","data-v-e9b2eb9d"]]);export{je as default};
