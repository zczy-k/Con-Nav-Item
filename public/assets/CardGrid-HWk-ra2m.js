import{_ as G,r as u,o as K,a as T,b as d,d as c,f as V,F as j,g as A,w as y,i as F,e as t,h as b,t as w,n as X,T as Y}from"./index-BjFgBJVl.js";const q=["data-card-id","onContextmenu","onClick"],H=["href","title"],J=["src","onError"],Q={class:"link-text"},W={key:0,class:"card-selected-badge"},Z={__name:"CardGrid",props:{cards:Array,selectedCards:Array,categoryId:Number,subCategoryId:[Number,null]},emits:["contextEdit","contextDelete","toggleCardSelection","openMovePanel"],setup(g,{emit:E}){const M=g,r=E,S=u(null),f=u(!1),v=u(0),x=u(0),l=u(null);function h(n,e){l.value=e,v.value=n.clientX,x.value=n.clientY,f.value=!0}function a(){f.value=!1,l.value=null}function D(){l.value&&r("contextEdit",l.value),a()}function I(){l.value&&r("contextDelete",l.value),a()}function L(){l.value&&r("toggleCardSelection",l.value),a()}function _(){l.value&&(p(l.value)||r("toggleCardSelection",l.value),r("openMovePanel")),a()}function z(){l.value&&window.open(l.value.url,"_blank"),a()}function O(){l.value&&navigator.clipboard.writeText(l.value.url),a()}function C(n){f.value&&a()}function U(n,e){(n.ctrlKey||n.metaKey)&&(n.preventDefault(),n.stopPropagation(),r("toggleCardSelection",e))}function $(n){(n.ctrlKey||n.metaKey)&&(n.preventDefault(),n.stopPropagation())}K(()=>{document.addEventListener("click",C),document.addEventListener("scroll",a)}),T(()=>{document.removeEventListener("click",C),document.removeEventListener("scroll",a)});function k(n){try{return new URL(n).origin}catch(e){return null}}function N(n){if(n.logo_url)return n.logo_url;const e=k(n.url);return e?`https://api.xinac.net/icon/?url=${e}&sz=128`:"/default-favicon.png"}const m=[n=>`https://api.xinac.net/icon/?url=${n}&sz=128`,n=>`https://api.afmax.cn/so/ico/index.php?r=${n}&sz=128`,n=>`https://icon.horse/icon/${n}`,n=>`https://www.google.com/s2/favicons?domain=${n}&sz=128`,n=>`https://favicon.im/${n}?larger=true`];function P(n,e){const o=n.target.src,i=k(e.url);if(!i){n.target.src="/default-favicon.png";return}n.target._cdnIndex===void 0&&(n.target._cdnIndex=0);for(let s=0;s<m.length;s++)if(m[s](i),o.includes("api.xinac.net")&&s===0||o.includes("api.afmax.cn")&&s===1||o.includes("icon.horse")&&s===2||o.includes("www.google.com/s2/favicons")&&s===3||o.includes("favicon.im")&&s===4){if(s+1<m.length){n.target._cdnIndex=s+1,n.target.src=m[s+1](i);return}break}n.target.src="/default-favicon.png"}function R(n){let e="";return n.desc&&(e+=n.desc+`
`),n.tags&&n.tags.length>0&&(e+="æ ‡ç­¾: "+n.tags.map(o=>o.name).join(", ")+`
`),e+=n.url,e}function B(n){return n?n.length>20?n.slice(0,20)+"...":n:""}function p(n){var e;return((e=M.selectedCards)==null?void 0:e.some(o=>o.id===n.id))||!1}return(n,e)=>(c(),d("div",{ref_key:"cardGridRef",ref:S,class:"container card-grid"},[(c(!0),d(j,null,A(g.cards,o=>(c(),d("div",{key:o.id,class:F(["link-item",{selected:p(o)}]),"data-card-id":o.id,onContextmenu:y(i=>h(i,o),["prevent"]),onClick:i=>U(i,o)},[t("a",{href:o.url,target:"_blank",title:R(o),onClick:e[0]||(e[0]=i=>$(i)),class:"card-link"},[t("img",{class:"link-icon",src:N(o),alt:"",onError:i=>P(i,o),loading:"lazy"},null,40,J),t("span",Q,w(B(o.title)),1)],8,H),p(o)?(c(),d("div",W,"âœ“")):b("",!0)],42,q))),128)),(c(),V(Y,{to:"body"},[f.value?(c(),d("div",{key:0,class:"context-menu",style:X({left:v.value+"px",top:x.value+"px"}),onClick:e[1]||(e[1]=y(()=>{},["stop"]))},[t("div",{class:"context-menu-item",onClick:D},[...e[2]||(e[2]=[t("span",{class:"context-menu-icon"},"âœï¸",-1),t("span",null,"ç¼–è¾‘",-1)])]),t("div",{class:"context-menu-item",onClick:I},[...e[3]||(e[3]=[t("span",{class:"context-menu-icon"},"ğŸ—‘ï¸",-1),t("span",null,"åˆ é™¤",-1)])]),e[8]||(e[8]=t("div",{class:"context-menu-divider"},null,-1)),t("div",{class:"context-menu-item",onClick:L},[e[4]||(e[4]=t("span",{class:"context-menu-icon"},"â˜‘ï¸",-1)),t("span",null,w(p(l.value)?"å–æ¶ˆé€‰ä¸­":"é€‰ä¸­"),1)]),t("div",{class:"context-menu-item",onClick:_},[...e[5]||(e[5]=[t("span",{class:"context-menu-icon"},"ğŸ“",-1),t("span",null,"ç§»åŠ¨åˆ°...",-1)])]),e[9]||(e[9]=t("div",{class:"context-menu-divider"},null,-1)),t("div",{class:"context-menu-item",onClick:z},[...e[6]||(e[6]=[t("span",{class:"context-menu-icon"},"ğŸ”—",-1),t("span",null,"åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€",-1)])]),t("div",{class:"context-menu-item",onClick:O},[...e[7]||(e[7]=[t("span",{class:"context-menu-icon"},"ğŸ“‹",-1),t("span",null,"å¤åˆ¶é“¾æ¥",-1)])])],4)):b("",!0)]))],512))}},en=G(Z,[["__scopeId","data-v-5aa55a7a"]]);export{en as default};
