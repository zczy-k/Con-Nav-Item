import{_ as K,r,o as V,a as j,b as u,d as c,f as A,F,g as X,w,i as Y,e as o,h as M,t as E,n as q,T as H}from"./index-CfQK0ihy.js";const J=["data-card-id","onContextmenu","onClick"],Q=["href","title","onClick"],W=["src","onError"],Z={class:"link-text"},ee={key:0,class:"card-selected-badge"},ne={__name:"CardGrid",props:{cards:Array,selectedCards:Array,categoryId:Number,subCategoryId:[Number,null],selectionMode:Boolean},emits:["contextEdit","contextDelete","toggleCardSelection","openMovePanel","requireAuth","cardClicked"],setup(x,{emit:S}){const v=x,a=S,_=r(null),d=r(!1),g=r(0),C=r(0),i=r(null);function D(e,n){i.value=n,g.value=e.clientX,C.value=e.clientY,d.value=!0}function s(){d.value=!1,i.value=null}function L(){i.value&&a("contextEdit",i.value),s()}function z(){i.value&&a("contextDelete",i.value),s()}function I(){i.value&&a("toggleCardSelection",i.value),s()}function O(){i.value&&(m(i.value)||a("toggleCardSelection",i.value),a("openMovePanel")),s()}function $(){i.value&&(b(i.value.id),window.open(i.value.url,"_blank")),s()}function P(){if(i.value){const e=i.value.url;navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(e).catch(()=>{k(e)}):k(e)}s()}function k(e){const n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.left="-9999px",document.body.appendChild(n),n.select();try{document.execCommand("copy")}catch(t){console.error("Copy failed:",t)}document.body.removeChild(n)}function y(e){d.value&&s()}function T(e,n){(e.ctrlKey||e.metaKey||v.selectionMode)&&(e.preventDefault(),e.stopPropagation(),a("toggleCardSelection",n))}function U(e,n){e.ctrlKey||e.metaKey||v.selectionMode?(e.preventDefault(),e.stopPropagation()):b(n.id)}function b(e){fetch(`/api/cards/${e}/click`,{method:"POST"}).catch(()=>{}),a("cardClicked",e)}V(()=>{document.addEventListener("click",y),document.addEventListener("scroll",s)}),j(()=>{document.removeEventListener("click",y),document.removeEventListener("scroll",s)});function h(e){try{return new URL(e).origin}catch(n){return null}}function B(e){if(e.logo_url)return e.logo_url;const n=h(e.url);return n?`https://api.xinac.net/icon/?url=${n}&sz=128`:"/default-favicon.png"}const f=[e=>`https://api.xinac.net/icon/?url=${e}&sz=128`,e=>`https://api.afmax.cn/so/ico/index.php?r=${e}&sz=128`,e=>`https://icon.horse/icon/${e}`,e=>`https://www.google.com/s2/favicons?domain=${e}&sz=128`,e=>`https://favicon.im/${e}?larger=true`];function N(e,n){const t=e.target.src,p=h(n.url);if(!p){e.target.src="/default-favicon.png";return}e.target._cdnIndex===void 0&&(e.target._cdnIndex=0);for(let l=0;l<f.length;l++)if(f[l](p),t.includes("api.xinac.net")&&l===0||t.includes("api.afmax.cn")&&l===1||t.includes("icon.horse")&&l===2||t.includes("www.google.com/s2/favicons")&&l===3||t.includes("favicon.im")&&l===4){if(l+1<f.length){e.target._cdnIndex=l+1,e.target.src=f[l+1](p);return}break}e.target.src="/default-favicon.png"}function R(e){let n="";return e.desc&&(n+=e.desc+`
`),e.tags&&e.tags.length>0&&(n+="æ ‡ç­¾: "+e.tags.map(t=>t.name).join(", ")+`
`),n+=e.url,n}function G(e){return e?e.length>20?e.slice(0,20)+"...":e:""}function m(e){var n;return((n=v.selectedCards)==null?void 0:n.some(t=>t.id===e.id))||!1}return(e,n)=>(c(),u("div",{ref_key:"cardGridRef",ref:_,class:"container card-grid"},[(c(!0),u(F,null,X(x.cards,(t,p)=>(c(),u("div",{key:t.id,class:Y(["link-item",{selected:m(t)}]),"data-card-id":t.id,onContextmenu:w(l=>D(l,t),["prevent"]),onClick:l=>T(l,t)},[o("a",{href:t.url,target:"_blank",title:R(t),onClick:l=>U(l,t),class:"card-link"},[o("img",{class:"link-icon",src:B(t),alt:"",onError:l=>N(l,t),loading:"lazy"},null,40,W),o("span",Z,E(G(t.title)),1)],8,Q),m(t)?(c(),u("div",ee,"âœ“")):M("",!0)],42,J))),128)),(c(),A(H,{to:"body"},[d.value?(c(),u("div",{key:0,class:"context-menu",style:q({left:g.value+"px",top:C.value+"px"}),onClick:n[0]||(n[0]=w(()=>{},["stop"]))},[o("div",{class:"context-menu-item",onClick:L},[...n[1]||(n[1]=[o("span",{class:"context-menu-icon"},"âœï¸",-1),o("span",null,"ç¼–è¾‘",-1)])]),o("div",{class:"context-menu-item",onClick:z},[...n[2]||(n[2]=[o("span",{class:"context-menu-icon"},"ğŸ—‘ï¸",-1),o("span",null,"åˆ é™¤",-1)])]),n[7]||(n[7]=o("div",{class:"context-menu-divider"},null,-1)),o("div",{class:"context-menu-item",onClick:I},[n[3]||(n[3]=o("span",{class:"context-menu-icon"},"â˜‘ï¸",-1)),o("span",null,E(m(i.value)?"å–æ¶ˆé€‰ä¸­":"é€‰ä¸­"),1)]),o("div",{class:"context-menu-item",onClick:O},[...n[4]||(n[4]=[o("span",{class:"context-menu-icon"},"ğŸ“",-1),o("span",null,"ç§»åŠ¨åˆ°...",-1)])]),n[8]||(n[8]=o("div",{class:"context-menu-divider"},null,-1)),o("div",{class:"context-menu-item",onClick:$},[...n[5]||(n[5]=[o("span",{class:"context-menu-icon"},"ğŸ”—",-1),o("span",null,"åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€",-1)])]),o("div",{class:"context-menu-item",onClick:P},[...n[6]||(n[6]=[o("span",{class:"context-menu-icon"},"ğŸ“‹",-1),o("span",null,"å¤åˆ¶é“¾æ¥",-1)])])],4)):M("",!0)]))],512))}},oe=K(ne,[["__scopeId","data-v-c3475ab4"]]);export{oe as default};
